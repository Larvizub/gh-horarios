{"version":3,"file":"static/js/429.d8d15f64.chunk.js","mappings":"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","sources":["components/horarios/CustomDateSelector.js","components/horarios/HeaderSemana.js","components/horarios/RecomendacionesPracticantes.js","components/horarios/TimeInput.js","services/firebaseHorarios.js","utils/permissionsUtils.js","components/horarios/DialogoHorario.js","components/horarios/DialogoEliminar.js","components/horarios/DialogoCopiar.js","components/horarios/ModalConfirmacion.js","components/horarios/InfoTurnoModal.js","utils/horariosUtils.js","utils/horariosHelpers.js","components/horarios/TurnoUsuario.js","components/horarios/HorariosTable.js","components/horarios/Horarios.js","hooks/useUsuariosYHorarios.js","hooks/useSemana.js","hooks/useModalConfirm.js","hooks/useUsuariosFiltrados.js","utils/horariosConstants.js","utils/contratoUtils.js"],"sourcesContent":["import React from 'react';\r\nimport { Button, Popover, Box, Typography, Grid, IconButton, useMediaQuery, useTheme } from '@mui/material';\r\nimport ArrowBackIosNewIcon from '@mui/icons-material/ArrowBackIosNew';\r\nimport ArrowForwardIosIcon from '@mui/icons-material/ArrowForwardIos';\r\nimport CalendarTodayIcon from '@mui/icons-material/CalendarToday';\r\nimport { format, addWeeks } from 'date-fns';\r\nimport { es } from 'date-fns/locale';\r\n\r\nconst CustomDateSelector = ({\r\n  semanaSeleccionada,\r\n  setSemanaSeleccionada,\r\n  datePickerOpen,\r\n  setDatePickerOpen,\r\n  anchorEl,\r\n  setAnchorEl\r\n}) => {\r\n  const theme = useTheme();\r\n  const isMobile = useMediaQuery(theme.breakpoints.down('md'));\r\n\r\n  // Funcin para abrir el popover\r\n  const handleOpen = (event) => {\r\n    setAnchorEl(event.currentTarget);\r\n    setDatePickerOpen(true);\r\n  };\r\n\r\n  // Funcin para cerrar el popover\r\n  const handleClose = () => {\r\n    setAnchorEl(null);\r\n    setDatePickerOpen(false);\r\n  };\r\n\r\n  // Funcin para cambiar la semana seleccionada\r\n  const handleChangeSemana = (weeks) => {\r\n    setSemanaSeleccionada(addWeeks(semanaSeleccionada, weeks));\r\n    handleClose();\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ display: 'inline-flex', alignItems: 'center' }}>\r\n      <Button\r\n        startIcon={<CalendarTodayIcon />}\r\n        onClick={handleOpen}\r\n        size={isMobile ? 'small' : 'medium'}\r\n        sx={{\r\n          fontWeight: 'bold',\r\n          fontSize: isMobile ? '0.85rem' : '1rem',\r\n          px: isMobile ? 1 : 2,\r\n          py: isMobile ? 0.5 : 1,\r\n          minWidth: isMobile ? 0 : 120\r\n        }}\r\n      >\r\n        {format(semanaSeleccionada, \"d 'de' MMMM yyyy\", { locale: es })}\r\n      </Button>\r\n      <Popover\r\n        open={datePickerOpen}\r\n        anchorEl={anchorEl}\r\n        onClose={handleClose}\r\n        anchorOrigin={{\r\n          vertical: 'bottom',\r\n          horizontal: 'left',\r\n        }}\r\n      >\r\n        <Box sx={{ p: 2, minWidth: 220 }}>\r\n          <Typography variant=\"subtitle2\" sx={{ mb: 2 }}>\r\n            Selecciona semana\r\n          </Typography>\r\n          <Grid container spacing={1} alignItems=\"center\">\r\n            <Grid item>\r\n              <IconButton onClick={() => handleChangeSemana(-1)} size=\"small\">\r\n                <ArrowBackIosNewIcon />\r\n              </IconButton>\r\n            </Grid>\r\n            <Grid item>\r\n              <Typography variant=\"body2\">\r\n                {format(semanaSeleccionada, \"d 'de' MMMM yyyy\", { locale: es })}\r\n              </Typography>\r\n            </Grid>\r\n            <Grid item>\r\n              <IconButton onClick={() => handleChangeSemana(1)} size=\"small\">\r\n                <ArrowForwardIosIcon />\r\n              </IconButton>\r\n            </Grid>\r\n          </Grid>\r\n        </Box>\r\n      </Popover>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default CustomDateSelector;\r\n","import React from 'react';\r\nimport { Grid, FormControl, InputLabel, Select, MenuItem, Box, IconButton } from '@mui/material';\r\nimport { useTheme, useMediaQuery } from '@mui/material';\r\nimport CustomDateSelector from './CustomDateSelector';\r\n\r\n/**\r\n * Componente de header con selector de departamento y navegacin de semanas.\r\n */\r\nexport default function HeaderSemana({\r\n  departamentos,\r\n  departamentoSeleccionado,\r\n  setDepartamentoSeleccionado,\r\n  loading,\r\n  semanaSeleccionada,\r\n  setSemanaSeleccionada,\r\n  yearSelected,\r\n  setYearSelected,\r\n  monthSelected,\r\n  setMonthSelected,\r\n  datePickerOpen,\r\n  setDatePickerOpen,\r\n  anchorEl,\r\n  setAnchorEl,\r\n  avanzarSemana,\r\n  retrocederSemana\r\n}) {\r\n  const theme = useTheme();\r\n  const isMobile = useMediaQuery(theme.breakpoints.down('md'));\r\n\r\n  return (\r\n    <Box sx={{ p: { xs: 1.5, sm: 3, md: 3 }, borderBottom: '1px solid', borderColor: 'divider' }}>\r\n      <Grid container spacing={{ xs: 1, sm: 2 }} alignItems=\"center\">\r\n        <Grid item xs={12} sm={6} md={4}>\r\n          <FormControl fullWidth size={isMobile ? 'small' : 'medium'}>\r\n            <InputLabel>Departamento</InputLabel>\r\n            <Select value={departamentoSeleccionado} onChange={(e) => setDepartamentoSeleccionado(e.target.value)} disabled={loading}>\r\n              {departamentos.map((depto) => (\r\n                <MenuItem key={depto} value={depto}>{depto}</MenuItem>\r\n              ))}\r\n            </Select>\r\n          </FormControl>\r\n        </Grid>\r\n        <Grid item xs={12} sm={6} md={8}>\r\n          <Box sx={{ display: 'flex', gap: { xs: 0.5, sm: 1 }, alignItems: 'center', flexWrap: 'wrap', justifyContent: { xs: 'center', sm: 'flex-end' } }}>\r\n            <IconButton onClick={retrocederSemana} disabled={loading} size={isMobile ? 'small' : 'medium'} sx={{ bgcolor: 'action.hover', '&:hover': { bgcolor: 'action.selected' } }}>\r\n              <span style={{ fontSize: isMobile ? '1rem' : '1.25rem' }}></span>\r\n            </IconButton>\r\n            <CustomDateSelector\r\n              semanaSeleccionada={semanaSeleccionada}\r\n              setSemanaSeleccionada={setSemanaSeleccionada}\r\n              yearSelected={yearSelected}\r\n              setYearSelected={setYearSelected}\r\n              monthSelected={monthSelected}\r\n              setMonthSelected={setMonthSelected}\r\n              datePickerOpen={datePickerOpen}\r\n              setDatePickerOpen={setDatePickerOpen}\r\n              anchorEl={anchorEl}\r\n              setAnchorEl={setAnchorEl}\r\n            />\r\n            <IconButton onClick={avanzarSemana} disabled={loading} size={isMobile ? 'small' : 'medium'} sx={{ bgcolor: 'action.hover', '&:hover': { bgcolor: 'action.selected' } }}>\r\n              <span style={{ fontSize: isMobile ? '1rem' : '1.25rem' }}></span>\r\n            </IconButton>\r\n          </Box>\r\n        </Grid>\r\n      </Grid>\r\n    </Box>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Box, Typography, Chip, Alert } from '@mui/material';\r\nimport WarningIcon from '@mui/icons-material/Warning';\r\n\r\nconst RecomendacionesPracticantes = ({\r\n  usuariosFiltrados,\r\n  calcularHorasExcedentes,\r\n  encontrarPracticantesDisponibles\r\n}) => {\r\n  // Filtra usuarios con horas excedentes usando tolerancia de 0.1h para evitar ruidos de punto flotante\r\n  const usuariosExcedidos = usuariosFiltrados.filter(u => {\r\n    const exceso = calcularHorasExcedentes(u.id);\r\n    return Math.round(exceso * 10) / 10 > 0;\r\n  });\r\n\r\n  if (usuariosExcedidos.length === 0) return null;\r\n\r\n  return (\r\n    <Box sx={{ my: 2 }}>\r\n      <Alert severity=\"warning\" icon={<WarningIcon />}>\r\n        <Typography variant=\"subtitle2\" sx={{ fontWeight: 'bold', mb: 1 }}>\r\n          Recomendaciones para redistribuir horas excedentes:\r\n        </Typography>\r\n        {usuariosExcedidos.map(usuario => {\r\n          // Redondear exceso a una cifra decimal para clculos y presentacin\r\n          const rawExceso = calcularHorasExcedentes(usuario.id);\r\n          const horasExceso = Math.round(rawExceso * 10) / 10;\r\n          const practicantes = encontrarPracticantesDisponibles(horasExceso);\r\n\r\n          return (\r\n            <Box key={usuario.id} sx={{ mb: 2 }}>\r\n              <Typography variant=\"body2\" sx={{ fontWeight: 'bold' }}>\r\n                {usuario.nombre} {usuario.apellidos} <Chip label={`+${horasExceso.toFixed(1)}h`} color=\"error\" size=\"small\" sx={{ ml: 1 }} />\r\n              </Typography>\r\n              {practicantes.length > 0 ? (\r\n                <Box sx={{ ml: 2, mt: 0.5 }}>\r\n                  <Typography variant=\"body2\" sx={{ fontWeight: 'bold' }}>\r\n                    Practicantes sugeridos:\r\n                  </Typography>\r\n                  {practicantes.slice(0, 3).map(p => (\r\n                    <Typography key={p.usuario.id} variant=\"body2\" sx={{ ml: 1 }}>\r\n                       {p.usuario.nombre} {p.usuario.apellidos} ({p.horasDisponibles}h disponibles)\r\n                    </Typography>\r\n                  ))}\r\n                </Box>\r\n              ) : (\r\n                <Typography variant=\"body2\" sx={{ ml: 2, color: 'text.secondary' }}>\r\n                  No hay practicantes disponibles con suficientes horas.\r\n                </Typography>\r\n              )}\r\n            </Box>\r\n          );\r\n        })}\r\n      </Alert>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default RecomendacionesPracticantes;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { TextField } from '@mui/material';\r\n\r\nconst TimeInput = ({ label, value, onChange, isMobile }) => {\r\n  const [localValue, setLocalValue] = useState(value || '');\r\n\r\n  useEffect(() => {\r\n    setLocalValue(value || '');\r\n  }, [value]);\r\n\r\n  const timeRegex = /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;\r\n\r\n  const handleChange = (e) => {\r\n    const newValue = e.target.value;\r\n    setLocalValue(newValue);\r\n    // Propaga cuando el valor es vlido (soporta 4 o 5 caracteres: 8:30 o 08:30)\r\n    if (timeRegex.test(newValue)) {\r\n      onChange({ target: { value: newValue } });\r\n    }\r\n  };\r\n\r\n  const handleBlur = () => {\r\n    // En blur, si es vlido, asegura la propagacin al padre\r\n    if (timeRegex.test(localValue)) {\r\n      onChange({ target: { value: localValue } });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <TextField\r\n      label={label}\r\n      value={localValue}\r\n  onChange={handleChange}\r\n  onBlur={handleBlur}\r\n      placeholder=\"Escribe en formato HH:mm\"\r\n      InputLabelProps={{ shrink: true }}\r\n      fullWidth\r\n      size={isMobile ? 'small' : 'medium'}\r\n      sx={{ \r\n        mb: 2,\r\n        '& .MuiInputBase-input': {\r\n          fontSize: isMobile ? '0.875rem' : '1rem'\r\n        }\r\n      }}\r\n    />\r\n  );\r\n};\r\n\r\nexport default TimeInput;\r\n","import { ref, get, set, update, onValue, off } from 'firebase/database';\r\nimport { database } from '../firebase/config';\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\n// NUEVA FUNCION: Eliminar horario de un usuario en un da especfico\r\nexport async function eliminarHorarioDeUsuario(semanaKey, usuarioId, diaKey) {\r\n  const refPath = `horarios_registros/${semanaKey}/${usuarioId}/${diaKey}`;\r\n  await set(ref(database, refPath), null);\r\n}\r\n\r\nexport async function cargarHorariosPorSemana(fechaSemana, obtenerClaveSemana) {\r\n  const semanaKey = obtenerClaveSemana(fechaSemana);\r\n  const horariosRef = ref(database, `horarios_registros/${semanaKey}`);\r\n  const horariosSnapshot = await get(horariosRef);\r\n  return horariosSnapshot.exists() ? horariosSnapshot.val() : {};\r\n}\r\n\r\n// Suscripcin en tiempo real para una semana concreta. Devuelve una funcin de unsubscribe.\r\nexport function subscribeHorariosSemana(semanaKey, onChange) {\r\n  if (!semanaKey) return () => {};\r\n  const r = ref(database, `horarios_registros/${semanaKey}`);\r\n  onValue(r, (snapshot) => {\r\n    try {\r\n      const val = snapshot.exists() ? snapshot.val() : {};\r\n      onChange(val);\r\n    } catch (e) {\r\n      console.error('Error en subscribeHorariosSemana onValue:', e);\r\n    }\r\n  });\r\n  // onValue already returns an unsubscribe function when passed to off; normal pattern is to return () => off(r)\r\n  return () => off(r);\r\n}\r\n\r\n// Suscripcin para horas extras\r\nexport function subscribeHorasExtras(onChange) {\r\n  const r = ref(database, 'horas_extras');\r\n  onValue(r, (snapshot) => {\r\n    try {\r\n      const val = snapshot.exists() ? snapshot.val() : {};\r\n      onChange(val);\r\n    } catch (e) {\r\n      console.error('Error en subscribeHorasExtras onValue:', e);\r\n    }\r\n  });\r\n  return () => off(r);\r\n}\r\n\r\nexport async function guardarHorariosSemana(semanaKey, horariosEditados) {\r\n  // Usa update para hacer merge de los usuarios provistos sin borrar los que no vienen en el payload\r\n  // Si se pasa un objeto por usuario, convertimos a actualizaciones por da para evitar sobrescribir sub-keys de otros clientes\r\n  if (!horariosEditados || Object.keys(horariosEditados).length === 0) return;\r\n  const mergedUpdates = {};\r\n  for (const [usuarioId, horariosUsuario] of Object.entries(horariosEditados)) {\r\n    const basePath = `horarios_registros/${semanaKey}/${usuarioId}`;\r\n    if (!horariosUsuario || typeof horariosUsuario !== 'object') continue;\r\n    // Para cada da dentro del objeto (dia1..dia7) escribimos por path individual\r\n    for (const [diaKey, valor] of Object.entries(horariosUsuario)) {\r\n      mergedUpdates[`${basePath}/${diaKey}`] = valor || null;\r\n    }\r\n  }\r\n  if (Object.keys(mergedUpdates).length > 0) {\r\n    await update(ref(database), mergedUpdates);\r\n  }\r\n}\r\n\r\nexport async function guardarHorasExtras(horasExtras) {\r\n  // Intentos con reintento simple\r\n  const maxRetries = 3;\r\n  let attempt = 0;\r\n  let lastErr = null;\r\n  while (attempt < maxRetries) {\r\n    try {\r\n      await set(ref(database, 'horas_extras'), horasExtras);\r\n      return;\r\n    } catch (e) {\r\n      lastErr = e;\r\n      attempt += 1;\r\n      // backoff\r\n      const delay = 200 * attempt;\r\n      await new Promise(res => setTimeout(res, delay));\r\n    }\r\n  }\r\n  throw lastErr;\r\n}\r\n\r\n// Guarda solo los horarios de un usuario dentro de una semana, sin afectar a los dems\r\nexport async function guardarHorariosUsuarioSemana(semanaKey, usuarioId, horariosUsuario) {\r\n  // Usar update granular por dia para evitar sobrescribir datos concurrentes\r\n  if (!horariosUsuario || Object.keys(horariosUsuario).length === 0) {\r\n    // Si viene vaco, borramos el nodo del usuario\r\n    await set(ref(database, `horarios_registros/${semanaKey}/${usuarioId}`), {});\r\n    return;\r\n  }\r\n  const updates = {};\r\n  for (const [diaKey, valor] of Object.entries(horariosUsuario)) {\r\n    updates[`horarios_registros/${semanaKey}/${usuarioId}/${diaKey}`] = valor || null;\r\n  }\r\n  if (Object.keys(updates).length > 0) {\r\n    // Reintentos para escrituras\r\n    const maxRetries = 3;\r\n    let attempt = 0;\r\n    let lastErr = null;\r\n    while (attempt < maxRetries) {\r\n      try {\r\n        await update(ref(database), updates);\r\n        return;\r\n      } catch (e) {\r\n        lastErr = e;\r\n        attempt += 1;\r\n        const delay = 150 * attempt;\r\n        await new Promise(res => setTimeout(res, delay));\r\n      }\r\n    }\r\n    throw lastErr;\r\n  }\r\n}\r\n\r\n// Guardado en lote: recibe un objeto con paths absolutos y valores, y hace un update nico\r\n// Ejemplo de updates: { 'horarios_registros/2025-32/uid123': { ... }, 'horarios_registros/2025-33/uid456': { ... } }\r\nexport async function guardarBatchHorarios(updatesObject) {\r\n  if (!updatesObject || Object.keys(updatesObject).length === 0) return;\r\n\r\n  // Preparar updates granulares: si el valor es un objeto (por ejemplo el objeto del usuario para una semana),\r\n  // lo desglosamos en paths por da. Adems guardamos un backup mnimo para auditora/recuperacin.\r\n  const mergedUpdates = {};\r\n  const backup = {\r\n    id: uuidv4(),\r\n    timestamp: Date.now(),\r\n    payload: {}\r\n  };\r\n\r\n  for (const [pathKey, value] of Object.entries(updatesObject)) {\r\n    // Si value es un objeto, asumimos que representa un conjunto de das o usuarios\r\n    if (value && typeof value === 'object' && !Array.isArray(value)) {\r\n      // Desglosar en child keys\r\n      for (const [childKey, childVal] of Object.entries(value)) {\r\n        mergedUpdates[`${pathKey}/${childKey}`] = childVal || null;\r\n      }\r\n      backup.payload[pathKey] = value;\r\n    } else {\r\n      // Valor escalar o nulo, lo aplicamos directamente\r\n      mergedUpdates[pathKey] = value;\r\n      backup.payload[pathKey] = value;\r\n    }\r\n  }\r\n\r\n  // Escribir backup para poder recuperar en caso de sobrescritura accidental\r\n  try {\r\n    await set(ref(database, `horarios_backups/${backup.id}`), backup);\r\n  } catch (e) {\r\n    console.warn('No se pudo guardar backup de horarios:', e);\r\n  }\r\n\r\n  // Escribir todos los updates en una sola operacin atmica con reintentos\r\n  const maxRetries = 3;\r\n  let attempt = 0;\r\n  let lastErr = null;\r\n  while (attempt < maxRetries) {\r\n    try {\r\n      await update(ref(database), mergedUpdates);\r\n      return;\r\n    } catch (e) {\r\n      lastErr = e;\r\n    attempt += 1;\r\n    const delay = 200 * attempt;\r\n    await new Promise(res => setTimeout(res, delay));\r\n    }\r\n  }\r\n  throw lastErr;\r\n}","import { ROLES } from './contratoUtils';\r\n\r\nexport function puedeEditarHorarios(usuario) {\r\n  if (!usuario) return false;\r\n  return [ROLES.ADMINISTRADOR, ROLES.MODIFICADOR].includes(usuario.rol);\r\n}\r\n\r\nexport function puedeEliminarHorarios(usuario) {\r\n  if (!usuario) return false;\r\n  return [ROLES.ADMINISTRADOR, ROLES.MODIFICADOR].includes(usuario.rol);\r\n}\r\n\r\nexport function puedeModificarHorarios(usuarioActual, usuarioObjetivo) {\r\n  if (!usuarioActual || !usuarioObjetivo) return false;\r\n  // Admin puede modificar todos, Modificador solo su propio y su departamento\r\n  if (usuarioActual.rol === ROLES.ADMINISTRADOR) return true;\r\n  if (usuarioActual.rol === ROLES.MODIFICADOR) {\r\n    return usuarioActual.id === usuarioObjetivo.id ||\r\n      usuarioActual.departamento === usuarioObjetivo.departamento;\r\n  }\r\n  return usuarioActual.id === usuarioObjetivo.id;\r\n}\r\n","import React from 'react';\r\nimport { Dialog, DialogTitle, DialogContent, DialogActions, Typography, Button, FormControl, InputLabel, Select, MenuItem, Box, Slide, TextField } from '@mui/material';\r\nimport TimeInput from './TimeInput';\r\nimport { eliminarHorarioDeUsuario } from '../../services/firebaseHorarios';\r\nimport { puedeModificarHorarios } from '../../utils/permissionsUtils';\r\n\r\nconst DialogoHorario = ({\r\n  dialogoHorario,\r\n  setDialogoHorario,\r\n  horarioPersonalizado,\r\n  setHorarioPersonalizado,\r\n  guardarHorarioPersonalizado,\r\n  isMobile,\r\n  isSmallMobile,\r\n  currentUser,\r\n  usuarios = [],\r\n  editando = false,\r\n  horariosEditados,\r\n  setHorariosEditados,\r\n  horarios,\r\n  setHorarios,\r\n  semanaSeleccionada,\r\n  obtenerClaveSemana\r\n}) => {\r\n  // Obtener usuario objetivo (el dueo del horario mostrado en el modal)\r\n  const usuarioObjetivo = usuarios.find(u => u.id === horarioPersonalizado.usuarioId) || { id: horarioPersonalizado.usuarioId };\r\n  // Permiso para eliminar/modificar\r\n  const puedeEliminar = puedeModificarHorarios(currentUser, usuarioObjetivo);\r\n  // DEBUG: Mostrar en consola los datos clave para depuracin de permisos\r\n  console.log('DEBUG - currentUser:', currentUser);\r\n  console.log('DEBUG - usuarioObjetivo:', usuarioObjetivo);\r\n  console.log('DEBUG - puedeEliminar:', puedeEliminar);\r\n\r\n  // Al abrir el modal o cambiar de usuario/da, inicializa desde datos existentes pero no borres lo ya tipeado\r\n  React.useEffect(() => {\r\n    if (!(dialogoHorario && horarioPersonalizado.usuarioId && horarioPersonalizado.diaKey)) return;\r\n    const usuarioId = horarioPersonalizado.usuarioId;\r\n    const diaKey = horarioPersonalizado.diaKey;\r\n    let horarioActual = null;\r\n    if (editando && horariosEditados) {\r\n      horarioActual = horariosEditados[usuarioId]?.[diaKey];\r\n    } else if (horarios) {\r\n      horarioActual = horarios[usuarioId]?.[diaKey];\r\n    }\r\n    setHorarioPersonalizado(prev => {\r\n      // Si hay un horario guardado, salo como base; si no, respeta lo que el usuario ya escribi\r\n      if (horarioActual) {\r\n        return {\r\n          ...prev,\r\n          tipo: horarioActual?.tipo || 'personalizado',\r\n          horaInicio: horarioActual?.horaInicio || '',\r\n          horaFin: horarioActual?.horaFin || '',\r\n          horaInicioLibre: horarioActual?.horaInicioLibre || '',\r\n          horaFinLibre: horarioActual?.horaFinLibre || '',\r\n          nota: horarioActual?.nota || ''\r\n        };\r\n      }\r\n      // No sobrescribir con vacos si no hay horario previo\r\n      return { ...prev, tipo: prev.tipo || 'personalizado' };\r\n    });\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [dialogoHorario, horarioPersonalizado.usuarioId, horarioPersonalizado.diaKey]);\r\n\r\n  const handleTimeChange = (field, value) => {\r\n    setHorarioPersonalizado(prev => ({\r\n      ...prev,\r\n      [field]: value\r\n    }));\r\n  };\r\n\r\n  const tipo = horarioPersonalizado.tipo || 'personalizado';\r\n  const horasLaboradas = (() => {\r\n    if (!horarioPersonalizado.horaInicio || !horarioPersonalizado.horaFin) return 0;\r\n    const [h1, m1] = horarioPersonalizado.horaInicio.split(':').map(Number);\r\n    const [h2, m2] = horarioPersonalizado.horaFin.split(':').map(Number);\r\n    return ((h2 * 60 + m2) - (h1 * 60 + m1)) / 60;\r\n  })();\r\n\r\n\r\n  // Eliminar horario: limpia los campos y elimina en la base de datos\r\n  const handleEliminarHorario = async () => {\r\n    // Eliminar en la base de datos si hay usuario y da\r\n    if (horarioPersonalizado.usuarioId && horarioPersonalizado.diaKey && semanaSeleccionada && obtenerClaveSemana) {\r\n      try {\r\n        const semanaKey = obtenerClaveSemana(semanaSeleccionada);\r\n        await eliminarHorarioDeUsuario(semanaKey, horarioPersonalizado.usuarioId, horarioPersonalizado.diaKey);\r\n        // Actualizar el estado local segn si est editando o no\r\n        if (editando && setHorariosEditados) {\r\n          setHorariosEditados(prev => {\r\n            const nuevos = { ...prev };\r\n            if (nuevos[horarioPersonalizado.usuarioId]) {\r\n              delete nuevos[horarioPersonalizado.usuarioId][horarioPersonalizado.diaKey];\r\n              // Si el usuario ya no tiene das, elimina la clave del usuario\r\n              if (Object.keys(nuevos[horarioPersonalizado.usuarioId]).length === 0) {\r\n                delete nuevos[horarioPersonalizado.usuarioId];\r\n              }\r\n            }\r\n            return { ...nuevos };\r\n          });\r\n        } else if (setHorarios) {\r\n          setHorarios(prev => {\r\n            const nuevos = { ...prev };\r\n            if (nuevos[horarioPersonalizado.usuarioId]) {\r\n              delete nuevos[horarioPersonalizado.usuarioId][horarioPersonalizado.diaKey];\r\n              if (Object.keys(nuevos[horarioPersonalizado.usuarioId]).length === 0) {\r\n                delete nuevos[horarioPersonalizado.usuarioId];\r\n              }\r\n            }\r\n            return { ...nuevos };\r\n          });\r\n        }\r\n      } catch (error) {\r\n        // Puedes mostrar un mensaje de error si lo deseas\r\n        // console.error('Error eliminando horario en la base de datos:', error);\r\n      }\r\n    }\r\n    // Limpiar campos del modal\r\n    setHorarioPersonalizado(prev => ({\r\n      ...prev,\r\n      tipo: 'personalizado',\r\n      horaInicio: '',\r\n      horaFin: '',\r\n      horaInicioLibre: '',\r\n      horaFinLibre: '',\r\n      nota: ''\r\n    }));\r\n    // Cerrar el modal despus de eliminar\r\n    if (typeof setDialogoHorario === 'function') setDialogoHorario(false);\r\n  };\r\n\r\n  return (\r\n    <Dialog \r\n      open={dialogoHorario} \r\n      onClose={() => setDialogoHorario(false)}\r\n      fullScreen={isSmallMobile}\r\n      maxWidth={isMobile ? 'sm' : 'md'}\r\n      fullWidth\r\n      TransitionComponent={Slide}\r\n      TransitionProps={{ direction: 'up' }}\r\n    >\r\n      <DialogTitle sx={{ \r\n        fontSize: isMobile ? '1.1rem' : '1.25rem',\r\n        pb: isMobile ? 1 : 2\r\n      }}>\r\n        Asignar Horario\r\n      </DialogTitle>\r\n      <DialogContent sx={{ pb: isMobile ? 1 : 2 }}>\r\n        <Box sx={{ mt: 2 }}>\r\n          <FormControl fullWidth sx={{ mb: 2 }}>\r\n            <InputLabel>Tipo de asignacin</InputLabel>\r\n            <Select\r\n              value={tipo}\r\n              onChange={(e) => {\r\n                const nuevoTipo = e.target.value;\r\n                // Si selecciona viaje-trabajo, asigna por defecto 08:00-18:00 y 10h\r\n                if (nuevoTipo === 'viaje-trabajo') {\r\n                  setHorarioPersonalizado(prev => ({\r\n                    ...prev,\r\n                    tipo: 'viaje-trabajo',\r\n                    horaInicio: '08:00',\r\n                    horaFin: '18:00',\r\n                    horas: 10\r\n                  }));\r\n                } else {\r\n                  handleTimeChange('tipo', nuevoTipo);\r\n                }\r\n              }}\r\n              size={isMobile ? 'small' : 'medium'}\r\n            >\r\n              <MenuItem value=\"personalizado\">Presencial</MenuItem>\r\n              <MenuItem value=\"teletrabajo\">Teletrabajo</MenuItem>\r\n              <MenuItem value=\"tele-presencial\">Teletrabajo & Presencial</MenuItem>\r\n              <MenuItem value=\"cambio\">Cambio</MenuItem>\r\n              <MenuItem value=\"descanso\">Descanso</MenuItem>\r\n              <MenuItem value=\"vacaciones\">Vacaciones</MenuItem>\r\n              <MenuItem value=\"feriado\">Feriado</MenuItem>\r\n              <MenuItem value=\"permiso\">Permiso Otorgado por Jefatura</MenuItem>\r\n              <MenuItem value=\"dia-brigada\">Da por Brigada</MenuItem>\r\n              <MenuItem value=\"tarde-libre\">Tarde Libre</MenuItem>\r\n              <MenuItem value=\"fuera-oficina\">Fuera de Oficina</MenuItem>\r\n              <MenuItem value=\"viaje-trabajo\">Viaje de Trabajo</MenuItem>\r\n              <MenuItem value=\"incapacidad-enfermedad\">Incapacidad por Enfermedad</MenuItem>\r\n              <MenuItem value=\"incapacidad-accidente\">Incapacidad por Accidente</MenuItem>\r\n            </Select>\r\n          </FormControl>\r\n\r\n          {tipo === 'viaje-trabajo' ? null\r\n          : tipo === 'tarde-libre' ? (\r\n            <>\r\n              <Typography variant=\"subtitle2\" sx={{ mt: 1, mb: 1 }}>\r\n                Presencial\r\n              </Typography>\r\n              <TimeInput\r\n                label=\"Hora de inicio trabajo\"\r\n                value={horarioPersonalizado.horaInicio}\r\n                onChange={(e) => handleTimeChange('horaInicio', e.target.value)}\r\n                isMobile={isMobile}\r\n              />\r\n              <TimeInput\r\n                label=\"Hora de fin trabajo\"\r\n                value={horarioPersonalizado.horaFin}\r\n                onChange={(e) => handleTimeChange('horaFin', e.target.value)}\r\n                isMobile={isMobile}\r\n              />\r\n              <Typography variant=\"subtitle2\" sx={{ mt: 2, mb: 1 }}>\r\n                Tiempo Libre\r\n              </Typography>\r\n              <TimeInput\r\n                label=\"Inicio tarde libre\"\r\n                value={horarioPersonalizado.horaInicioLibre}\r\n                onChange={(e) => handleTimeChange('horaInicioLibre', e.target.value)}\r\n                isMobile={isMobile}\r\n              />\r\n              <TimeInput\r\n                label=\"Fin tarde libre\"\r\n                value={horarioPersonalizado.horaFinLibre}\r\n                onChange={(e) => handleTimeChange('horaFinLibre', e.target.value)}\r\n                isMobile={isMobile}\r\n              />\r\n              <Typography variant=\"body2\" sx={{ fontWeight: 'bold', mt: 1 }}>\r\n                Horas laboradas: {horasLaboradas.toFixed(1)}h\r\n              </Typography>\r\n            </>\r\n          ) : tipo === 'tele-presencial' ? (\r\n            <>\r\n              <Typography variant=\"subtitle2\" sx={{ mt: 1, mb: 1 }}>\r\n                Teletrabajo\r\n              </Typography>\r\n              <TimeInput\r\n                label=\"Inicio Teletrabajo\"\r\n                value={horarioPersonalizado.horaInicioTele || ''}\r\n                onChange={(e) => handleTimeChange('horaInicioTele', e.target.value)}\r\n                isMobile={isMobile}\r\n              />\r\n              <TimeInput\r\n                label=\"Fin Teletrabajo\"\r\n                value={horarioPersonalizado.horaFinTele || ''}\r\n                onChange={(e) => handleTimeChange('horaFinTele', e.target.value)}\r\n                isMobile={isMobile}\r\n              />\r\n\r\n              <Typography variant=\"subtitle2\" sx={{ mt: 2, mb: 1 }}>\r\n                Presencial\r\n              </Typography>\r\n              <TimeInput\r\n                label=\"Inicio Presencial\"\r\n                value={horarioPersonalizado.horaInicioPres || ''}\r\n                onChange={(e) => handleTimeChange('horaInicioPres', e.target.value)}\r\n                isMobile={isMobile}\r\n              />\r\n              <TimeInput\r\n                label=\"Fin Presencial\"\r\n                value={horarioPersonalizado.horaFinPres || ''}\r\n                onChange={(e) => handleTimeChange('horaFinPres', e.target.value)}\r\n                isMobile={isMobile}\r\n              />\r\n\r\n              {/* Mostrar horas calculadas */}\r\n              <Typography variant=\"body2\" sx={{ fontWeight: 'bold', mt: 1 }}>\r\n                Horas Teletrabajo: {(() => {\r\n                  const s = horarioPersonalizado.horaInicioTele;\r\n                  const e = horarioPersonalizado.horaFinTele;\r\n                  if (!s || !e) return '0.0';\r\n                  try {\r\n                    const [h1, m1] = s.split(':').map(Number);\r\n                    const [h2, m2] = e.split(':').map(Number);\r\n                    let v = 0;\r\n                    if (h2 > h1 || (h2 === h1 && m2 > m1)) {\r\n                      v = (h2 - h1) + (m2 - m1) / 60;\r\n                    } else {\r\n                      v = (24 - h1 + h2) + (m2 - m1) / 60;\r\n                    }\r\n                    return v.toFixed(1) + 'h';\r\n                  } catch { return '0.0'; }\r\n                })()}\r\n              </Typography>\r\n              <Typography variant=\"body2\" sx={{ fontWeight: 'bold', mt: 0.5 }}>\r\n                Horas Presencial: {(() => {\r\n                  const s = horarioPersonalizado.horaInicioPres;\r\n                  const e = horarioPersonalizado.horaFinPres;\r\n                  if (!s || !e) return '0.0';\r\n                  try {\r\n                    const [h1, m1] = s.split(':').map(Number);\r\n                    const [h2, m2] = e.split(':').map(Number);\r\n                    let v = 0;\r\n                    if (h2 > h1 || (h2 === h1 && m2 > m1)) {\r\n                      v = (h2 - h1) + (m2 - m1) / 60;\r\n                    } else {\r\n                      v = (24 - h1 + h2) + (m2 - m1) / 60;\r\n                    }\r\n                    return v.toFixed(1) + 'h';\r\n                  } catch { return '0.0'; }\r\n                })()}\r\n              </Typography>\r\n              <Typography variant=\"body2\" sx={{ fontWeight: 'bold', mt: 0.5 }}>\r\n                Total: {(() => {\r\n                  // Reusar clculos anteriores\r\n                  const calc = (s, e) => {\r\n                    if (!s || !e) return 0;\r\n                    const [h1, m1] = s.split(':').map(Number);\r\n                    const [h2, m2] = e.split(':').map(Number);\r\n                    let v = 0;\r\n                    if (h2 > h1 || (h2 === h1 && m2 > m1)) {\r\n                      v = (h2 - h1) + (m2 - m1) / 60;\r\n                    } else {\r\n                      v = (24 - h1 + h2) + (m2 - m1) / 60;\r\n                    }\r\n                    return v;\r\n                  };\r\n                  const tele = calc(horarioPersonalizado.horaInicioTele, horarioPersonalizado.horaFinTele);\r\n                  const pres = calc(horarioPersonalizado.horaInicioPres, horarioPersonalizado.horaFinPres);\r\n                  return (tele + pres).toFixed(1) + 'h';\r\n                })()}\r\n              </Typography>\r\n            </>\r\n          ) : tipo !== 'descanso' && tipo !== 'vacaciones' && tipo !== 'feriado' && tipo !== 'permiso' && tipo !== 'dia-brigada' && tipo !== 'incapacidad-enfermedad' && tipo !== 'incapacidad-accidente' ? (\r\n            <>\r\n              <TimeInput\r\n                label=\"Hora de inicio\"\r\n                value={horarioPersonalizado.horaInicio}\r\n                onChange={(e) => handleTimeChange('horaInicio', e.target.value)}\r\n                isMobile={isMobile}\r\n              />\r\n              <TimeInput\r\n                label=\"Hora de fin\"\r\n                value={horarioPersonalizado.horaFin}\r\n                onChange={(e) => handleTimeChange('horaFin', e.target.value)}\r\n                isMobile={isMobile}\r\n              />\r\n              <Typography variant=\"body2\" sx={{ fontWeight: 'bold', mt: 1 }}>\r\n                Horas laboradas: {horasLaboradas.toFixed(1)}h\r\n              </Typography>\r\n            </>\r\n          ) : null}\r\n\r\n          {/* Campo para nota */}\r\n          <TextField\r\n            label=\"Nota (opcional)\"\r\n            value={horarioPersonalizado.nota || ''}\r\n            onChange={e => setHorarioPersonalizado(prev => ({ ...prev, nota: e.target.value }))}\r\n            fullWidth\r\n            multiline\r\n            minRows={1}\r\n            maxRows={3}\r\n            sx={{ mt: 2 }}\r\n            size={isMobile ? 'small' : 'medium'}\r\n          />\r\n        </Box>\r\n      </DialogContent>\r\n      <DialogActions sx={{ \r\n        p: isMobile ? 2 : 3,\r\n        flexDirection: isSmallMobile ? 'column' : 'row',\r\n        gap: isSmallMobile ? 1 : 0\r\n      }}>\r\n        <Button \r\n          onClick={() => setDialogoHorario(false)}\r\n          fullWidth={isSmallMobile}\r\n          size={isMobile ? 'medium' : 'large'}\r\n        >\r\n          Cancelar\r\n        </Button>\r\n        <Button\r\n          onClick={handleEliminarHorario}\r\n          color=\"error\"\r\n          variant=\"outlined\"\r\n          fullWidth={isSmallMobile}\r\n          size={isMobile ? 'medium' : 'large'}\r\n          sx={{ ml: isSmallMobile ? 0 : 1 }}\r\n          disabled={!puedeEliminar}\r\n        >\r\n          Eliminar\r\n        </Button>\r\n        <Button \r\n          onClick={guardarHorarioPersonalizado} \r\n          variant=\"contained\"\r\n          fullWidth={isSmallMobile}\r\n          size={isMobile ? 'medium' : 'large'}\r\n        >\r\n          Guardar\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n};\r\nexport default DialogoHorario;\r\n","import React from 'react';\r\nimport { Dialog, DialogTitle, DialogContent, DialogActions, Typography, Button, FormControl, InputLabel, Select, MenuItem, Box, Alert, Grid } from '@mui/material';\r\n\r\nconst diasSemana = ['Lunes', 'Martes', 'Mircoles', 'Jueves', 'Viernes', 'Sbado', 'Domingo'];\r\n\r\nconst DialogoEliminar = ({\r\n  dialogoEliminar,\r\n  setDialogoEliminar,\r\n  eliminacionSeleccionada,\r\n  setEliminacionSeleccionada,\r\n  handleEliminarSeleccionado,\r\n  currentUser,\r\n  usuarios,\r\n  horarios,\r\n  isMobile,\r\n  isSmallMobile\r\n}) => {\r\n  const usuarioActual = usuarios?.find(u => u.id === currentUser?.uid);\r\n  const esAdministrador = usuarioActual?.rol === 'Administrador';\r\n\r\n  // Funcin para manejar seleccin/deseleccin de das\r\n  const toggleDiaSeleccionado = (diaKey) => {\r\n    setEliminacionSeleccionada(prev => ({\r\n      ...prev,\r\n      diasSeleccionados: prev.diasSeleccionados.includes(diaKey)\r\n        ? prev.diasSeleccionados.filter(d => d !== diaKey)\r\n        : [...prev.diasSeleccionados, diaKey]\r\n    }));\r\n  };\r\n\r\n  // Reset campos relevantes al abrir el dilogo\r\n  React.useEffect(() => {\r\n    if (dialogoEliminar) {\r\n      setEliminacionSeleccionada(prev => ({\r\n        ...prev,\r\n        usuarioId: null,\r\n        dia: null,\r\n        diasSeleccionados: [],\r\n        // tipo: prev.tipo // No forzar tipo, mantener el ltimo seleccionado\r\n      }));\r\n    }\r\n    // eslint-disable-next-line\r\n  }, [dialogoEliminar]);\r\n\r\n  // Obtener los horarios del usuario actual para mostrar qu das puede eliminar\r\n  const horariosUsuarioActual = horarios[currentUser?.uid] || {};\r\n  const diasConHorarios = Object.keys(horariosUsuarioActual);\r\n\r\n  return (\r\n    <Dialog \r\n      open={dialogoEliminar} \r\n      onClose={() => setDialogoEliminar(false)}\r\n      fullScreen={isSmallMobile}\r\n      maxWidth={isMobile ? 'sm' : 'md'}\r\n      fullWidth\r\n    >\r\n      <DialogTitle>\r\n        Eliminar Horarios\r\n      </DialogTitle>\r\n      <DialogContent>\r\n        <Box sx={{ mt: 2 }}>\r\n          <FormControl fullWidth>\r\n            <InputLabel>Tipo de eliminacin</InputLabel>\r\n            <Select\r\n              value={eliminacionSeleccionada.tipo}\r\n              onChange={(e) => {\r\n                setEliminacionSeleccionada(prev => ({ \r\n                  ...prev, \r\n                  tipo: e.target.value,\r\n                  diasSeleccionados: [],\r\n                  usuarioId: null,\r\n                  dia: null\r\n                }));\r\n              }}\r\n              size={isMobile ? 'small' : 'medium'}\r\n            >\r\n              <MenuItem value=\"mis-dias\">Mis das especficos</MenuItem>\r\n              {esAdministrador && (\r\n                <>\r\n                  <MenuItem value=\"todo\">Todos los horarios (Solo Admin)</MenuItem>\r\n                  <MenuItem value=\"usuario\">Por usuario (Solo Admin)</MenuItem>\r\n                  <MenuItem value=\"dia\">Por da completo (Solo Admin)</MenuItem>\r\n                </>\r\n              )}\r\n            </Select>\r\n          </FormControl>\r\n\r\n          {!esAdministrador && (\r\n            <Alert severity=\"info\" sx={{ mt: 2 }}>\r\n              <Typography variant=\"body2\">\r\n                Solo puedes eliminar tus propios horarios. Los administradores tienen permisos adicionales.\r\n              </Typography>\r\n            </Alert>\r\n          )}\r\n\r\n          {eliminacionSeleccionada.tipo === 'mis-dias' && (\r\n            <Box sx={{ mt: 2 }}>\r\n              <Typography variant=\"subtitle2\" sx={{ mb: 2, fontWeight: 'bold' }}>\r\n                Selecciona los das que deseas eliminar:\r\n              </Typography>\r\n              \r\n              {diasConHorarios.length === 0 ? (\r\n                <Alert severity=\"warning\">\r\n                  <Typography variant=\"body2\">\r\n                    No tienes horarios asignados en esta semana.\r\n                  </Typography>\r\n                </Alert>\r\n              ) : (\r\n                <Grid container spacing={1}>\r\n                  {diasSemana.map((dia, index) => {\r\n                    const diaKey = `dia${index + 1}`;\r\n                    const tieneHorario = diasConHorarios.includes(diaKey);\r\n                    const estaSeleccionado = eliminacionSeleccionada.diasSeleccionados.includes(diaKey);\r\n                    \r\n                    return (\r\n                      <Grid item xs={12} sm={6} md={4} key={diaKey}>\r\n                        <Button\r\n                          variant={estaSeleccionado ? \"contained\" : \"outlined\"}\r\n                          sx={{\r\n                            backgroundColor: estaSeleccionado ? '#d32f2f' : 'transparent',\r\n                            color: estaSeleccionado ? 'white' : 'inherit',\r\n                            borderColor: estaSeleccionado ? '#d32f2f' : 'rgba(0, 0, 0, 0.23)',\r\n                            '&:hover': {\r\n                              backgroundColor: estaSeleccionado ? '#b71c1c' : 'rgba(211, 47, 47, 0.04)',\r\n                              borderColor: '#d32f2f'\r\n                            }\r\n                          }}\r\n                          fullWidth\r\n                          disabled={!tieneHorario}\r\n                          onClick={() => toggleDiaSeleccionado(diaKey)}\r\n                        >\r\n                          {dia} {!tieneHorario && '(Sin horario)'}\r\n                        </Button>\r\n                      </Grid>\r\n                    );\r\n                  })}\r\n                </Grid>\r\n              )}\r\n\r\n              {eliminacionSeleccionada.diasSeleccionados.length > 0 && (\r\n                <Alert severity=\"warning\" sx={{ mt: 2 }}>\r\n                  <Typography variant=\"body2\">\r\n                    Se eliminarn los horarios de: {eliminacionSeleccionada.diasSeleccionados.map(dia => {\r\n                      const diaIndex = parseInt(dia.replace('dia', '')) - 1;\r\n                      return diasSemana[diaIndex];\r\n                    }).join(', ')}\r\n                  </Typography>\r\n                </Alert>\r\n              )}\r\n            </Box>\r\n          )}\r\n\r\n          {esAdministrador && eliminacionSeleccionada.tipo === 'usuario' && (\r\n            <FormControl fullWidth sx={{ mt: 2 }}>\r\n              <InputLabel>Usuario</InputLabel>\r\n              <Select\r\n                value={eliminacionSeleccionada.usuarioId || ''}\r\n                onChange={(e) => setEliminacionSeleccionada(prev => ({ ...prev, usuarioId: e.target.value }))}\r\n                size={isMobile ? 'small' : 'medium'}\r\n              >\r\n                {usuarios.map(usuario => (\r\n                  <MenuItem key={usuario.id} value={usuario.id}>\r\n                    {usuario.nombre} {usuario.apellidos}\r\n                    {usuario.id === currentUser?.uid && ' (T)'}\r\n                  </MenuItem>\r\n                ))}\r\n              </Select>\r\n            </FormControl>\r\n          )}\r\n\r\n          {esAdministrador && eliminacionSeleccionada.tipo === 'dia' && (\r\n            <FormControl fullWidth sx={{ mt: 2 }}>\r\n              <InputLabel>Da</InputLabel>\r\n              <Select\r\n                value={eliminacionSeleccionada.dia || ''}\r\n                onChange={(e) => setEliminacionSeleccionada(prev => ({ ...prev, dia: e.target.value }))}\r\n                size={isMobile ? 'small' : 'medium'}\r\n              >\r\n                {diasSemana.map((dia, index) => (\r\n                  <MenuItem key={dia} value={`dia${index + 1}`}>\r\n                    {dia}\r\n                  </MenuItem>\r\n                ))}\r\n              </Select>\r\n            </FormControl>\r\n          )}\r\n\r\n          {esAdministrador && eliminacionSeleccionada.tipo === 'todo' && (\r\n            <Alert severity=\"error\" sx={{ mt: 2 }}>\r\n              <Typography variant=\"body2\" sx={{ fontWeight: 'bold' }}>\r\n                 Esta accin eliminar TODOS los horarios de TODOS los usuarios para esta semana.\r\n              </Typography>\r\n            </Alert>\r\n          )}\r\n        </Box>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button \r\n          onClick={() => setDialogoEliminar(false)}\r\n        >\r\n          Cancelar\r\n        </Button>\r\n        <Button \r\n          onClick={handleEliminarSeleccionado} \r\n          variant=\"contained\" \r\n          sx={{\r\n            backgroundColor: '#d32f2f',\r\n            '&:hover': {\r\n              backgroundColor: '#b71c1c'\r\n            }\r\n          }}\r\n          disabled={\r\n            (eliminacionSeleccionada.tipo === 'mis-dias' && eliminacionSeleccionada.diasSeleccionados.length === 0) ||\r\n            (eliminacionSeleccionada.tipo === 'usuario' && (!eliminacionSeleccionada.usuarioId || eliminacionSeleccionada.usuarioId === '')) ||\r\n            (eliminacionSeleccionada.tipo === 'dia' && (!eliminacionSeleccionada.dia || eliminacionSeleccionada.dia === ''))\r\n          }\r\n        >\r\n          Eliminar\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default DialogoEliminar;\r\n","import React from 'react';\r\nimport { Dialog, DialogTitle, DialogContent, DialogActions, Typography, Button, Box, Alert, Grid } from '@mui/material';\r\n\r\nconst diasSemana = ['Lunes', 'Martes', 'Mircoles', 'Jueves', 'Viernes', 'Sbado', 'Domingo'];\r\nconst diasKeys = ['dia1', 'dia2', 'dia3', 'dia4', 'dia5', 'dia6', 'dia7'];\r\nconst TIPO_LABEL = {\r\n  personalizado: 'Presencial',\r\n  teletrabajo: 'Teletrabajo',\r\n  cambio: 'Cambio',\r\n  descanso: 'Descanso',\r\n  vacaciones: 'Vacaciones',\r\n  feriado: 'Feriado',\r\n  permiso: 'Permiso Otorgado por Jefatura',\r\n  'tarde-libre': 'Tarde Libre',\r\n  'dia-brigada': 'Da por Brigada'\r\n};\r\n\r\nconst DialogoCopiar = ({\r\n  dialogoCopiar,\r\n  setDialogoCopiar,\r\n  horarioACopiar,\r\n  setHorarioACopiar,\r\n  ejecutarCopiarHorario,\r\n  editando,\r\n  horariosEditados,\r\n  horarios\r\n}) => {\r\n  if (!horarioACopiar) return null;\r\n\r\n  const handleSeleccionarDia = (diaKey) => {\r\n    ejecutarCopiarHorario(diaKey);\r\n  };\r\n\r\n  return (\r\n    <Dialog \r\n      open={dialogoCopiar} \r\n      onClose={() => {\r\n        setDialogoCopiar(false);\r\n        setHorarioACopiar(null);\r\n      }}\r\n      fullWidth\r\n      maxWidth=\"sm\"\r\n    >\r\n      <DialogTitle>\r\n        Copiar Horario\r\n      </DialogTitle>\r\n      <DialogContent>\r\n        <Box sx={{ mt: 2 }}>\r\n          <Typography variant=\"subtitle1\" sx={{ mb: 2, fontWeight: 'bold' }}>\r\n            Horario a copiar: {TIPO_LABEL[horarioACopiar.tipo] || horarioACopiar.tipo}\r\n          </Typography>\r\n          \r\n          {horarioACopiar.horaInicio && horarioACopiar.horaFin && (\r\n            <Typography variant=\"body2\" sx={{ mb: 2, color: 'text.secondary' }}>\r\n              Horario: {horarioACopiar.horaInicio} - {horarioACopiar.horaFin} ({horarioACopiar.horas?.toFixed(1)}h)\r\n            </Typography>\r\n          )}\r\n\r\n          <Typography variant=\"subtitle2\" sx={{ mb: 2, fontWeight: 'bold' }}>\r\n            Selecciona el da destino:\r\n          </Typography>\r\n          \r\n          <Grid container spacing={1}>\r\n            {diasSemana.map((dia, index) => {\r\n              const diaKey = diasKeys[index];\r\n              const horariosUsuario = editando ? horariosEditados[horarioACopiar.usuarioId] : horarios[horarioACopiar.usuarioId];\r\n              const yaOcupado = horariosUsuario?.[diaKey] && horariosUsuario[diaKey].tipo !== 'libre';\r\n              const esDiaOriginal = diaKey === horarioACopiar.diaOriginal;\r\n              \r\n              return (\r\n                <Grid item xs={12} sm={6} md={4} key={diaKey}>\r\n                  <Button\r\n                    variant={yaOcupado ? \"outlined\" : \"contained\"}\r\n                    fullWidth\r\n                    disabled={esDiaOriginal}\r\n                    onClick={() => handleSeleccionarDia(diaKey)}\r\n                    sx={{\r\n                      backgroundColor: yaOcupado ? 'transparent' : '#1976d2',\r\n                      color: yaOcupado ? '#1976d2' : 'white',\r\n                      borderColor: yaOcupado ? '#ff9800' : '#1976d2',\r\n                      '&:hover': {\r\n                        backgroundColor: yaOcupado ? 'rgba(255, 152, 0, 0.04)' : '#1565c0',\r\n                        borderColor: yaOcupado ? '#ff9800' : '#1565c0'\r\n                      },\r\n                      '&:disabled': {\r\n                        backgroundColor: '#f5f5f5',\r\n                        color: '#999',\r\n                        borderColor: '#ddd'\r\n                      }\r\n                    }}\r\n                  >\r\n                    {dia}\r\n                    {esDiaOriginal && ' (Original)'}\r\n                    {yaOcupado && !esDiaOriginal && ' (Ocupado)'}\r\n                  </Button>\r\n                </Grid>\r\n              );\r\n            })}\r\n          </Grid>\r\n\r\n          <Alert severity=\"info\" sx={{ mt: 2 }}>\r\n            <Typography variant=\"body2\">\r\n               Los das marcados como \"Ocupado\" ya tienen un horario asignado\r\n            </Typography>\r\n            <Typography variant=\"body2\">\r\n               Seleccionar un da ocupado reemplazar el horario existente\r\n            </Typography>\r\n            <Typography variant=\"body2\">\r\n               El da original est deshabilitado para evitar copia sobre s mismo\r\n            </Typography>\r\n          </Alert>\r\n        </Box>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button \r\n          onClick={() => {\r\n            setDialogoCopiar(false);\r\n            setHorarioACopiar(null);\r\n          }}\r\n        >\r\n          Cancelar\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default DialogoCopiar;\r\n","import React from 'react';\r\nimport { Dialog, DialogContent, DialogActions, Typography, Button, Slide } from '@mui/material';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport ErrorIcon from '@mui/icons-material/Error';\r\nimport WarningIcon from '@mui/icons-material/Warning';\r\nimport InfoIcon from '@mui/icons-material/Info';\r\nimport { useTheme, useMediaQuery } from '@mui/material';\r\n\r\nconst ModalConfirmacion = ({\r\n  modalConfirmacion,\r\n  cerrarModalConfirmacion\r\n}) => {\r\n  const theme = useTheme();\r\n  const isMobile = useMediaQuery(theme.breakpoints.down('md'));\r\n  const isSmallMobile = useMediaQuery(theme.breakpoints.down('sm'));\r\n\r\n  const { abierto, tipo, titulo, mensaje, textoConfirmar, textoCancelar, onConfirmar, onCancelar, soloInfo } = modalConfirmacion;\r\n\r\n    // Iconos segn el tipo\r\n    const iconos = {\r\n      success: <CheckCircleIcon sx={{ color: '#4caf50', fontSize: 40, mb: 2 }} />,\r\n      error: <ErrorIcon sx={{ color: '#f44336', fontSize: 40, mb: 2 }} />,\r\n      warning: <WarningIcon sx={{ color: '#ff9800', fontSize: 40, mb: 2 }} />,\r\n      info: <InfoIcon sx={{ color: '#2196f3', fontSize: 40, mb: 2 }} />\r\n    };\r\n\r\n    return (\r\n      <Dialog\r\n        open={abierto}\r\n        onClose={soloInfo ? cerrarModalConfirmacion : (onCancelar || cerrarModalConfirmacion)}\r\n        fullScreen={isSmallMobile}\r\n        maxWidth={isMobile ? 'sm' : 'md'}\r\n        fullWidth\r\n        TransitionComponent={Slide}\r\n        TransitionProps={{ direction: 'up' }}\r\n      >\r\n        <DialogContent sx={{ \r\n          textAlign: 'center', \r\n          pt: 4, \r\n          pb: 2,\r\n          px: isMobile ? 2 : 4\r\n        }}>\r\n          {iconos[tipo]}\r\n          \r\n          <Typography \r\n            variant={isMobile ? 'h6' : 'h5'} \r\n            sx={{ \r\n              fontWeight: 'bold', \r\n              mb: 2,\r\n              color: 'text.primary'\r\n            }}\r\n          >\r\n            {titulo}\r\n          </Typography>\r\n          \r\n          <Typography \r\n            variant=\"body1\" \r\n            sx={{ \r\n              color: 'text.secondary',\r\n              whiteSpace: 'pre-line',\r\n              lineHeight: 1.6\r\n            }}\r\n          >\r\n            {mensaje}\r\n          </Typography>\r\n        </DialogContent>\r\n        \r\n        <DialogActions sx={{ \r\n          justifyContent: 'center', \r\n          gap: 2, \r\n          pb: 3,\r\n          px: 3,\r\n          flexDirection: isSmallMobile ? 'column' : 'row'\r\n        }}>\r\n          {!soloInfo && (\r\n            <Button \r\n              onClick={onCancelar || cerrarModalConfirmacion}\r\n              variant=\"outlined\"\r\n              size={isMobile ? 'medium' : 'large'}\r\n              fullWidth={isSmallMobile}\r\n              sx={{ minWidth: isSmallMobile ? '100%' : '120px' }}\r\n            >\r\n              {textoCancelar}\r\n            </Button>\r\n          )}\r\n          \r\n          <Button \r\n            onClick={soloInfo ? cerrarModalConfirmacion : (onConfirmar || cerrarModalConfirmacion)}\r\n            variant=\"contained\"\r\n            size={isMobile ? 'medium' : 'large'}\r\n            fullWidth={isSmallMobile}\r\n            color={tipo === 'error' ? 'error' : 'primary'}\r\n            sx={{ minWidth: isSmallMobile ? '100%' : '120px' }}\r\n          >\r\n            {soloInfo ? 'Entendido' : textoConfirmar}\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n    );\r\n};\r\n\r\nexport default ModalConfirmacion;","import React from 'react';\r\nimport { format, addDays } from 'date-fns';\r\nimport { diasSemana } from '../../utils/horariosConstants';\r\nimport {\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  DialogActions,\r\n  Button,\r\n  Typography\r\n} from '@mui/material';\r\n\r\nconst InfoTurnoModal = ({ open, onClose, usuario, turno, diaKey, semanaSeleccionada }) => {\r\n\r\n  return (\r\n    <Dialog\r\n      open={open}\r\n      onClose={onClose}\r\n      maxWidth=\"sm\"\r\n      fullWidth\r\n    >\r\n      <DialogTitle variant='strong'>Informacin del Turno</DialogTitle>\r\n      {/* Mostrar da y fecha */}\r\n      {diaKey && (\r\n        <DialogTitle  sx={{ pl: 3, pt: 0.2 }}>\r\n          {(() => {\r\n            const idx = parseInt(diaKey.replace('dia', ''), 10) - 1;\r\n            const nombre = diasSemana[idx] || '';\r\n            const fecha = format(addDays(semanaSeleccionada, idx), 'd');\r\n            return `${nombre} ${fecha}`;\r\n          })()}\r\n        </DialogTitle>\r\n      )}\r\n      <DialogContent dividers>\r\n        {usuario && (\r\n          <Typography variant=\"body1\" gutterBottom>\r\n            <strong>Usuario:</strong> {usuario.nombre} {usuario.apellidos}\r\n          </Typography>\r\n        )}\r\n        <Typography variant=\"body1\" gutterBottom>\r\n          <strong>Tipo:</strong> {(() => {\r\n            if (!turno?.tipo) return 'Descanso';\r\n            if (turno.tipo === 'personalizado') return 'Presencial';\r\n            return turno.tipo.charAt(0).toUpperCase() + turno.tipo.slice(1);\r\n          })()}\r\n        </Typography>\r\n        {turno && turno.tipo !== 'libre' && (\r\n          <>\r\n            <Typography variant=\"body1\" gutterBottom>\r\n              <strong>Horario:</strong> {turno.horaInicio} - {turno.horaFin}\r\n            </Typography>\r\n            <Typography variant=\"body1\">\r\n              <strong>Horas:</strong> {turno.horas?.toFixed(1)}h\r\n            </Typography>\r\n          </>\r\n        )}\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={onClose} variant=\"contained\" color=\"primary\">\r\n          Cerrar\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default InfoTurnoModal;\r\n","// Colores y etiquetas de roles\r\nexport const obtenerColorRol = (rol) => {\r\n  switch (rol) {\r\n    case 'Administrador':\r\n      return 'error';\r\n    case 'Modificador':\r\n      return 'warning';\r\n    case 'Visualizador':\r\n      return 'success';\r\n    default:\r\n      return 'default';\r\n  }\r\n};\r\n\r\nexport const obtenerEtiquetaRol = (rol) => {\r\n  switch (rol) {\r\n    case 'Administrador':\r\n      return 'Admin';\r\n    case 'Modificador':\r\n      return 'Mod';\r\n    case 'Visualizador':\r\n      return 'Ver';\r\n    default:\r\n      return 'Ver';\r\n  }\r\n};\r\n\r\n// Permisos\r\nexport const puedeEditarHorarios = (usuario) => {\r\n  if (!usuario) return false;\r\n  return ['Administrador', 'Modificador'].includes(usuario.rol);\r\n};\r\n\r\nexport const puedeEliminarHorarios = (usuario) => {\r\n  if (!usuario) return false;\r\n  return ['Administrador', 'Modificador'].includes(usuario.rol);\r\n};\r\n\r\n// Conversin de hora\r\nexport const convertirA24h = (hora) => {\r\n  const [h, m] = hora.split(':').map(Number);\r\n  return { hora: h, minutos: m };\r\n};\r\n\r\n// Clculo de horas totales\r\nexport const calcularHorasTotales = (\r\n  usuarioId,\r\n  editando,\r\n  horariosEditados = {},\r\n  horarios = {},\r\n  semanaSeleccionada,\r\n  semanaActual,\r\n  horasExtras,\r\n  obtenerUsuario,\r\n  obtenerHorasMaximas,\r\n  mostrarReal = false\r\n) => {\r\n  // Asegura que los objetos existen\r\n  const horariosEditadosSafe = horariosEditados || {};\r\n  const horariosSafe = horarios || {};\r\n\r\n  const horariosUsuario = editando\r\n    ? (horariosEditadosSafe[usuarioId] || {})\r\n    : (horariosSafe[usuarioId] || {});\r\n\r\n  // Si no hay horarios para el usuario, retorna 0\r\n  if (!horariosUsuario || typeof horariosUsuario !== 'object') return 0;\r\n\r\n  const NO_SUMAN_HORAS = ['descanso', 'vacaciones', 'feriado', 'permiso', 'dia-brigada'];\r\n  const total = Object.values(horariosUsuario).reduce((total, turno) => {\r\n    if (!turno || NO_SUMAN_HORAS.includes(turno.tipo)) return total;\r\n    return total + (turno.horas || 0);\r\n  }, 0);\r\n\r\n  // Si estamos en la pestaa de la semana actual, las horas totales son las horas trabajadas\r\n  if (\r\n    semanaSeleccionada && semanaActual &&\r\n    semanaSeleccionada.getTime && semanaActual.getTime &&\r\n    (semanaSeleccionada.getTime() === semanaActual.getTime() || mostrarReal)\r\n  ) {\r\n    return total;\r\n  }\r\n  \r\n  // Para la prxima semana, restamos las horas extras de la semana actual (si existen)\r\n  const horasExtrasPrevias = horasExtras[usuarioId] || 0;\r\n  const usuario = obtenerUsuario(usuarioId);\r\n  const horasMaximas = obtenerHorasMaximas(usuario?.tipoContrato || 'Operativo');\r\n  const horasMinimas = Math.min(horasMaximas - 8, 40); // Mnimo 40 horas o 8 menos que las mximas\r\n  const horasDisponibles = Math.max(horasMaximas - horasExtrasPrevias, horasMinimas);\r\n\r\n  return mostrarReal ? total : Math.min(total, horasDisponibles);\r\n};\r\n\r\n// Clculo de horas excedentes\r\nexport const calcularHorasExcedentes = (\r\n  usuarioId,\r\n  editando,\r\n  horariosEditados,\r\n  horarios,\r\n  obtenerUsuario,\r\n  obtenerHorasMaximas\r\n) => {\r\n  // Llama directamente a calcularHorasTotales con los argumentos necesarios\r\n  const horasTotales = calcularHorasTotales(usuarioId, editando, horariosEditados, horarios, null, null, {}, obtenerUsuario, obtenerHorasMaximas, true);\r\n  const usuario = obtenerUsuario(usuarioId);\r\n  const horasMaximas = obtenerHorasMaximas(usuario?.tipoContrato || 'Operativo');\r\n  return Math.max(horasTotales - horasMaximas, 0);\r\n};\r\n\r\n// Buscar practicantes disponibles\r\nexport const encontrarPracticantesDisponibles = (\r\n  horasNecesarias,\r\n  usuarios,\r\n  calcularHorasTotalesFn,\r\n  obtenerHorasMaximas,\r\n  departamentoDestino = null,\r\n  usuarioExcedidoId = null\r\n) => {\r\n  // Validaciones bsicas para evitar excepciones\r\n  const safeUsuarios = Array.isArray(usuarios) ? usuarios : [];\r\n  const safeHorasNecesarias = Number(horasNecesarias) || 0;\r\n\r\n  // Sugerir primero compaeros del mismo departamento (excepto el usuario excedido)\r\n  const compaeros = safeUsuarios.filter(usuario =>\r\n    usuario && usuario.departamento === departamentoDestino &&\r\n    usuario.id !== usuarioExcedidoId\r\n  );\r\n\r\n  const compaerosDisponibles = compaeros.map(compaero => {\r\n    const horasTotales = calcularHorasTotalesFn(compaero.id, true) || 0;\r\n    const horasMaximas = obtenerHorasMaximas(compaero.tipoContrato || 'Operativo') || 0;\r\n    const horasDisponibles = horasMaximas - horasTotales;\r\n    return {\r\n      usuario: compaero,\r\n      horasDisponibles: Number(horasDisponibles.toFixed(1)),\r\n      horasTotales: Number(horasTotales.toFixed(1)),\r\n      horasMaximas\r\n    };\r\n  }).filter(c => c.horasDisponibles >= safeHorasNecesarias);\r\n\r\n  // Luego practicantes autorizados para el departamento\r\n  const practicantes = safeUsuarios.filter(usuario =>\r\n    usuario && usuario.departamento === 'Practicantes/Crosstraining' &&\r\n    (!departamentoDestino || (usuario.departamentosAutorizados && Array.isArray(usuario.departamentosAutorizados) && usuario.departamentosAutorizados.includes(departamentoDestino)))\r\n  );\r\n\r\n  const practicantesDisponibles = practicantes.map(practicante => {\r\n    const horasTotales = calcularHorasTotalesFn(practicante.id, true) || 0;\r\n    const horasMaximas = obtenerHorasMaximas(practicante.tipoContrato || 'Operativo') || 0;\r\n    const horasDisponibles = horasMaximas - horasTotales;\r\n    return {\r\n      usuario: practicante,\r\n      horasDisponibles: Number(horasDisponibles.toFixed(1)),\r\n      horasTotales: Number(horasTotales.toFixed(1)),\r\n      horasMaximas\r\n    };\r\n  }).filter(p => p.horasDisponibles >= safeHorasNecesarias);\r\n\r\n  // Junta ambos grupos, primero compaeros, luego practicantes\r\n  return [\r\n    ...compaerosDisponibles.sort((a, b) => b.horasDisponibles - a.horasDisponibles),\r\n    ...practicantesDisponibles.sort((a, b) => b.horasDisponibles - a.horasDisponibles)\r\n  ];\r\n};\r\n\r\n// Generar mensaje de recomendacin de practicantes\r\nexport const generarRecomendacionPracticantes = (usuarioExcedido, horasExceso, encontrarPracticantesDisponiblesFn) => {\r\n  // Pasa el departamento destino y el usuario excedido\r\n  const disponibles = encontrarPracticantesDisponiblesFn(horasExceso, usuarioExcedido.departamento, usuarioExcedido.id);\r\n\r\n  if (disponibles.length === 0) {\r\n    return ` ${usuarioExcedido.nombre} ${usuarioExcedido.apellidos} excede ${horasExceso.toFixed(1)}h. No hay compaeros ni practicantes disponibles con suficientes horas.`;\r\n  }\r\n\r\n  const recomendaciones = disponibles.slice(0, 3).map(p =>\r\n    ` ${p.usuario.nombre} ${p.usuario.apellidos} (${p.horasDisponibles}h disponibles de ${p.horasMaximas}h)`\r\n  ).join('\\n');\r\n\r\n  return ` ${usuarioExcedido.nombre} ${usuarioExcedido.apellidos} excede ${horasExceso.toFixed(1)}h\\n\\n Compaeros/practicantes disponibles para redistribuir:\\n${recomendaciones}`;\r\n};\r\n","export function obtenerUsuario(usuarios, usuarioId) {\r\n  if (!usuarios || !usuarioId) return null;\r\n  return usuarios.find(u => u.id === usuarioId);\r\n}\r\n\r\nexport function mostrarModalConfirmacion(setModalConfirmacion, configuracion) {\r\n  // Evita error si configuracion es undefined o null\r\n  const conf = configuracion && typeof configuracion === 'object' ? configuracion : {};\r\n  setModalConfirmacion({\r\n    abierto: true,\r\n    tipo: conf.tipo || 'info',\r\n    titulo: conf.titulo || '',\r\n    mensaje: conf.mensaje || '',\r\n    textoConfirmar: conf.textoConfirmar || 'Confirmar',\r\n    textoCancelar: conf.textoCancelar || 'Cancelar',\r\n    onConfirmar: conf.onConfirmar || null,\r\n    onCancelar: conf.onCancelar || null,\r\n    soloInfo: conf.soloInfo || false\r\n  });\r\n}\r\n\r\nexport function crearHorarioPorTipo(tipo) {\r\n  if (tipo === 'viaje-trabajo') {\r\n    return {\r\n      tipo: 'viaje-trabajo',\r\n      horaInicio: '08:00',\r\n      horaFin: '18:00',\r\n      horas: 10\r\n    };\r\n  }\r\n}\r\n\r\n","import React from 'react';\r\nimport { Grid, Box, Typography, IconButton } from '@mui/material';\r\nimport { TIPO_LABEL } from '../../utils/horariosConstants';\r\n\r\nconst TIPOS_SOLO_LABEL = ['descanso', 'vacaciones', 'feriado', 'permiso'];\r\n\r\nconst TurnoUsuario = ({ \r\n  usuario, \r\n  diaKey, \r\n  editando, \r\n  horariosEditados, \r\n  horarios, \r\n  currentUser, \r\n  handleCambiarTurno, \r\n  handleCopiarHorario, \r\n  NO_SUMAN_HORAS\r\n}) => {\r\n  const horariosUsuario = editando ? horariosEditados[usuario.id] : horarios[usuario.id];\r\n  const horario = horariosUsuario?.[diaKey];\r\n  const tieneHorario = horario && horario.tipo !== 'libre';\r\n\r\n  // Determina si solo se debe mostrar el label\r\n  const soloLabel = tieneHorario && TIPOS_SOLO_LABEL.includes(horario.tipo);\r\n\r\n  // Color del icono de copiar\r\n  const copiarColor = soloLabel ? '#222' : '#fff';\r\n\r\n  return (\r\n    <Grid item xs={true} key={diaKey}>\r\n      <Box\r\n        onClick={() => {\r\n          if (editando) {\r\n            handleCambiarTurno(usuario.id, diaKey);\r\n          }\r\n        }}\r\n        sx={{\r\n          minHeight: 80, // Ms alto\r\n          minWidth: 110,  // Ms ancho\r\n          display: 'flex',\r\n          flexDirection: 'column',\r\n          justifyContent: 'center',\r\n          alignItems: 'center',\r\n          borderRadius: '8px',\r\n          border: '1px solid #e0e0e0',\r\n          cursor: editando ? 'pointer' : 'default',\r\n          position: 'relative',\r\n          bgcolor: soloLabel\r\n            ? '#fff'\r\n            : tieneHorario ? (\r\n                horario.tipo === 'viaje-trabajo' ? '#1a237e' : // azul oscuro\r\n                horario.tipo === 'tele-presencial' ? '#6a1b9a' : // nuevo: morado/berenjena\r\n                horario.tipo === 'teletrabajo' ? '#2e7d32' :\r\n                horario.tipo === 'cambio' ? '#f57c00' :\r\n                usuario.id === currentUser?.uid ? 'var(--primary-color)' : 'var(--secondary-color)'\r\n              ) : 'transparent',\r\n          color: soloLabel\r\n            ? '#333'\r\n            : tieneHorario ? 'white' : 'text.secondary',\r\n          '&:hover': editando ? {\r\n            backgroundColor: soloLabel\r\n              ? '#fff'\r\n              : tieneHorario ? (\r\n                  horario.tipo === 'tele-presencial' ? '#4a148c' : // hover morado ms oscuro\r\n                  horario.tipo === 'teletrabajo' ? '#1b5e20' :\r\n                  horario.tipo === 'cambio' ? '#e65100' :\r\n                  usuario.id === currentUser?.uid ? '#303f9f' : '#c51162'\r\n                ) : '#f0f0f0'\r\n          } : {}\r\n        }}\r\n      >\r\n        {/* Icono de copiar para desktop */}\r\n        {tieneHorario && editando && !soloLabel &&\r\n          currentUser &&\r\n          (\r\n            ['Administrador', 'Modificador'].includes(currentUser.rol) ||\r\n            usuario.id === currentUser.uid\r\n          ) ? (\r\n            <IconButton\r\n              size=\"small\"\r\n              onClick={(e) => handleCopiarHorario(usuario.id, diaKey, e)}\r\n              sx={{\r\n                position: 'absolute',\r\n                top: 2,\r\n                right: 2,\r\n                backgroundColor: 'transparent',\r\n                color: copiarColor,\r\n                minWidth: 'auto',\r\n                width: 18,\r\n                height: 18,\r\n                padding: 0,\r\n                border: 'none',\r\n                boxShadow: 'none',\r\n                '&:hover': {\r\n                  backgroundColor: 'transparent'\r\n                }\r\n              }}\r\n            >\r\n              <span style={{ fontSize: 12, color: copiarColor }}></span>\r\n            </IconButton>\r\n          ) : null}\r\n        {/* Icono de copiar para fondo blanco */}\r\n        {tieneHorario && editando && soloLabel &&\r\n          currentUser &&\r\n          (\r\n            ['Administrador', 'Modificador'].includes(currentUser.rol) ||\r\n            usuario.id === currentUser.uid\r\n          ) ? (\r\n            <IconButton\r\n              size=\"small\"\r\n              onClick={(e) => handleCopiarHorario(usuario.id, diaKey, e)}\r\n              sx={{\r\n                position: 'absolute',\r\n                top: 2,\r\n                right: 2,\r\n                backgroundColor: 'transparent',\r\n                color: copiarColor,\r\n                minWidth: 'auto',\r\n                width: 18,\r\n                height: 18,\r\n                padding: 0,\r\n                border: 'none',\r\n                boxShadow: 'none',\r\n                '&:hover': {\r\n                  backgroundColor: 'transparent'\r\n                }\r\n              }}\r\n            >\r\n              <span style={{ fontSize: 12, color: copiarColor }}></span>\r\n            </IconButton>\r\n          ) : null}\r\n        {tieneHorario ? (\r\n          soloLabel ? (\r\n            <>\r\n              <Typography \r\n                variant=\"caption\" \r\n                sx={{ fontSize: '0.85rem', textAlign: 'center', lineHeight: 1.2, fontWeight: 'bold' }}\r\n              >\r\n                {TIPO_LABEL[horario.tipo] || horario.tipo}\r\n              </Typography>\r\n              {horario.nota && (\r\n                <Typography\r\n                  variant=\"caption\"\r\n                  sx={{ fontSize: '0.75rem', textAlign: 'center', lineHeight: 1, mt: 0.5, color: '#333', fontStyle: 'italic' }}\r\n                >\r\n                  {horario.nota}\r\n                </Typography>\r\n              )}\r\n            </>\r\n          ) : horario.tipo === 'tarde-libre' ? (\r\n            <>\r\n              <Typography \r\n                variant=\"caption\" \r\n                sx={{ fontSize: '0.85rem', textAlign: 'center', lineHeight: 1.2, fontWeight: 'bold' }}\r\n              >\r\n                Presencial\r\n              </Typography>\r\n              {(horario.horaInicio && horario.horaFin) && (\r\n                <Typography \r\n                  variant=\"caption\" \r\n                  sx={{ fontSize: '0.75rem', textAlign: 'center', lineHeight: 1 }}\r\n                >\r\n                  {horario.horaInicio} - {horario.horaFin}\r\n                </Typography>\r\n              )}\r\n              <Typography \r\n                variant=\"caption\" \r\n                sx={{ fontSize: '0.85rem', textAlign: 'center', lineHeight: 1.2, fontWeight: 'bold', mt: 0.5 }}\r\n              >\r\n                Tiempo Libre\r\n              </Typography>\r\n              {(horario.horaInicioLibre && horario.horaFinLibre) && (\r\n                <Typography \r\n                  variant=\"caption\" \r\n                  sx={{ fontSize: '0.75rem', textAlign: 'center', lineHeight: 1 }}\r\n                >\r\n                  {horario.horaInicioLibre} - {horario.horaFinLibre}\r\n                </Typography>\r\n              )}\r\n              {horario.nota && (\r\n                <Typography \r\n                  variant=\"caption\" \r\n                  sx={{ fontSize: '0.75rem', textAlign: 'center', lineHeight: 1, mt: 0.5, fontStyle: 'italic' }}\r\n                >\r\n                  {horario.nota}\r\n                </Typography>\r\n              )}\r\n            </>\r\n          ) : horario.tipo === 'viaje-trabajo' ? (\r\n            <Typography \r\n              variant=\"caption\" \r\n              sx={{ fontSize: '0.85rem', textAlign: 'center', lineHeight: 1, fontWeight: 'bold' }}\r\n            >\r\n              {TIPO_LABEL[horario.tipo] || horario.tipo}\r\n            </Typography>\r\n          ) : horario.tipo === 'tele-presencial' ? (\r\n            <>\r\n              <Typography \r\n                variant=\"caption\" \r\n                sx={{ fontSize: '0.85rem', textAlign: 'center', lineHeight: 1.2, fontWeight: 'bold' }}\r\n              >\r\n                {TIPO_LABEL[horario.tipo] || 'Teletrabajo & Presencial'}\r\n              </Typography>\r\n\r\n              {/* Teletrabajo */}\r\n              {(horario.horaInicioTele && horario.horaFinTele) && (\r\n                <>\r\n                  <Typography \r\n                    variant=\"caption\" \r\n                    sx={{ fontSize: '0.75rem', textAlign: 'center', lineHeight: 1 }}\r\n                  >\r\n                    TT: {horario.horaInicioTele} - {horario.horaFinTele}\r\n                  </Typography>\r\n                </>\r\n              )}\r\n\r\n              {/* Presencial */}\r\n              {(horario.horaInicioPres && horario.horaFinPres) && (\r\n                <>\r\n                  <Typography \r\n                    variant=\"caption\" \r\n                    sx={{ fontSize: '0.75rem', textAlign: 'center', lineHeight: 1, mt: 0.3 }}\r\n                  >\r\n                    Pres: {horario.horaInicioPres} - {horario.horaFinPres}\r\n                  </Typography>\r\n                </>\r\n              )}\r\n\r\n              <Typography \r\n                variant=\"caption\" \r\n                sx={{ fontSize: '0.75rem', textAlign: 'center', lineHeight: 1, mt: 0.5 }}\r\n              >\r\n                {`${horario.horas?.toFixed(1) || '0.0'}h`}\r\n              </Typography>\r\n\r\n              {horario.nota && (\r\n                <Typography \r\n                  variant=\"caption\" \r\n                  sx={{ fontSize: '0.75rem', textAlign: 'center', lineHeight: 1, mt: 0.5, color: '#fff', fontStyle: 'italic' }}\r\n                >\r\n                  {horario.nota}\r\n                </Typography>\r\n              )}\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Typography \r\n                variant=\"caption\" \r\n                sx={{ fontSize: '0.85rem', textAlign: 'center', lineHeight: 1, fontWeight: 'bold' }}\r\n              >\r\n                {TIPO_LABEL[horario.tipo] || horario.tipo}\r\n              </Typography>\r\n              {(horario.horaInicio && horario.horaFin) && (\r\n                <Typography \r\n                  variant=\"caption\" \r\n                  sx={{ fontSize: '0.75rem', textAlign: 'center', lineHeight: 1 }}\r\n                >\r\n                  {horario.horaInicio} - {horario.horaFin}\r\n                </Typography>\r\n              )}\r\n              <Typography \r\n                variant=\"caption\" \r\n                sx={{ fontSize: '0.75rem', textAlign: 'center', lineHeight: 1 }}\r\n              >\r\n                {NO_SUMAN_HORAS.includes(horario.tipo)\r\n                  ? (horario.tipo === 'teletrabajo' ? 'TT' :\r\n                     horario.tipo === 'descanso' ? 'D' :\r\n                     horario.tipo === 'vacaciones' ? 'V' :\r\n                     horario.tipo === 'feriado' ? 'F' :\r\n                     horario.tipo === 'permiso' ? 'P' : 'X')\r\n                  : `${horario.horas?.toFixed(1) || '0'}h`\r\n                }\r\n              </Typography>\r\n              {horario.nota && (\r\n                    <Typography \r\n                      variant=\"caption\" \r\n                      sx={{ fontSize: '0.75rem', textAlign: 'center', lineHeight: 1, mt: 0.5, color: '#fff', fontStyle: 'italic' }}\r\n                    >\r\n                      {horario.nota}\r\n                    </Typography>\r\n              )}\r\n            </>\r\n          )\r\n        ) : (\r\n          <Typography \r\n            variant=\"caption\" \r\n            sx={{ fontSize: '0.8rem', textAlign: 'center', lineHeight: 1.2, color: '#888' }}\r\n          >\r\n            Sin Turno\r\n          </Typography>\r\n        )}\r\n      </Box>\r\n    </Grid>\r\n  );\r\n};\r\n\r\nexport default TurnoUsuario;","import React from 'react';\r\nimport { Box, Paper, Grid, Typography, IconButton, Chip } from '@mui/material';\r\nimport ContentCopyIcon from '@mui/icons-material/ContentCopy';\r\nimport { format, addDays } from 'date-fns';\r\nimport TurnoUsuario from './TurnoUsuario';\r\nimport { obtenerEtiquetaRol, obtenerColorRol } from '../../utils/horariosUtils';\r\n\r\nconst HorariosTable = ({\r\n  isMobile,\r\n  isSmallMobile,\r\n  usuariosFiltrados,\r\n  editando,\r\n  horarios,\r\n  horariosEditados,\r\n  currentUser,\r\n  handleCambiarTurno,\r\n  abrirInfoTurno,\r\n  handleCopiarHorario,\r\n  NO_SUMAN_HORAS,\r\n  calcularExceso,\r\n  calcularHorasTotales,\r\n  semanaSeleccionada,\r\n  semanaActual,\r\n  obtenerUsuario,\r\n  obtenerHorasMaximas,\r\n  diasSemana\r\n}) => {\r\n  return (\r\n    <Box sx={{ p: { xs: 0.5, sm: 2, md: 3 }, overflowX: 'auto' }}>\r\n      {isMobile ? (\r\n        <Box sx={{ px: 1 }}>\r\n          {/* Encabezados mvil */}\r\n          <Grid container spacing={0.5} sx={{ mb: 1 }}>\r\n            <Grid item xs={4}>\r\n              <Typography variant=\"body2\" sx={{ fontWeight: 'bold', p: 0.5, fontSize: '0.75rem', textAlign: 'center' }}>\r\n                Usuario\r\n              </Typography>\r\n            </Grid>\r\n            <Grid item xs={6}>\r\n              <Typography variant=\"body2\" sx={{ fontWeight: 'bold', p: 0.5, fontSize: '0.75rem', textAlign: 'center' }}>\r\n                Horarios de la Semana\r\n              </Typography>\r\n            </Grid>\r\n            <Grid item xs={2}>\r\n              <Typography variant=\"body2\" sx={{ fontWeight: 'bold', p: 0.5, fontSize: '0.75rem', textAlign: 'center' }}>\r\n                Total\r\n              </Typography>\r\n            </Grid>\r\n          </Grid>\r\n\r\n          {/* Filas de usuarios mvil */}\r\n          {usuariosFiltrados.map(usuario => (\r\n            <Paper key={usuario.id} elevation={usuario.id === currentUser?.uid ? 3 : 1} sx={{ mb: 1, p: 1, bgcolor: usuario.id === currentUser?.uid ? '#e3f2fd' : 'white', border: usuario.id === currentUser?.uid ? '2px solid #2196f3' : '1px solid #e0e0e0' }}>\r\n              <Grid container spacing={0.5} alignItems=\"center\">\r\n                <Grid item xs={4}>\r\n                  <Box sx={{ textAlign: 'center' }}>\r\n                    <Typography variant=\"caption\" sx={{ fontWeight: usuario.id === currentUser?.uid ? 'bold' : 'normal', fontSize: '0.7rem', display: 'block', lineHeight: 1.2 }}>\r\n                      {usuario.nombre} {usuario.apellidos}\r\n                    </Typography>\r\n                    <Chip label={obtenerEtiquetaRol(usuario.rol)} color={obtenerColorRol(usuario.rol)} size=\"small\" sx={{ fontSize: '0.6rem', height: 16, mt: 0.5 }} />\r\n                  </Box>\r\n                </Grid>\r\n                <Grid item xs={6}>\r\n                  <Grid container spacing={0.3}>\r\n                    {diasSemana.map((dia, index) => {\r\n                      const diaKey = `dia${index + 1}`;\r\n                      const horariosUsuario = editando ? horariosEditados[usuario.id] : horarios[usuario.id];\r\n                      const horario = horariosUsuario?.[diaKey];\r\n                      const tieneHorario = horario && horario.tipo !== 'libre';\r\n\r\n                      return (\r\n                        <Grid item xs={12/7} key={diaKey}>\r\n                          <Box\r\n                            onClick={() => {\r\n                              if (editando) handleCambiarTurno(usuario.id, diaKey);\r\n                              else if (tieneHorario) abrirInfoTurno(usuario, horario, diaKey);\r\n                            }}\r\n                            sx={{\r\n                              height: 28,\r\n                              display: 'flex',\r\n                              justifyContent: 'center',\r\n                              alignItems: 'center',\r\n                              borderRadius: '4px',\r\n                              position: 'relative',\r\n                              bgcolor: tieneHorario\r\n                                ? NO_SUMAN_HORAS.includes(horario.tipo)\r\n                                  ? 'white'\r\n                                  : horario.tipo === 'teletrabajo'\r\n                                  ? '#2e7d32'\r\n                                  : horario.tipo === 'cambio'\r\n                                  ? '#f57c00'\r\n                                  : usuario.id === currentUser?.uid\r\n                                  ? 'var(--primary-color)'\r\n                                  : 'var(--secondary-color)'\r\n                                : 'transparent',\r\n                              color: tieneHorario\r\n                                ? NO_SUMAN_HORAS.includes(horario.tipo)\r\n                                  ? 'black'\r\n                                  : 'white'\r\n                                : 'text.secondary',\r\n                              '&:hover': editando\r\n                                ? { backgroundColor: '#f0f0f0' }\r\n                                : {}\r\n                            }}\r\n                          >\r\n                            {tieneHorario && editando && (\r\n                              <IconButton size=\"small\" onClick={e => handleCopiarHorario(usuario.id, diaKey, e)} sx={{ position: 'absolute', top: -2, right: -2, backgroundColor: 'transparent', color: '#1976d2', width: 12, height: 12, p: 0, '&:hover': { backgroundColor: 'transparent' } }}>\r\n                                <ContentCopyIcon sx={{ fontSize: 8 }} />\r\n                              </IconButton>\r\n                            )}\r\n                            <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>\r\n                              <Typography variant=\"caption\" sx={{ fontSize: '0.6rem', textAlign: 'center', lineHeight: 1 }}>\r\n                                {dia.slice(0, 1)}\r\n                              </Typography>\r\n                              {horario && horario.tipo === 'descanso' && horario.nota && (\r\n                                <Typography variant=\"caption\" sx={{ fontSize: '0.55rem', textAlign: 'center', lineHeight: 1, mt: 0.2, color: 'text.secondary' }}>\r\n                                  {horario.nota}\r\n                                </Typography>\r\n                              )}\r\n                            </Box>\r\n                          </Box>\r\n                        </Grid>\r\n                      );\r\n                    })}\r\n                  </Grid>\r\n                </Grid>\r\n                <Grid item xs={2}>\r\n                  <Paper elevation={calcularExceso(usuario.id) > 0 ? 2 : 1} sx={{ textAlign: 'center', p: 0.5, bgcolor: calcularExceso(usuario.id) > 0 ? '#ffebee' : '#e8f5e8', border: calcularExceso(usuario.id) > 0 ? '1px solid #f44336' : '1px solid #4caf50' }}>\r\n                    <Typography variant=\"caption\" sx={{ fontSize: '0.7rem', fontWeight: 'bold' }}>\r\n                      {calcularHorasTotales(usuario.id, editando, horariosEditados, horarios, semanaSeleccionada, semanaActual, {}, id => obtenerUsuario(usuariosFiltrados, id), obtenerHorasMaximas, true).toFixed(1)}h\r\n                    </Typography>\r\n                  </Paper>\r\n                </Grid>\r\n              </Grid>\r\n            </Paper>\r\n          ))}\r\n        </Box>\r\n      ) : (\r\n        <Grid container spacing={1}>\r\n          {/* Encabezados */}\r\n          <Grid item xs={12}>\r\n            <Grid container spacing={1}>\r\n              <Grid item xs={2} md={2}>\r\n                <Typography variant=\"subtitle1\" sx={{ fontWeight: 'bold', p: 1 }}>\r\n                  Usuario\r\n                </Typography>\r\n              </Grid>\r\n              {diasSemana.map((dia, index) => (\r\n                <Grid item xs key={dia}>\r\n                  <Typography variant=\"subtitle2\" align=\"center\" sx={{ fontWeight: 'bold', p: 1 }}>\r\n                    {`${dia} ${format(addDays(semanaSeleccionada, index), 'd')}`}\r\n                  </Typography>\r\n                </Grid>\r\n              ))}\r\n              <Grid item xs={1} md={1}>\r\n                <Typography variant=\"subtitle2\" align=\"center\" sx={{ fontWeight: 'bold', p: 1 }}>\r\n                  Total\r\n                </Typography>\r\n              </Grid>\r\n            </Grid>\r\n          </Grid>\r\n          {/* Filas de usuarios */}\r\n          {usuariosFiltrados.map(usuario => (\r\n            <Grid item xs={12} key={usuario.id}>\r\n              <Grid container spacing={1} alignItems=\"center\">\r\n                <Grid item xs={2} md={2}>\r\n                  <Paper elevation={usuario.id === currentUser?.uid ? 2 : 0} sx={{ p: 1, textAlign: 'center', bgcolor: usuario.id === currentUser?.uid ? '#e3f2fd' : 'transparent', border: usuario.id === currentUser?.uid ? '2px solid #2196f3' : '1px solid #e0e0e0' }}>\r\n                    <Typography variant=\"body2\" sx={{ fontWeight: usuario.id === currentUser?.uid ? 'bold' : 'normal' }}>\r\n                      {usuario.nombre} {usuario.apellidos}\r\n                    </Typography>\r\n                    <br />\r\n                    <Chip label={obtenerEtiquetaRol(usuario.rol)} color={obtenerColorRol(usuario.rol)} size=\"small\" sx={{ fontSize: '0.6rem', height: 20, mt: 0.5 }} />\r\n                  </Paper>\r\n                </Grid>\r\n                {diasSemana.map((_, index) => (\r\n                  <Grid item key={`${usuario.id}-${index}`} xs>\r\n                    <TurnoUsuario\r\n                      usuario={usuario}\r\n                      diaKey={`dia${index + 1}`}\r\n                      editando={editando}\r\n                      horariosEditados={horariosEditados}\r\n                      horarios={horarios}\r\n                      currentUser={currentUser}\r\n                      handleCambiarTurno={handleCambiarTurno}\r\n                      handleCopiarHorario={handleCopiarHorario}\r\n                      NO_SUMAN_HORAS={NO_SUMAN_HORAS}\r\n                    />\r\n                  </Grid>\r\n                ))}\r\n                <Grid item xs={1} md={1}>\r\n                  <Paper elevation={calcularExceso(usuario.id) > 0 ? 2 : 1} sx={{ textAlign: 'center', p: 1, bgcolor: calcularExceso(usuario.id) > 0 ? '#ffebee' : '#e8f5e8', border: calcularExceso(usuario.id) > 0 ? '1px solid #f44336' : '1px solid #4caf50' }}>\r\n                    <Typography variant=\"body2\" sx={{ fontWeight: 'bold' }}>\r\n                      {calcularHorasTotales(usuario.id, editando, horariosEditados, horarios, semanaSeleccionada, semanaActual, {}, id => obtenerUsuario(usuariosFiltrados, id), obtenerHorasMaximas, true).toFixed(1)}h\r\n                    </Typography>\r\n                  </Paper>\r\n                </Grid>\r\n              </Grid>\r\n            </Grid>\r\n          ))}\r\n        </Grid>\r\n      )}\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default HorariosTable;\r\n","import React, { useState, useEffect, useCallback } from 'react';\nimport { ref, get, set } from 'firebase/database';\nimport { database } from '../../firebase/config';\nimport { Container, Paper, Typography, Box, Button, useMediaQuery, useTheme, Alert } from '@mui/material';\nimport { styled } from '@mui/material/styles';\nimport { format, getYear } from 'date-fns';\nimport HeaderSemana from './HeaderSemana';\nimport RecomendacionesPracticantes from './RecomendacionesPracticantes';\nimport DialogoHorario from './DialogoHorario';\nimport DialogoEliminar from './DialogoEliminar';\nimport DialogoCopiar from './DialogoCopiar';\nimport ModalConfirmacion from './ModalConfirmacion';\nimport InfoTurnoModal from './InfoTurnoModal';\nimport { \n  calcularHorasTotales, \n  calcularHorasExcedentes, \n  convertirA24h, \n  encontrarPracticantesDisponibles, \n  generarRecomendacionPracticantes \n} from '../../utils/horariosUtils';\nimport { \n  puedeEditarHorarios, \n  puedeEliminarHorarios, \n  puedeModificarHorarios \n} from '../../utils/permissionsUtils';\nimport { obtenerHorasMaximas } from '../../utils/contratoUtils';\nimport { \n  departamentos, \n  diasSemana, \n  NO_SUMAN_HORAS, \n  DIAS_LABELS \n} from '../../utils/horariosConstants';\nimport { obtenerUsuario } from '../../utils/horariosHelpers';\nimport { useUsuariosFiltrados } from '../../hooks/useUsuariosFiltrados';\nimport HorariosTable from './HorariosTable';\nimport { cargarHorariosPorSemana, guardarBatchHorarios, guardarHorariosUsuarioSemana, subscribeHorariosSemana } from '../../services/firebaseHorarios';\nimport { puedeVerHorarios } from '../../utils/contratoUtils';\nimport { useUsuariosYHorarios } from '../../hooks/useUsuariosYHorarios';\nimport { useSemana } from '../../hooks/useSemana';\nimport { useModalConfirm } from '../../hooks/useModalConfirm';\n\nconst StyledPaper = styled(Paper)(({ theme }) => ({\n  padding: theme.spacing(3),\n  borderRadius: '16px',\n  boxShadow: '0 8px 24px rgba(0, 0, 0, 0.1)',\n  [theme.breakpoints.down('md')]: {\n    padding: theme.spacing(2),\n    borderRadius: '12px',\n  },\n  [theme.breakpoints.down('sm')]: {\n    padding: theme.spacing(1.5),\n    borderRadius: '8px',\n    margin: theme.spacing(0.5),\n  },\n}));\n\nconst Horarios = () => {\n  const theme = useTheme();\n  const isMobile = useMediaQuery(theme.breakpoints.down('md'));\n  const isSmallMobile = useMediaQuery(theme.breakpoints.down('sm'));\n\n  // Reemplazar estados de usuarios por el hook\n  const { usuarios, departamentoSeleccionado, setDepartamentoSeleccionado, currentUser } = useUsuariosYHorarios();\n  const [loading, setLoading] = useState(true);\n  const [horarios, setHorarios] = useState({});\n  const { semanaActual, semanaSeleccionada, setSemanaSeleccionada, avanzarSemana, retrocederSemana, obtenerClaveSemana } = useSemana();\n  const [editando, setEditando] = useState(false);\n  const [horariosEditados, setHorariosEditados] = useState({});\n  // Buffer de ediciones por semana: { [semanaKey]: { ...horariosEditadosSemana } }\n  const [bufferEditSemanas, setBufferEditSemanas] = useState({});\n  // Clave de la semana ms recientemente cargada desde backend\n  const [lastLoadedWeekKey, setLastLoadedWeekKey] = useState(null);\n  const [dialogoHorario, setDialogoHorario] = useState(false);\n  const [horarioPersonalizado, setHorarioPersonalizado] = useState({\n    horaInicio: '',\n    horaFin: '',\n    usuarioId: null,\n    diaKey: null,\n    tipo: 'personalizado'\n  });\n  const [dialogoEliminar, setDialogoEliminar] = useState(false);\n  const [eliminacionSeleccionada, setEliminacionSeleccionada] = useState({\n    tipo: 'mis-dias', // 'todo', 'usuario', 'dia', 'mis-dias'\n    usuarioId: null,\n    dia: null,\n    diasSeleccionados: []\n  });\n  const [anchorEl, setAnchorEl] = useState(null); // Para el men de seleccin de fecha\n  const [yearSelected, setYearSelected] = useState(getYear(new Date()));\n  const [monthSelected, setMonthSelected] = useState(new Date().getMonth());\n  const [datePickerOpen, setDatePickerOpen] = useState(false);\n\n  // Estados para copiar horario\n  const [dialogoCopiar, setDialogoCopiar] = useState(false);\n  const [horarioACopiar, setHorarioACopiar] = useState(null);\n\n  // Estados para modales de confirmacin modernos\n  const { modalConfirmacion, mostrarModal, cerrarModal } = useModalConfirm();\n\n  // Estado y handlers para el InfoTurnoModal\n  const [infoModalOpen, setInfoModalOpen] = useState(false);\n  const [modalUsuario, setModalUsuario] = useState(null);\n  const [modalTurno, setModalTurno] = useState(null);\n  const [modalDiaKey, setModalDiaKey] = useState(null);\n  const abrirInfoTurno = (usuario, turno, diaKey) => {\n    setModalUsuario(usuario);\n    setModalTurno(turno);\n    setModalDiaKey(diaKey);\n    setInfoModalOpen(true);\n  };\n  const cerrarInfoTurno = () => {\n    setInfoModalOpen(false);\n    setModalUsuario(null);\n    setModalTurno(null);\n  };\n\n  const usuariosFiltrados = useUsuariosFiltrados(usuarios, departamentoSeleccionado);\n\n  // Iniciar edicin segn permisos (evita cargar datos de otros usuarios para no admins)\n  const iniciarEdicion = useCallback(() => {\n    setEditando(true);\n    const usuarioActual = usuarios.find(u => u.id === currentUser?.uid);\n    const puedeGuardarTodos = usuarioActual && (\n      usuarioActual.rol === 'Administrador' || usuarioActual.rol === 'Modificador'\n    );\n    if (puedeGuardarTodos) {\n      setHorariosEditados({ ...(horarios || {}) });\n    } else {\n      setHorariosEditados({ [currentUser.uid]: (horarios?.[currentUser.uid] || {}) });\n    }\n  }, [usuarios, currentUser, horarios]);\n\n  // Suscribirse en tiempo real a los horarios de la semana seleccionada\n  useEffect(() => {\n    if (!currentUser) return;\n    setLoading(true);\n    const key = obtenerClaveSemana(semanaSeleccionada);\n    // subscribeHorariosSemana invoca onChange con el objeto actual\n    const unsubscribe = subscribeHorariosSemana(key, (data) => {\n      setHorarios(data || {});\n      setLastLoadedWeekKey(key);\n      setLoading(false);\n    });\n\n    // En caso de error o timeout, intentamos una carga puntual como fallback\n    const fallback = setTimeout(async () => {\n      try {\n        const data = await cargarHorariosPorSemana(semanaSeleccionada, obtenerClaveSemana);\n        setHorarios(data || {});\n        setLastLoadedWeekKey(key);\n      } catch (e) {\n        console.error('Fallback cargarHorariosPorSemana fall:', e);\n      } finally {\n        setLoading(false);\n      }\n    }, 3000);\n\n    return () => {\n      clearTimeout(fallback);\n      try {\n        unsubscribe && unsubscribe();\n      } catch (e) {\n        // no-op\n      }\n    };\n  }, [semanaSeleccionada, currentUser, obtenerClaveSemana]);\n\n  // Al cambiar de semana durante edicin: restaurar del buffer o inicializar desde los horarios cargados\n  useEffect(() => {\n    if (!editando) return;\n    const key = obtenerClaveSemana(semanaSeleccionada);\n    const existente = bufferEditSemanas[key];\n    if (existente) {\n      setHorariosEditados(existente);\n      return;\n    }\n    // Evita inicializar con horarios de otra semana o durante la carga\n    if (loading || lastLoadedWeekKey !== key) {\n      // Para no mostrar datos de otra semana, limpia mientras llega la data correcta\n      setHorariosEditados({});\n      return;\n    }\n    const usuarioActual = usuarios.find(u => u.id === currentUser?.uid);\n    const esAdmin = usuarioActual && (usuarioActual.rol === 'Administrador' || usuarioActual.rol === 'Modificador');\n    const init = esAdmin ? { ...(horarios || {}) } : { [currentUser?.uid]: (horarios?.[currentUser?.uid] || {}) };\n    setHorariosEditados(init);\n    setBufferEditSemanas(prev => ({ ...prev, [key]: init }));\n  }, [editando, semanaSeleccionada, loading, lastLoadedWeekKey, horarios, usuarios, currentUser, obtenerClaveSemana, bufferEditSemanas]);\n\n  // Sincronizar el buffer con los cambios en horariosEditados para la semana actual\n  useEffect(() => {\n    if (!editando) return;\n    const key = obtenerClaveSemana(semanaSeleccionada);\n    // No sincronizar mientras esperamos data de la semana correcta\n    if (loading || lastLoadedWeekKey !== key) return;\n    setBufferEditSemanas(prev => ({ ...prev, [key]: horariosEditados }));\n  }, [horariosEditados, editando, semanaSeleccionada, obtenerClaveSemana, loading, lastLoadedWeekKey]);\n\n  // Funcin para recalcular horas extras despus de modificaciones\n  const recalcularHorasExtras = useCallback(async () => {\n    try {\n      // Solo recalcular si estamos en la semana actual\n      const esSemanaActual = format(semanaSeleccionada, 'yyyy-MM-dd') === format(semanaActual, 'yyyy-MM-dd');\n      \n      if (!esSemanaActual) {\n        return; // No necesitamos recalcular horas extras para semanas que no son la actual\n      }\n\n      const semanaKey = obtenerClaveSemana(semanaSeleccionada);\n      const horariosRef = ref(database, `horarios_registros/${semanaKey}`);\n      const horariosSnapshot = await get(horariosRef);\n      \n      if (!horariosSnapshot.exists()) {\n        // No hay horarios, eliminar todas las horas extras\n        await set(ref(database, 'horas_extras'), {});\n        return;\n      }\n\n      const horariosActuales = horariosSnapshot.val();\n      const nuevasHorasExtras = {};\n\n      // Calcular horas extras para cada usuario\n      Object.keys(horariosActuales).forEach(usuarioId => {\n        const horariosUsuario = horariosActuales[usuarioId];\n        if (!horariosUsuario) return;\n\n        const usuario = usuarios.find(u => u.id === usuarioId);\n        const horasMaximas = obtenerHorasMaximas(usuario?.tipoContrato || 'Operativo');\n        \n        const horasTotales = Object.values(horariosUsuario).reduce((total, turno) => {\n          if (!turno || NO_SUMAN_HORAS.includes(turno.tipo)) return total;\n          return total + (turno.horas || 0);\n        }, 0);\n\n        const horasExcedentes = Math.max(horasTotales - horasMaximas, 0);\n        if (horasExcedentes > 0) {\n          nuevasHorasExtras[usuarioId] = horasExcedentes;\n        }\n      });\n\n      // Actualizar en Firebase y estado local\n      await set(ref(database, 'horas_extras'), nuevasHorasExtras);\n      \n    } catch (error) {\n      console.error('Error al recalcular horas extras:', error);\n    }\n  }, [semanaSeleccionada, semanaActual, obtenerClaveSemana, usuarios]);\n\n  const handleGuardarHorarios = useCallback(async () => {\n    try {\n      setLoading(true);\n      // Consolidar buffer usando el estado actual de la semana visible\n      const currentWeekKey = obtenerClaveSemana(semanaSeleccionada);\n      const buffers = { ...bufferEditSemanas };\n      // No sobrescribir el buffer de la semana actual con vaco\n      if (horariosEditados && Object.keys(horariosEditados).length > 0) {\n        buffers[currentWeekKey] = horariosEditados;\n      }\n\n      const usuarioActual = usuarios.find(u => u.id === currentUser?.uid);\n      const esAdmin = usuarioActual && (usuarioActual.rol === 'Administrador' || usuarioActual.rol === 'Modificador');\n      let operaciones = 0;\n\n      // Construir un update en lote para minimizar roundtrips\n      const updates = {};\n      if (!esAdmin) {\n        for (const [weekKey, data] of Object.entries(buffers)) {\n          const propios = data?.[currentUser?.uid];\n          if (propios && Object.keys(propios).length > 0) {\n            updates[`horarios_registros/${weekKey}/${currentUser.uid}`] = propios;\n            operaciones += 1;\n          }\n        }\n      } else {\n        for (const [weekKey, data] of Object.entries(buffers)) {\n          if (!data || Object.keys(data).length === 0) continue;\n          for (const [uid, horariosUsuario] of Object.entries(data)) {\n            updates[`horarios_registros/${weekKey}/${uid}`] = horariosUsuario || {};\n            operaciones += 1;\n          }\n        }\n      }\n\n  if (operaciones > 0) {\n        // Si el nmero de operaciones es pequeo (p. ej. solo un usuario), usar la API granular por usuario\n        const paths = Object.keys(updates);\n        if (paths.length <= 10) {\n          // Intentar escribir por usuario/semana individualmente para evitar sobrescrituras\n          for (const p of paths) {\n            // p tiene el formato 'horarios_registros/${weekKey}/${uid}'\n            const parts = p.split('/');\n            const weekKey = parts[1];\n            const uid = parts[2];\n            try {\n              await guardarHorariosUsuarioSemana(weekKey, uid, updates[p]);\n            } catch (err) {\n              console.warn('Fallo al guardar usuario individualmente, se acumula para batch:', err);\n              // Si falla, lo dejamos en mergedBatch\n            }\n          }\n        } else {\n          // Para muchos cambios, usar el batch con merge interno\n          await guardarBatchHorarios(updates);\n        }\n      }\n\n      if (operaciones === 0) {\n        mostrarModal({\n          tipo: 'warning',\n          titulo: 'Sin cambios para guardar',\n          mensaje: 'No se detectaron modificaciones pendientes. Verifica que los horarios editados aparezcan en pantalla antes de guardar.',\n          soloInfo: true\n        });\n        setLoading(false);\n        return;\n      }\n\n    // Finalizar edicin. Con la suscripcin en tiempo real el estado se actualizar desde Firebase.\n    setEditando(false);\n    setBufferEditSemanas({});\n\n      // Recalcular horas extras solo para la semana actual\n      await recalcularHorasExtras();\n\n      mostrarModal({\n        tipo: 'success',\n        titulo: ' Horarios Guardados',\n        mensaje: 'Los horarios se han guardado correctamente.',\n        soloInfo: true\n      });\n    } catch (error) {\n      console.error('Error al guardar horarios:', error);\n      mostrarModal({\n        tipo: 'error',\n        titulo: ' Error al Guardar',\n        mensaje: `Ocurri un error al guardar los horarios:\\n\\n${error.message}`,\n        soloInfo: true\n      });\n    } finally {\n      setLoading(false);\n    }\n  }, [bufferEditSemanas, horariosEditados, semanaSeleccionada, obtenerClaveSemana, usuarios, currentUser, mostrarModal, recalcularHorasExtras]);\n\n  const handleEliminarSeleccionado = async () => {\n    try {\n      setLoading(true);\n  const semanaKey = obtenerClaveSemana(semanaSeleccionada);\n  const refPath = `horarios_registros/${semanaKey}`;\n  const { tipo, usuarioId, dia, diasSeleccionados } = eliminacionSeleccionada;\n\n      // Verificar permisos\n      // Aseguramos que usuarioActual sea el objeto completo, no solo el UID\n      let usuarioActual = null;\n      if (currentUser && currentUser.rol) {\n        usuarioActual = currentUser;\n      } else if (currentUser && currentUser.uid) {\n        usuarioActual = usuarios.find(u => u.id === currentUser.uid);\n      }\n      if (!usuarioActual) {\n        mostrarModal({\n          tipo: 'error',\n          titulo: ' Usuario no encontrado',\n          mensaje: 'No se pudo verificar tu identidad. Por favor, inicia sesin nuevamente.',\n          soloInfo: true\n        });\n        return;\n      }\n\n      let updates = { ...horarios };\n\n      switch (tipo) {\n        case 'todo':\n          // Solo administradores pueden eliminar todos los horarios\n          if (usuarioActual.rol !== 'Administrador') {\n            mostrarModal({\n              tipo: 'error',\n              titulo: ' Permisos Insuficientes',\n              mensaje: 'Solo los administradores pueden eliminar todos los horarios.',\n              soloInfo: true\n            });\n            return;\n          }\n          // Elimina todos los horarios de la semana seleccionada\n          await set(ref(database, refPath), {});\n          setHorarios({});\n          setHorariosEditados({});\n          break;\n\n  case 'usuario':\n          // Validar que se haya seleccionado un usuario\n          if (!usuarioId) {\n            mostrarModal({\n              tipo: 'warning',\n              titulo: ' Usuario no seleccionado',\n              mensaje: 'Debes seleccionar un usuario para eliminar sus horarios.',\n              soloInfo: true\n            });\n            setLoading(false);\n            setDialogoEliminar(false);\n            return;\n          }\n          // Permitir que el administrador elimine horarios de cualquier usuario\n          // Los usuarios normales solo pueden eliminar sus propios horarios\n          if (usuarioActual.rol !== 'Administrador' && usuarioId !== currentUser.uid) {\n            mostrarModal({\n              tipo: 'error',\n              titulo: ' Acceso Denegado',\n              mensaje: 'Solo puedes eliminar tus propios horarios.\\n\\nLos administradores pueden eliminar horarios de cualquier usuario.',\n              soloInfo: true\n            });\n            return;\n          }\n          // Si es admin o es el propio usuario, permite borrar\n          if (updates[usuarioId]) {\n            delete updates[usuarioId];\n            // Eliminar solo el nodo del usuario en la semana, sin tocar otros usuarios\n            await set(ref(database, `${refPath}/${usuarioId}`), null);\n            // Actualizar estado local en memoria\n            setHorarios(prev => {\n              const nuevo = { ...prev };\n              delete nuevo[usuarioId];\n              return nuevo;\n            });\n            setHorariosEditados(prev => {\n              const newState = { ...prev };\n              delete newState[usuarioId];\n              return newState;\n            });\n          } else {\n            mostrarModal({\n              tipo: 'warning',\n              titulo: ' Sin Horarios',\n              mensaje: 'El usuario seleccionado no tiene horarios asignados para eliminar.',\n              soloInfo: true\n            });\n            setLoading(false);\n            setDialogoEliminar(false);\n            return;\n          }\n          break;\n\n        case 'dia':\n          // Solo administradores pueden eliminar un da completo para todos\n          if (usuarioActual.rol !== 'Administrador') {\n            mostrarModal({\n              tipo: 'error',\n              titulo: ' Permisos Insuficientes',\n              mensaje: 'Solo los administradores pueden eliminar horarios de un da completo para todos los usuarios.',\n              soloInfo: true\n            });\n            return;\n          }\n          let huboEliminacion = false;\n          Object.keys(updates).forEach(uid => {\n            if (updates[uid] && updates[uid][dia]) {\n              delete updates[uid][dia];\n              huboEliminacion = true;\n            }\n          });\n          if (huboEliminacion) {\n            await set(ref(database, refPath), updates);\n            // No sobrescribimos el estado local completamente: limpiar buffer de edicin y dejar que el listener sincronice\n            setHorariosEditados({});\n            setBufferEditSemanas({});\n          } else {\n            mostrarModal({\n              tipo: 'warning',\n              titulo: ' Sin Horarios',\n              mensaje: 'No se encontraron horarios para ese da en ningn usuario.',\n              soloInfo: true\n            });\n            setLoading(false);\n            setDialogoEliminar(false);\n            return;\n          }\n          break;\n\n        case 'mis-dias':\n          // Eliminar das especficos del usuario actual\n          if (!currentUser?.uid) {\n            mostrarModal({\n              tipo: 'error',\n              titulo: ' Usuario no encontrado',\n              mensaje: 'No se pudo verificar tu identidad. Por favor, inicia sesin nuevamente.',\n              soloInfo: true\n            });\n            return;\n          }\n\n          if (!updates[currentUser.uid]) {\n            mostrarModal({\n              tipo: 'warning',\n              titulo: ' Sin Horarios',\n              mensaje: 'No tienes horarios asignados para eliminar.',\n              soloInfo: true\n            });\n            return;\n          }\n\n          if (!diasSeleccionados || diasSeleccionados.length === 0) {\n            mostrarModal({\n              tipo: 'warning',\n              titulo: ' Das no Seleccionados',\n              mensaje: 'Debes seleccionar al menos un da para eliminar.',\n              soloInfo: true\n            });\n            return;\n          }\n\n          diasSeleccionados.forEach(diaKey => {\n            if (updates[currentUser.uid] && updates[currentUser.uid][diaKey]) {\n              delete updates[currentUser.uid][diaKey];\n            }\n          });\n\n          await set(ref(database, refPath), updates);\n          // Limpiar buffer de edicin y dejar que el listener actualice el estado\n          setHorariosEditados({});\n          setBufferEditSemanas({});\n          break;\n\n        default:\n          console.log('Tipo de eliminacin no reconocido:', tipo);\n          break;\n      }\n      \n      mostrarModal({\n        tipo: 'success',\n        titulo: ' Horarios Eliminados',\n        mensaje: 'Los horarios seleccionados se han eliminado correctamente.',\n        soloInfo: true\n      });\n\n      // Recalcular horas extras despus de la eliminacin\n      await recalcularHorasExtras();\n      \n    } catch (error) {\n      console.error('Error al eliminar horarios:', error);\n      mostrarModal({\n        tipo: 'error',\n        titulo: ' Error al Eliminar',\n        mensaje: `Ocurri un error al eliminar los horarios:\\n\\n${error.message}`,\n        soloInfo: true\n      });\n    } finally {\n      setLoading(false);\n      setDialogoEliminar(false);\n    }\n  };\n\n  const abrirDialogoHorario = useCallback((usuarioId, diaKey) => {\n    // Buscar datos actuales del horario\n    const horariosEditados = window.__HORARIOS_EDITADOS__ || {};\n    const horarios = window.__HORARIOS__ || {};\n    const horarioActual = (horariosEditados[usuarioId]?.[diaKey]) || (horarios[usuarioId]?.[diaKey]);\n    setHorarioPersonalizado({\n      usuarioId,\n      diaKey,\n      tipo: horarioActual?.tipo || 'personalizado',\n      horaInicio: horarioActual?.horaInicio || '',\n      horaFin: horarioActual?.horaFin || '',\n      horaInicioLibre: horarioActual?.horaInicioLibre || '',\n      horaFinLibre: horarioActual?.horaFinLibre || '',\n      nota: horarioActual?.nota || ''\n    });\n    setDialogoHorario(true);\n  }, []);\n\n  // Funcin para manejar copiar horario\n  const handleCopiarHorario = useCallback((usuarioId, diaKey, event) => {\n    if (event) {\n      event.stopPropagation(); // Evitar que se active el click del TimeSlot\n    }\n    \n    const horariosUsuario = editando ? horariosEditados[usuarioId] : horarios[usuarioId];\n    const horarioACopiar = horariosUsuario?.[diaKey];\n    \n    if (!horarioACopiar || !horarioACopiar.tipo || horarioACopiar.tipo === 'libre') {\n      mostrarModal({\n        tipo: 'warning',\n        titulo: ' Sin Horario',\n        mensaje: 'No hay un horario establecido para copiar en este da.',\n        soloInfo: true\n      });\n      return;\n    }\n\n    setHorarioACopiar({\n      ...horarioACopiar,\n      usuarioId,\n      diaOriginal: diaKey\n    });\n    setDialogoCopiar(true);\n  }, [editando, horariosEditados, horarios, mostrarModal]);\n\n  // Funcin para ejecutar la copia del horario\n  const ejecutarCopiarHorario = useCallback(async (diaDestino) => {\n    if (!horarioACopiar || !diaDestino) return;\n\n    try {\n      const nuevoHorario = {\n        tipo: horarioACopiar.tipo,\n        horaInicio: horarioACopiar.horaInicio || '',\n        horaFin: horarioACopiar.horaFin || '',\n        horas: horarioACopiar.horas || 0\n      };\n\n      if (editando) {\n        // Si estamos editando, actualizar el estado temporal\n        setHorariosEditados(prev => ({\n          ...prev,\n          [horarioACopiar.usuarioId]: {\n            ...prev[horarioACopiar.usuarioId],\n            [diaDestino]: nuevoHorario\n          }\n        }));\n      } else {\n        // Si no estamos editando, guardar directamente en Firebase\n        const semanaKey = obtenerClaveSemana(semanaSeleccionada);\n        const horariosRef = ref(database, `horarios_registros/${semanaKey}/${horarioACopiar.usuarioId}/${diaDestino}`);\n        await set(horariosRef, nuevoHorario);\n        \n        // Actualizar el estado local\n        setHorarios(prev => ({\n          ...prev,\n          [horarioACopiar.usuarioId]: {\n            ...prev[horarioACopiar.usuarioId],\n            [diaDestino]: nuevoHorario\n          }\n        }));\n      }\n\n      mostrarModal({\n        tipo: 'success',\n        titulo: ' Horario Copiado',\n        mensaje: `El horario se ha copiado exitosamente de ${DIAS_LABELS[horarioACopiar.diaOriginal]} a ${DIAS_LABELS[diaDestino]}.`,\n        soloInfo: true\n      });\n\n      setDialogoCopiar(false);\n      setHorarioACopiar(null);\n    } catch (error) {\n      console.error('Error al copiar horario:', error);\n      mostrarModal({\n        tipo: 'error',\n        titulo: ' Error al Copiar',\n        mensaje: `Ocurri un error al copiar el horario:\\n\\n${error.message}`,\n        soloInfo: true\n      });\n    }\n  }, [horarioACopiar, editando, semanaSeleccionada, obtenerClaveSemana, mostrarModal]);\n\n  const handleCambiarTurno = useCallback((usuarioId, diaKey) => {\n    if (!editando) return;\n\n    const usuarioActual = usuarios.find(u => u.id === currentUser?.uid);\n    const usuarioObjetivo = usuarios.find(u => u.id === usuarioId);\n\n    if (!usuarioActual || !usuarioObjetivo) return;\n\n    // Verificar permisos usando el nuevo sistema de roles\n    if (!puedeModificarHorarios(usuarioActual, usuarioObjetivo)) {\n      mostrarModal({\n        tipo: 'error',\n        titulo: ' Acceso Denegado',\n        mensaje: 'No tienes permisos para modificar este horario.\\n\\nConsulta con un administrador si necesitas acceso.',\n        soloInfo: true\n      });\n      return;\n    }\n\n    abrirDialogoHorario(usuarioId, diaKey);\n  }, [editando, usuarios, currentUser, abrirDialogoHorario, mostrarModal]);\n\n  const guardarHorarioPersonalizado = () => {\n    const {\n      horaInicio,\n      horaFin,\n      horaInicioLibre,\n      horaFinLibre,\n      usuarioId,\n      diaKey,\n      tipo,\n      nota,\n      // nuevos campos para tele-presencial\n      horaInicioTele,\n      horaFinTele,\n      horaInicioPres,\n      horaFinPres\n    } = horarioPersonalizado;\n\n    const nuevosHorarios = { ...horariosEditados };\n\n    if (!nuevosHorarios[usuarioId]) {\n      nuevosHorarios[usuarioId] = {};\n    }\n\n    // Si es un tipo que no suma horas\n    if (NO_SUMAN_HORAS.includes(tipo)) {\n      nuevosHorarios[usuarioId][diaKey] = {\n        tipo,\n        horaInicio: '00:00',\n        horaFin: '00:00',\n        horas: 0,\n        nota: nota || ''\n      };\n      setHorariosEditados(nuevosHorarios);\n      setDialogoHorario(false);\n      return;\n    }\n\n    // Helper: validar formato HH:mm\n    const horaRegex = /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;\n    const validarHora = (h) => horaRegex.test(h);\n\n    // Helper: calcular horas entre dos HH:mm (soporta cruce de medianoche)\n    const calcHoras = (s, e) => {\n      const [h1, m1] = s.split(':').map(Number);\n      const [h2, m2] = e.split(':').map(Number);\n      if (h2 > h1 || (h2 === h1 && m2 > m1)) {\n        return (h2 - h1) + (m2 - m1) / 60;\n      } else {\n        return (24 - h1 + h2) + (m2 - m1) / 60;\n      }\n    };\n\n    // Rama para el nuevo tipo \"tele-presencial\"\n    if (tipo === 'tele-presencial') {\n      // Ambas parejas son obligatorias\n      if (!horaInicioTele || !horaFinTele || !horaInicioPres || !horaFinPres) {\n        mostrarModal({\n          tipo: 'error',\n          titulo: ' Horario obligatorio',\n          mensaje: 'Debes ingresar los horarios de Teletrabajo y Presencial para guardar la asignacin.',\n          soloInfo: true\n        });\n        return;\n      }\n      // Validar formatos\n      if (!validarHora(horaInicioTele) || !validarHora(horaFinTele) || !validarHora(horaInicioPres) || !validarHora(horaFinPres)) {\n        mostrarModal({\n          tipo: 'error',\n          titulo: ' Formato de Hora Invlido',\n          mensaje: 'El formato de hora debe ser HH:mm (24 horas).',\n          soloInfo: true\n        });\n        return;\n      }\n\n      const horasTele = Number(calcHoras(horaInicioTele, horaFinTele).toFixed(1));\n      const horasPres = Number(calcHoras(horaInicioPres, horaFinPres).toFixed(1));\n      const horasTrabajadas = Number((horasTele + horasPres).toFixed(1));\n\n      // Verificar exceso como en los dems tipos\n      const horasActuales = calcularHorasTotales(\n        usuarioId,\n        editando,\n        horariosEditados,\n        horarios,\n        semanaSeleccionada,\n        semanaActual,\n        {}, // horasExtras\n        (id) => obtenerUsuario(usuarios, id),\n        obtenerHorasMaximas\n      );\n      const usuario = obtenerUsuario(usuarios, usuarioId);\n      const horasMaximas = obtenerHorasMaximas(usuario?.tipoContrato || 'Operativo');\n\n      if (horasActuales + horasTrabajadas > horasMaximas) {\n        const exceso = ((horasActuales + horasTrabajadas) - horasMaximas);\n        const recomendacion = generarRecomendacionPracticantes(\n          usuario,\n          exceso,\n          (horasExceso, departamentoDestino, usuarioExcedidoId) => encontrarPracticantesDisponibles(\n            horasExceso,\n            usuarios,\n            (id, edit) => calcularHorasTotales(\n              id,\n              edit,\n              horariosEditados,\n              horarios,\n              semanaSeleccionada,\n              semanaActual,\n              {},\n              (uid) => obtenerUsuario(usuarios, uid),\n              obtenerHorasMaximas\n            ),\n            obtenerHorasMaximas,\n            departamentoDestino,\n            usuarioExcedidoId\n          )\n        );\n\n        mostrarModal({\n          tipo: 'warning',\n          titulo: ' Exceso de Horas Detectado',\n          mensaje: `${recomendacion}\\n\\nDesea continuar asignando estas horas?`,\n          textoConfirmar: 'Continuar de todas formas',\n          textoCancelar: 'Cancelar',\n          onConfirmar: () => {\n            nuevosHorarios[usuarioId][diaKey] = {\n              tipo,\n              horaInicioTele,\n              horaFinTele,\n              horasTele,\n              horaInicioPres,\n              horaFinPres,\n              horasPres,\n              horas: horasTrabajadas,\n              nota: nota || ''\n            };\n            setHorariosEditados(nuevosHorarios);\n            setDialogoHorario(false);\n            cerrarModal();\n          },\n          onCancelar: cerrarModal\n        });\n        return;\n      }\n\n      // Si no excede, guardar normalmente\n      nuevosHorarios[usuarioId][diaKey] = {\n        tipo,\n        horaInicioTele,\n        horaFinTele,\n        horasTele,\n        horaInicioPres,\n        horaFinPres,\n        horasPres,\n        horas: horasTrabajadas,\n        nota: nota || ''\n      };\n\n      setHorariosEditados(nuevosHorarios);\n      setDialogoHorario(false);\n      return;\n    }\n\n    // Validacin general para tipos que requieren horaInicio/horaFin\n    if (!horaInicio || !horaFin) {\n      mostrarModal({\n        tipo: 'error',\n        titulo: ' Horario obligatorio',\n        mensaje: 'Debes ingresar la hora de inicio y la hora de fin para guardar el horario.',\n        soloInfo: true\n      });\n      return;\n    }\n\n    if (!validarHora(horaInicio) || !validarHora(horaFin)) {\n      mostrarModal({\n        tipo: 'error',\n        titulo: ' Formato de Hora Invlido',\n        mensaje: 'El formato de hora debe ser HH:mm (24 horas).\\n\\nEjemplos vlidos:\\n 08:30\\n 14:45\\n 23:00',\n        soloInfo: true\n      });\n      return;\n    }\n\n    const inicio = convertirA24h(horaInicio);\n    const fin = convertirA24h(horaFin);\n\n    let horasTrabajadas = 0;\n    if (fin.hora > inicio.hora || (fin.hora === inicio.hora && fin.minutos > inicio.minutos)) {\n      horasTrabajadas = (fin.hora - inicio.hora) + (fin.minutos - inicio.minutos) / 60;\n    } else {\n      horasTrabajadas = (24 - inicio.hora + fin.hora) + (fin.minutos - inicio.minutos) / 60;\n    }\n\n    // Exceso chequeo (reutiliza la lgica ya existente)\n    const horasActuales = calcularHorasTotales(\n      usuarioId,\n      editando,\n      horariosEditados,\n      horarios,\n      semanaSeleccionada,\n      semanaActual,\n      {}, // horasExtras\n      (id) => obtenerUsuario(usuarios, id),\n      obtenerHorasMaximas\n    );\n    const usuario = obtenerUsuario(usuarios, usuarioId);\n    const horasMaximas = obtenerHorasMaximas(usuario?.tipoContrato || 'Operativo');\n\n    if (horasActuales + horasTrabajadas > horasMaximas) {\n      const exceso = ((horasActuales + horasTrabajadas) - horasMaximas);\n      const recomendacion = generarRecomendacionPracticantes(\n        usuario,\n        exceso,\n        (horasExceso, departamentoDestino, usuarioExcedidoId) => encontrarPracticantesDisponibles(\n          horasExceso,\n          usuarios,\n          (id, edit) => calcularHorasTotales(\n            id,\n            edit,\n            horariosEditados,\n            horarios,\n            semanaSeleccionada,\n            semanaActual,\n            {},\n            (uid) => obtenerUsuario(usuarios, uid),\n            obtenerHorasMaximas\n          ),\n          obtenerHorasMaximas,\n          departamentoDestino,\n          usuarioExcedidoId\n        )\n      );\n\n      mostrarModal({\n        tipo: 'warning',\n        titulo: ' Exceso de Horas Detectado',\n        mensaje: `${recomendacion}\\n\\nDesea continuar asignando estas horas?`,\n        textoConfirmar: 'Continuar de todas formas',\n        textoCancelar: 'Cancelar',\n        onConfirmar: () => {\n          if (tipo === 'tarde-libre') {\n            nuevosHorarios[usuarioId][diaKey] = {\n              tipo,\n              horaInicio,\n              horaFin,\n              horaInicioLibre: horaInicioLibre || '',\n              horaFinLibre: horaFinLibre || '',\n              horas: horasTrabajadas,\n              nota: nota || ''\n            };\n          } else {\n            nuevosHorarios[usuarioId][diaKey] = {\n              tipo,\n              horaInicio,\n              horaFin,\n              horas: horasTrabajadas,\n              nota: nota || ''\n            };\n          }\n          setHorariosEditados(nuevosHorarios);\n          setDialogoHorario(false);\n          cerrarModal();\n        },\n        onCancelar: cerrarModal\n      });\n      return;\n    }\n\n    // Guardado normal para resto de tipos\n    if (tipo === 'tarde-libre') {\n      nuevosHorarios[usuarioId][diaKey] = {\n        tipo,\n        horaInicio,\n        horaFin,\n        horaInicioLibre: horaInicioLibre || '',\n        horaFinLibre: horaFinLibre || '',\n        horas: horasTrabajadas,\n        nota: nota || ''\n      };\n    } else {\n      nuevosHorarios[usuarioId][diaKey] = {\n        tipo,\n        horaInicio,\n        horaFin,\n        horas: horasTrabajadas,\n        nota: nota || ''\n      };\n    }\n\n    setHorariosEditados(nuevosHorarios);\n    setDialogoHorario(false);\n  };\n\n  // Vuelve a agregar la funcin helper:\n  const calcularExceso = useCallback((usuarioId) => {\n    return calcularHorasExcedentes(\n      usuarioId,\n      editando,\n      horariosEditados,\n      horarios,\n      (id) => obtenerUsuario(usuarios, id),\n      obtenerHorasMaximas\n    );\n  }, [editando, horariosEditados, horarios, usuarios]);\n\n  // Control de acceso visual: solo usuarios con permiso pueden ver el mdulo\n  const usuarioActual = usuarios.find(u => u.id === currentUser?.uid);\n  if (loading) {\n    return (\n      <Container component=\"main\" maxWidth=\"sm\" sx={{ py: 8, textAlign: 'center' }}>\n        <Paper elevation={0} sx={{ p: 4, textAlign: 'center', boxShadow: 'none', background: 'none' }}>\n          <Typography variant=\"h6\" color=\"text.secondary\">Cargando...</Typography>\n        </Paper>\n      </Container>\n    );\n  }\n  if (!usuarioActual || !puedeVerHorarios(usuarioActual)) {\n    return null;\n  }\n\n  // Renderizado principal del componente\n  return (\n    <Container maxWidth=\"xl\" sx={{ py: { xs: 1, sm: 2, md: 3 } }}>\n      <StyledPaper elevation={3}>\n        <HeaderSemana\n          departamentos={departamentos}\n          departamentoSeleccionado={departamentoSeleccionado}\n          setDepartamentoSeleccionado={setDepartamentoSeleccionado}\n          loading={loading}\n          semanaSeleccionada={semanaSeleccionada}\n          setSemanaSeleccionada={setSemanaSeleccionada}\n          yearSelected={yearSelected}\n          setYearSelected={setYearSelected}\n          monthSelected={monthSelected}\n          setMonthSelected={setMonthSelected}\n          datePickerOpen={datePickerOpen}\n          setDatePickerOpen={setDatePickerOpen}\n          anchorEl={anchorEl}\n          setAnchorEl={setAnchorEl}\n          avanzarSemana={avanzarSemana}\n          retrocederSemana={retrocederSemana}\n        />\n\n        {/* Recomendaciones de practicantes */}\n        {editando && <RecomendacionesPracticantes \n          usuariosFiltrados={usuariosFiltrados}\n          calcularHorasExcedentes={(usuarioId) =>\n            calcularHorasExcedentes(\n              usuarioId,\n              editando,\n              horariosEditados,\n              horarios,\n              (id) => obtenerUsuario(usuarios, id),\n              obtenerHorasMaximas\n            )\n          }\n          // Pasamos un wrapper que suministra los argumentos que la utilidad espera\n          encontrarPracticantesDisponibles={(horasNecesarias, departamentoDestino = null, usuarioExcedidoId = null) =>\n            encontrarPracticantesDisponibles(\n              horasNecesarias,\n              usuarios,\n              (id, edit) => calcularHorasTotales(\n                id,\n                edit,\n                horariosEditados,\n                horarios,\n                semanaSeleccionada,\n                semanaActual,\n                {},\n                (uid) => obtenerUsuario(usuarios, uid),\n                obtenerHorasMaximas\n              ),\n              obtenerHorasMaximas,\n              departamentoDestino,\n              usuarioExcedidoId\n            )\n          }\n        />}\n        {/* Mensaje informativo sobre consideraciones */}\n        <Alert severity=\"info\" sx={{ m: 3, mb: 1, textAlign: 'left' }}>\n          <Typography variant=\"body2\">\n            <strong>Consideraciones importantes:</strong>\n          </Typography>\n          <Typography variant=\"body2\" component=\"div\" sx={{ mt: 1, textAlign: 'left' }}>\n             Recordar el tipo de jornada segn su tipo de contrato<br />\n             Verificar disponibilidad antes de asignar horarios<br />\n             Recordar que el descanso minimo entre jornadas es de 12 horas<br />\n             Las horas acumuladas deben compensarse a la semana siguiente<br />\n          </Typography>\n        </Alert>\n\n        {/* Tabla de horarios */}\n        <HorariosTable\n          isMobile={isMobile}\n          isSmallMobile={isSmallMobile}\n          usuariosFiltrados={usuariosFiltrados}\n          editando={editando}\n          horarios={horarios}\n          horariosEditados={horariosEditados}\n          currentUser={usuarios.find(u => u.id === currentUser?.uid)}\n          handleCambiarTurno={handleCambiarTurno}\n          abrirInfoTurno={abrirInfoTurno}\n          handleCopiarHorario={handleCopiarHorario}\n          NO_SUMAN_HORAS={NO_SUMAN_HORAS}\n          calcularExceso={calcularExceso}\n          calcularHorasTotales={calcularHorasTotales}\n          semanaSeleccionada={semanaSeleccionada}\n          semanaActual={semanaActual}\n          obtenerUsuario={obtenerUsuario}\n          obtenerHorasMaximas={obtenerHorasMaximas}\n          diasSemana={diasSemana}\n        />\n\n        {/* Botones de accin */}\n        <Box sx={{ \n          p: { xs: 1.5, sm: 3, md: 3 },\n          borderTop: '1px solid',\n          borderColor: 'divider',\n          display: 'flex',\n          gap: { xs: 1, sm: 2 },\n          flexDirection: isSmallMobile ? 'column' : 'row',\n          justifyContent: 'center',\n          alignItems: 'stretch',\n          position: 'relative'\n        }}>\n          {loading && (\n            <Box sx={{\n              position: 'absolute',\n              inset: 0,\n              bgcolor: 'rgba(255,255,255,0.5)',\n              backdropFilter: 'blur(1px)',\n              borderRadius: 1,\n              zIndex: 1\n            }} />\n          )}\n          {!editando ? (\n            <>\n              <Button \n                variant=\"contained\" \n                color=\"primary\"\n                onClick={iniciarEdicion}\n                disabled={loading || !puedeEditarHorarios(usuarios.find(u => u.id === currentUser?.uid))}\n                size={isMobile ? 'medium' : 'large'}\n                fullWidth={isSmallMobile}\n                sx={{\n                  flex: isSmallMobile ? 'none' : 1,\n                  maxWidth: isSmallMobile ? '100%' : '200px'\n                }}\n              >\n                Editar Horarios\n              </Button>\n              \n              <Button \n                variant=\"outlined\" \n                sx={{\n                  borderColor: '#d32f2f',\n                  color: '#d32f2f',\n                  '&:hover': {\n                    borderColor: '#b71c1c',\n                    backgroundColor: 'rgba(211, 47, 47, 0.04)'\n                  },\n                  flex: isSmallMobile ? 'none' : 1,\n                  maxWidth: isSmallMobile ? '100%' : '200px'\n                }}\n                onClick={() => setDialogoEliminar(true)}\n                disabled={loading || !puedeEliminarHorarios(usuarios.find(u => u.id === currentUser?.uid))}\n                size={isMobile ? 'medium' : 'large'}\n                fullWidth={isSmallMobile}\n              >\n                Eliminar Horarios\n              </Button>\n            </>\n          ) : (\n            <>\n              <Button \n                variant=\"outlined\" \n                onClick={() => {\n                  setEditando(false);\n                  setHorariosEditados({});\n                }}\n                disabled={loading}\n                size={isMobile ? 'medium' : 'large'}\n                fullWidth={isSmallMobile}\n                sx={{\n                  flex: isSmallMobile ? 'none' : 1,\n                  maxWidth: isSmallMobile ? '100%' : '200px'\n                }}\n              >\n                Cancelar\n              </Button>\n              \n              <Button \n                variant=\"contained\" \n                color=\"primary\"\n                onClick={handleGuardarHorarios}\n                disabled={loading}\n                size={isMobile ? 'medium' : 'large'}\n                fullWidth={isSmallMobile}\n                sx={{\n                  flex: isSmallMobile ? 'none' : 1,\n                  maxWidth: isSmallMobile ? '100%' : '200px'\n                }}\n              >\n                Guardar Horarios\n              </Button>\n            </>\n          )}\n        </Box>\n      </StyledPaper>\n\n      {/* Dilogos */}\n      <DialogoHorario \n        dialogoHorario={dialogoHorario}\n        setDialogoHorario={setDialogoHorario}\n        horarioPersonalizado={horarioPersonalizado}\n        setHorarioPersonalizado={setHorarioPersonalizado}\n        guardarHorarioPersonalizado={guardarHorarioPersonalizado}\n        isMobile={isMobile}\n        isSmallMobile={isSmallMobile}\n        currentUser={usuarios.find(u => u.id === currentUser?.uid) || null}\n        usuarios={usuarios}\n        editando={editando}\n        horariosEditados={horariosEditados}\n        setHorariosEditados={setHorariosEditados}\n        horarios={horarios}\n        setHorarios={setHorarios}\n        semanaSeleccionada={semanaSeleccionada}\n        obtenerClaveSemana={obtenerClaveSemana}\n      />\n      <DialogoEliminar \n        dialogoEliminar={dialogoEliminar}\n        setDialogoEliminar={setDialogoEliminar}\n        eliminacionSeleccionada={eliminacionSeleccionada}\n        setEliminacionSeleccionada={setEliminacionSeleccionada}\n        handleEliminarSeleccionado={handleEliminarSeleccionado}\n        currentUser={currentUser}\n        usuarios={usuarios}\n        horarios={horarios}\n        isMobile={isMobile}\n        isSmallMobile={isSmallMobile}\n      />\n      <DialogoCopiar \n        dialogoCopiar={dialogoCopiar}\n        setDialogoCopiar={setDialogoCopiar}\n        horarioACopiar={horarioACopiar}\n        setHorarioACopiar={setHorarioACopiar}\n        ejecutarCopiarHorario={ejecutarCopiarHorario}\n        editando={editando}\n        horariosEditados={horariosEditados}\n        horarios={horarios}\n      />\n      <ModalConfirmacion modalConfirmacion={modalConfirmacion} cerrarModalConfirmacion={cerrarModal} />\n      <InfoTurnoModal\n        open={infoModalOpen}\n        onClose={() => { cerrarInfoTurno(); setModalDiaKey(null); }}\n        usuario={modalUsuario}\n        turno={modalTurno}\n        diaKey={modalDiaKey}\n        semanaSeleccionada={semanaSeleccionada}\n      />\n    </Container>\n  );\n};\n\nexport default Horarios;","import { useState, useEffect } from 'react';\r\nimport { database, auth } from '../firebase/config';\r\nimport { ref, get } from 'firebase/database';\r\nimport { toast } from 'react-toastify';\r\nimport { departamentos } from '../utils/horariosConstants';\r\n\r\n/**\r\n * Hook para cargar usuarios y gestionar departamento seleccionado y usuario actual.\r\n */\r\nexport function useUsuariosYHorarios() {\r\n  const [loading, setLoading] = useState(true);\r\n  const [usuarios, setUsuarios] = useState([]);\r\n  const [departamentoSeleccionado, setDepartamentoSeleccionado] = useState('');\r\n  const [currentUser, setCurrentUser] = useState(null);\r\n\r\n  useEffect(() => {\r\n    async function cargarUsuarios() {\r\n      try {\r\n        setLoading(true);\r\n        const user = auth.currentUser;\r\n        if (!user) return;\r\n        setCurrentUser(user);\r\n\r\n        const usuariosRef = ref(database, 'usuarios');\r\n        const snapshot = await get(usuariosRef);\r\n        if (snapshot.exists()) {\r\n          const data = snapshot.val();\r\n          const array = Object.entries(data).map(([id, userData]) => ({\r\n            id,\r\n            ...userData,\r\n            tipoContrato: userData.tipoContrato || 'Operativo'\r\n          }));\r\n          setUsuarios(array);\r\n\r\n          const usuarioActual = array.find(u => u.id === user.uid);\r\n          if (usuarioActual) {\r\n            setDepartamentoSeleccionado(usuarioActual.departamento);\r\n          } else if (departamentos.length > 0) {\r\n            setDepartamentoSeleccionado(departamentos[0]);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Error al cargar usuarios:', error);\r\n        toast.error('Error al cargar usuarios: ' + error.message);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n    cargarUsuarios();\r\n  }, []);\r\n\r\n  return {\r\n    loading,\r\n    usuarios,\r\n    departamentoSeleccionado,\r\n    setDepartamentoSeleccionado,\r\n    currentUser\r\n  };\r\n}\r\n","import { useState, useCallback } from 'react';\r\nimport { startOfWeek, addWeeks, subWeeks, getISOWeek, getYear } from 'date-fns';\r\n\r\n/**\r\n * Hook para manejar la semana seleccionada y utilidades de semana.\r\n */\r\nexport function useSemana() {\r\n  const inicial = startOfWeek(new Date(), { weekStartsOn: 1 });\r\n  const [semanaActual] = useState(inicial);\r\n  const [semanaSeleccionada, setSemanaSeleccionada] = useState(inicial);\r\n\r\n  const avanzarSemana = useCallback(() => {\r\n    setSemanaSeleccionada(prev => addWeeks(prev, 1));\r\n  }, []);\r\n\r\n  const retrocederSemana = useCallback(() => {\r\n    setSemanaSeleccionada(prev => subWeeks(prev, 1));\r\n  }, []);\r\n\r\n  const obtenerClaveSemana = useCallback(fecha => {\r\n    const inicio = startOfWeek(fecha, { weekStartsOn: 1 });\r\n    const year = getYear(inicio);\r\n    const week = getISOWeek(inicio);\r\n    return `${year}-${week}`;\r\n  }, []);\r\n\r\n  return {\r\n    semanaActual,\r\n    semanaSeleccionada,\r\n    setSemanaSeleccionada,\r\n    avanzarSemana,\r\n    retrocederSemana,\r\n    obtenerClaveSemana\r\n  };\r\n}\r\n","import { useState, useCallback } from 'react';\r\n\r\n/**\r\n * Hook para gestionar un modal de confirmacin genrico.\r\n */\r\nexport function useModalConfirm() {\r\n  const [modalConfirmacion, setModalConfirmacion] = useState({\r\n    abierto: false,\r\n    tipo: 'info',\r\n    titulo: '',\r\n    mensaje: '',\r\n    textoConfirmar: 'Confirmar',\r\n    textoCancelar: 'Cancelar',\r\n    onConfirmar: null,\r\n    onCancelar: null,\r\n    soloInfo: false,\r\n  });\r\n\r\n  const mostrarModal = useCallback((options) => {\r\n    setModalConfirmacion({ abierto: true, ...options });\r\n  }, []);\r\n\r\n  const cerrarModal = useCallback(() => {\r\n    setModalConfirmacion((prev) => ({ ...prev, abierto: false }));\r\n  }, []);\r\n\r\n  return { modalConfirmacion, mostrarModal, cerrarModal };\r\n}\r\n","import { useMemo } from 'react';\r\n\r\nexport function useUsuariosFiltrados(usuarios, departamentoSeleccionado) {\r\n  return useMemo(() => {\r\n    if (!usuarios) return [];\r\n    if (!departamentoSeleccionado) return usuarios;\r\n    return usuarios.filter(u => u.departamento === departamentoSeleccionado);\r\n  }, [usuarios, departamentoSeleccionado]);\r\n}\r\n","export const departamentos = [\r\n  'Planeacin de Eventos',\r\n  'Gestin de la Proteccin',\r\n  'reas & Sostenibilidad',\r\n  'Gastronoma',\r\n  'Infraestructura',\r\n  'Financiero',\r\n  'Oficina de Atencin al Expositor',\r\n  'Practicantes/Crosstraining',\r\n  'Talento Humano',\r\n  'Calidad',\r\n  'Sistemas',\r\n  'Mercadeo y Ventas',\r\n  'Compras',\r\n  'Gerencia de Operaciones',\r\n  'Gerencia General',\r\n  'UDEI'\r\n];\r\n\r\nexport const diasSemana = [\r\n  'Lunes', 'Martes', 'Mircoles', 'Jueves', 'Viernes', 'Sbado', 'Domingo'\r\n];\r\n\r\nexport const NO_SUMAN_HORAS = [\r\n  'descanso', 'vacaciones', 'feriado', 'permiso', 'dia-brigada', 'fuera-oficina', 'incapacidad-enfermedad', 'incapacidad-accidente'\r\n  // 'viaje-trabajo' NO debe estar aqu\r\n];\r\n\r\nexport const DIAS_LABELS = {\r\n  dia1: 'Lunes',\r\n  dia2: 'Martes',\r\n  dia3: 'Mircoles',\r\n  dia4: 'Jueves',\r\n  dia5: 'Viernes',\r\n  dia6: 'Sbado',\r\n  dia7: 'Domingo'\r\n};\r\n\r\nexport const TIPO_LABEL = {\r\n  personalizado: 'Presencial',\r\n  teletrabajo: 'Teletrabajo',\r\n  cambio: 'Cambio',\r\n  descanso: 'Descanso',\r\n  vacaciones: 'Vacaciones',\r\n  feriado: 'Feriado',\r\n  permiso: 'Permiso',\r\n  'tarde-libre': 'Tarde Libre',\r\n  'dia-brigada': 'Brigada',\r\n  'fuera-oficina': 'Fuera de Oficina',\r\n  'viaje-trabajo': 'Viaje de Trabajo',\r\n  'incapacidad-enfermedad': 'Incapacidad por Enfermedad',\r\n  'incapacidad-accidente': 'Incapacidad por Accidente',\r\n  'tele-presencial': 'Teletrabajo & Presencial'\r\n};","/**\r\n * Utilidades para manejo de tipos de contrato, roles y restricciones de horas\r\n */\r\n\r\n// Tipos de contrato disponibles\r\nexport const TIPOS_CONTRATO = {\r\n  OPERATIVO: 'Operativo',\r\n  CONFIANZA: 'Confianza'\r\n};\r\n\r\n// Roles disponibles en el sistema\r\nexport const ROLES = {\r\n  ADMINISTRADOR: 'Administrador',\r\n  MODIFICADOR: 'Modificador', \r\n  VISOR: 'Visor'\r\n};\r\n\r\n// Horas mximas permitidas por tipo de contrato\r\nexport const HORAS_MAXIMAS_POR_TIPO = {\r\n  [TIPOS_CONTRATO.OPERATIVO]: 48,\r\n  [TIPOS_CONTRATO.CONFIANZA]: 72\r\n};\r\n\r\n/**\r\n * Obtiene las horas mximas permitidas para un tipo de contrato\r\n * @param {string} tipoContrato - El tipo de contrato del usuario\r\n * @returns {number} Las horas mximas permitidas\r\n */\r\nexport const obtenerHorasMaximas = (tipoContrato) => {\r\n  return HORAS_MAXIMAS_POR_TIPO[tipoContrato] || HORAS_MAXIMAS_POR_TIPO[TIPOS_CONTRATO.OPERATIVO];\r\n};\r\n\r\n/**\r\n * Valida si las horas trabajadas exceden el lmite para el tipo de contrato\r\n * @param {number} horasTrabajadas - Las horas trabajadas en la semana\r\n * @param {string} tipoContrato - El tipo de contrato del usuario\r\n * @returns {boolean} true si excede el lmite, false en caso contrario\r\n */\r\nexport const excedeHorasMaximas = (horasTrabajadas, tipoContrato) => {\r\n  const horasMaximas = obtenerHorasMaximas(tipoContrato);\r\n  return horasTrabajadas > horasMaximas;\r\n};\r\n\r\n/**\r\n * Obtiene un mensaje descriptivo sobre las restricciones de horas\r\n * @param {string} tipoContrato - El tipo de contrato del usuario\r\n * @returns {string} Mensaje descriptivo de las restricciones\r\n */\r\nexport const obtenerMensajeRestriccionHoras = (tipoContrato) => {\r\n  const horasMaximas = obtenerHorasMaximas(tipoContrato);\r\n  return `Los empleados de tipo ${tipoContrato} tienen un lmite de ${horasMaximas} horas semanales.`;\r\n};\r\n\r\n/**\r\n * Verifica si un usuario puede modificar tipos de contrato\r\n * @param {Object} usuario - El objeto usuario con sus datos\r\n * @returns {boolean} true si puede modificar tipos de contrato\r\n */\r\nexport const puedeModificarTipoContrato = (usuario) => {\r\n  return usuario?.departamento === 'Talento Humano';\r\n};\r\n\r\n/**\r\n * Verifica si un usuario puede asignar roles\r\n * @param {Object} usuario - El objeto usuario con sus datos\r\n * @returns {boolean} true si puede asignar roles\r\n */\r\nexport const puedeAsignarRoles = (usuario) => {\r\n  return usuario?.rol === ROLES.ADMINISTRADOR || \r\n         usuario?.departamento === 'Talento Humano' ||\r\n         usuario?.email === 'admin@costaricacc.com';\r\n};\r\n\r\n/**\r\n * Verifica si un usuario puede modificar horarios\r\n * @param {Object} usuario - El objeto usuario con sus datos\r\n * @param {Object} objetivoUsuario - El usuario objetivo a modificar (opcional)\r\n * @returns {boolean} true si puede modificar horarios\r\n */\r\nexport const puedeModificarHorarios = (usuario, objetivoUsuario = null) => {\r\n  // Administradores pueden modificar todo\r\n  if (usuario?.rol === ROLES.ADMINISTRADOR) {\r\n    return true;\r\n  }\r\n  \r\n  // Modificadores pueden modificar horarios de su departamento\r\n  if (usuario?.rol === ROLES.MODIFICADOR) {\r\n    if (!objetivoUsuario) return true; // Permiso general para el departamento\r\n    return usuario?.departamento === objetivoUsuario?.departamento;\r\n  }\r\n  \r\n  // Visores no pueden modificar nada\r\n  if (usuario?.rol === ROLES.VISOR) {\r\n    return false;\r\n  }\r\n  \r\n  // Usuarios sin rol especfico mantienen la lgica anterior\r\n  return usuario?.departamento === 'Talento Humano' || \r\n         usuario?.email === 'admin@costaricacc.com';\r\n};\r\n\r\n/**\r\n * Verifica si un usuario puede ver horarios\r\n * @param {Object} usuario - El objeto usuario con sus datos\r\n * @param {Object} objetivoUsuario - El usuario objetivo a ver (opcional)\r\n * @returns {boolean} true si puede ver horarios\r\n */\r\nexport const puedeVerHorarios = (usuario, objetivoUsuario = null) => {\r\n  // Administradores pueden ver todo\r\n  if (usuario?.rol === ROLES.ADMINISTRADOR) {\r\n    return true;\r\n  }\r\n  \r\n  // Modificadores y Visores pueden ver horarios de su departamento\r\n  if (usuario?.rol === ROLES.MODIFICADOR || usuario?.rol === ROLES.VISOR) {\r\n    if (!objetivoUsuario) return true; // Permiso general para el departamento\r\n    return usuario?.departamento === objetivoUsuario?.departamento;\r\n  }\r\n  \r\n  // Usuarios sin rol especfico mantienen la lgica anterior\r\n  return usuario?.departamento === 'Talento Humano' || \r\n         usuario?.email === 'admin@costaricacc.com';\r\n};\r\n\r\n/**\r\n * Verifica si un usuario puede acceder al mdulo de personal\r\n * @param {Object} usuario - El objeto usuario con sus datos\r\n * @returns {boolean} true si puede acceder al mdulo de personal\r\n */\r\nexport const puedeAccederPersonal = (usuario) => {\r\n  return usuario?.rol === ROLES.ADMINISTRADOR ||\r\n         usuario?.departamento === 'Talento Humano' ||\r\n         usuario?.email === 'admin@costaricacc.com';\r\n};\r\n\r\n/**\r\n * Obtiene el color del chip segn el rol\r\n * @param {string} rol - El rol del usuario\r\n * @returns {string} El color del chip para Material-UI\r\n */\r\nexport const obtenerColorRol = (rol) => {\r\n  switch (rol) {\r\n    case ROLES.ADMINISTRADOR:\r\n      return 'error'; // Rojo para administrador\r\n    case ROLES.MODIFICADOR:\r\n      return 'warning'; // Naranja para modificador\r\n    case ROLES.VISOR:\r\n      return 'info'; // Azul para visor\r\n    default:\r\n      return 'default'; // Gris por defecto\r\n  }\r\n};\r\n\r\n/**\r\n * Obtiene una descripcin del rol\r\n * @param {string} rol - El rol del usuario\r\n * @returns {string} Descripcin del rol\r\n */\r\nexport const obtenerDescripcionRol = (rol) => {\r\n  switch (rol) {\r\n    case ROLES.ADMINISTRADOR:\r\n      return 'Puede realizar todos los cambios en la plataforma';\r\n    case ROLES.MODIFICADOR:\r\n      return 'Puede modificar horarios de su departamento';\r\n    case ROLES.VISOR:\r\n      return 'Solo puede ver horarios, sin modificaciones';\r\n    default:\r\n      return 'Sin rol especfico asignado';\r\n  }\r\n};\r\n"],"names":["_ref","semanaSeleccionada","setSemanaSeleccionada","datePickerOpen","setDatePickerOpen","anchorEl","setAnchorEl","theme","useTheme","isMobile","useMediaQuery","breakpoints","down","handleClose","handleChangeSemana","weeks","addWeeks","_jsxs","Box","sx","display","alignItems","children","_jsx","Button","startIcon","CalendarTodayIcon","onClick","event","currentTarget","size","fontWeight","fontSize","px","py","minWidth","format","locale","es","Popover","open","onClose","anchorOrigin","vertical","horizontal","p","Typography","variant","mb","Grid","container","spacing","item","IconButton","ArrowBackIosNewIcon","ArrowForwardIosIcon","HeaderSemana","departamentos","departamentoSeleccionado","setDepartamentoSeleccionado","loading","yearSelected","setYearSelected","monthSelected","setMonthSelected","avanzarSemana","retrocederSemana","xs","sm","md","borderBottom","borderColor","FormControl","fullWidth","InputLabel","Select","value","onChange","e","target","disabled","map","depto","MenuItem","gap","flexWrap","justifyContent","bgcolor","style","CustomDateSelector","usuariosFiltrados","calcularHorasExcedentes","encontrarPracticantesDisponibles","usuariosExcedidos","filter","u","exceso","id","Math","round","length","my","Alert","severity","icon","WarningIcon","usuario","rawExceso","horasExceso","practicantes","nombre","apellidos","Chip","label","concat","toFixed","color","ml","mt","slice","horasDisponibles","localValue","setLocalValue","useState","useEffect","timeRegex","TextField","newValue","test","onBlur","handleBlur","placeholder","InputLabelProps","shrink","async","guardarHorariosUsuarioSemana","semanaKey","usuarioId","horariosUsuario","Object","keys","set","ref","database","updates","diaKey","valor","entries","maxRetries","attempt","lastErr","update","delay","Promise","res","setTimeout","puedeEliminarHorarios","ROLES","ADMINISTRADOR","MODIFICADOR","includes","rol","puedeModificarHorarios","usuarioActual","usuarioObjetivo","departamento","dialogoHorario","setDialogoHorario","horarioPersonalizado","setHorarioPersonalizado","guardarHorarioPersonalizado","isSmallMobile","currentUser","usuarios","editando","horariosEditados","setHorariosEditados","horarios","setHorarios","obtenerClaveSemana","find","puedeEliminar","console","log","React","horarioActual","_horariosEditados$usu","_horarios$usuarioId","prev","_horarioActual","_horarioActual2","_horarioActual3","_horarioActual4","_horarioActual5","_horarioActual6","_objectSpread","tipo","horaInicio","horaFin","horaInicioLibre","horaFinLibre","nota","handleTimeChange","field","horasLaboradas","h1","m1","split","Number","h2","m2","Dialog","fullScreen","maxWidth","TransitionComponent","Slide","TransitionProps","direction","DialogTitle","pb","DialogContent","nuevoTipo","horas","_Fragment","TimeInput","horaInicioTele","horaFinTele","horaInicioPres","horaFinPres","s","v","_unused","_unused2","calc","multiline","minRows","maxRows","DialogActions","flexDirection","refPath","eliminarHorarioDeUsuario","nuevos","error","diasSemana","dialogoEliminar","setDialogoEliminar","eliminacionSeleccionada","setEliminacionSeleccionada","handleEliminarSeleccionado","uid","esAdministrador","dia","diasSeleccionados","horariosUsuarioActual","diasConHorarios","index","tieneHorario","estaSeleccionado","backgroundColor","d","toggleDiaSeleccionado","diaIndex","parseInt","replace","join","diasKeys","TIPO_LABEL","personalizado","teletrabajo","cambio","descanso","vacaciones","feriado","permiso","_horarioACopiar$horas","dialogoCopiar","setDialogoCopiar","horarioACopiar","setHorarioACopiar","ejecutarCopiarHorario","yaOcupado","esDiaOriginal","diaOriginal","handleSeleccionarDia","modalConfirmacion","cerrarModalConfirmacion","abierto","titulo","mensaje","textoConfirmar","textoCancelar","onConfirmar","onCancelar","soloInfo","iconos","success","CheckCircleIcon","ErrorIcon","warning","info","InfoIcon","textAlign","pt","whiteSpace","lineHeight","_turno$horas","turno","pl","idx","fecha","addDays","dividers","gutterBottom","charAt","toUpperCase","obtenerColorRol","obtenerEtiquetaRol","convertirA24h","hora","h","m","minutos","calcularHorasTotales","arguments","undefined","semanaActual","horasExtras","obtenerUsuario","obtenerHorasMaximas","mostrarReal","horariosSafe","NO_SUMAN_HORAS","total","values","reduce","getTime","horasExtrasPrevias","horasMaximas","tipoContrato","horasMinimas","min","max","horasTotales","horasNecesarias","calcularHorasTotalesFn","departamentoDestino","usuarioExcedidoId","safeUsuarios","Array","isArray","safeHorasNecesarias","compaerosDisponibles","compaero","c","practicantesDisponibles","departamentosAutorizados","practicante","sort","a","b","generarRecomendacionPracticantes","usuarioExcedido","encontrarPracticantesDisponiblesFn","disponibles","recomendaciones","TIPOS_SOLO_LABEL","_horario$horas","_horario$horas2","handleCambiarTurno","handleCopiarHorario","horario","soloLabel","copiarColor","minHeight","borderRadius","border","cursor","position","top","right","width","height","padding","boxShadow","fontStyle","abrirInfoTurno","calcularExceso","overflowX","Paper","elevation","ContentCopyIcon","align","_","TurnoUsuario","StyledPaper","styled","margin","Horarios","setLoading","setUsuarios","setCurrentUser","user","auth","usuariosRef","snapshot","get","exists","data","val","array","userData","toast","message","cargarUsuarios","useUsuariosYHorarios","inicial","startOfWeek","Date","weekStartsOn","useCallback","subWeeks","inicio","year","getYear","week","getISOWeek","useSemana","setEditando","bufferEditSemanas","setBufferEditSemanas","lastLoadedWeekKey","setLastLoadedWeekKey","getMonth","mostrarModal","cerrarModal","setModalConfirmacion","options","useModalConfirm","infoModalOpen","setInfoModalOpen","modalUsuario","setModalUsuario","modalTurno","setModalTurno","modalDiaKey","setModalDiaKey","useMemo","useUsuariosFiltrados","iniciarEdicion","puedeGuardarTodos","key","unsubscribe","r","onValue","off","subscribeHorariosSemana","fallback","fechaSemana","horariosRef","horariosSnapshot","cargarHorariosPorSemana","clearTimeout","existente","init","recalcularHorasExtras","horariosActuales","nuevasHorasExtras","forEach","horasExcedentes","handleGuardarHorarios","currentWeekKey","buffers","esAdmin","operaciones","weekKey","propios","paths","parts","err","warn","updatesObject","mergedUpdates","backup","uuidv4","timestamp","now","payload","pathKey","childKey","childVal","guardarBatchHorarios","abrirDialogoHorario","window","__HORARIOS_EDITADOS__","__HORARIOS__","stopPropagation","diaDestino","nuevoHorario","DIAS_LABELS","Container","component","background","puedeVerHorarios","RecomendacionesPracticantes","edit","HorariosTable","borderTop","inset","backdropFilter","zIndex","flex","DialogoHorario","nuevosHorarios","horaRegex","validarHora","calcHoras","horasTele","horasPres","horasTrabajadas","horasActuales","recomendacion","fin","DialogoEliminar","nuevo","newState","huboEliminacion","DialogoCopiar","ModalConfirmacion","InfoTurnoModal","dia1","dia2","dia3","dia4","dia5","dia6","dia7","TIPOS_CONTRATO","OPERATIVO","CONFIANZA","VISOR","HORAS_MAXIMAS_POR_TIPO","obtenerMensajeRestriccionHoras","puedeModificarTipoContrato","puedeAsignarRoles","email","objetivoUsuario","puedeAccederPersonal","obtenerDescripcionRol"],"sourceRoot":""}