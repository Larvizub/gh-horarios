"use strict";(self.webpackChunkcostaricacc_horarios=self.webpackChunkcostaricacc_horarios||[]).push([[429],{429:(e,o,i)=>{i.r(o),i.d(o,{default:()=>Ce});var a=i(6832),r=i(2660),n=i(6857),t=i(3106),s=i(8621),l=i(2735),d=i(2384),c=i(2260),u=i(6647),h=i(6347),m=i(4184),x=i(6121),p=i(2244),b=i(4153),f=i(1296),v=i(7237),A=i(2729),g=i(4909),j=i(6534),S=i(1608),y=i(2250),I=i(8229),C=i(7611),O=i(9139),F=i(2691),k=i(721),H=i(8217),M=i(632);const D=e=>{let{semanaSeleccionada:o,setSemanaSeleccionada:i,datePickerOpen:a,setDatePickerOpen:r,anchorEl:n,setAnchorEl:t}=e;const s=(0,l.A)(),c=(0,d.A)(s.breakpoints.down("md")),h=()=>{t(null),r(!1)},p=e=>{i((0,k.A)(o,e)),h()};return(0,M.jsxs)(m.A,{sx:{display:"inline-flex",alignItems:"center"},children:[(0,M.jsx)(x.A,{startIcon:(0,M.jsx)(F.A,{}),onClick:e=>{t(e.currentTarget),r(!0)},size:c?"small":"medium",sx:{fontWeight:"bold",fontSize:c?"0.85rem":"1rem",px:c?1:2,py:c?.5:1,minWidth:c?0:120},children:(0,f.A)(o,"d 'de' MMMM yyyy",{locale:H.A})}),(0,M.jsx)(I.Ay,{open:a,anchorEl:n,onClose:h,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:(0,M.jsxs)(m.A,{sx:{p:2,minWidth:220},children:[(0,M.jsx)(u.A,{variant:"subtitle2",sx:{mb:2},children:"Selecciona semana"}),(0,M.jsxs)(v.Ay,{container:!0,spacing:1,alignItems:"center",children:[(0,M.jsx)(v.Ay,{item:!0,children:(0,M.jsx)(y.A,{onClick:()=>p(-1),size:"small",children:(0,M.jsx)(C.A,{})})}),(0,M.jsx)(v.Ay,{item:!0,children:(0,M.jsx)(u.A,{variant:"body2",children:(0,f.A)(o,"d 'de' MMMM yyyy",{locale:H.A})})}),(0,M.jsx)(v.Ay,{item:!0,children:(0,M.jsx)(y.A,{onClick:()=>p(1),size:"small",children:(0,M.jsx)(O.A,{})})})]})]})})]})};function T(e){let{departamentos:o,departamentoSeleccionado:i,setDepartamentoSeleccionado:a,loading:r,semanaSeleccionada:n,setSemanaSeleccionada:t,yearSelected:s,setYearSelected:c,monthSelected:u,setMonthSelected:h,datePickerOpen:x,setDatePickerOpen:p,anchorEl:b,setAnchorEl:f,avanzarSemana:I,retrocederSemana:C}=e;const O=(0,l.A)(),F=(0,d.A)(O.breakpoints.down("md"));return(0,M.jsx)(m.A,{sx:{p:{xs:1.5,sm:3,md:3},borderBottom:"1px solid",borderColor:"divider"},children:(0,M.jsxs)(v.Ay,{container:!0,spacing:{xs:1,sm:2},alignItems:"center",children:[(0,M.jsx)(v.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,M.jsxs)(A.A,{fullWidth:!0,size:F?"small":"medium",children:[(0,M.jsx)(g.A,{children:"Departamento"}),(0,M.jsx)(j.A,{value:i,onChange:e=>a(e.target.value),disabled:r,children:o.map(e=>(0,M.jsx)(S.A,{value:e,children:e},e))})]})}),(0,M.jsx)(v.Ay,{item:!0,xs:12,sm:6,md:8,children:(0,M.jsxs)(m.A,{sx:{display:"flex",gap:{xs:.5,sm:1},alignItems:"center",flexWrap:"wrap",justifyContent:{xs:"center",sm:"flex-end"}},children:[(0,M.jsx)(y.A,{onClick:C,disabled:r,size:F?"small":"medium",sx:{bgcolor:"action.hover","&:hover":{bgcolor:"action.selected"}},children:(0,M.jsx)("span",{style:{fontSize:F?"1rem":"1.25rem"},children:"\u25c0"})}),(0,M.jsx)(D,{semanaSeleccionada:n,setSemanaSeleccionada:t,yearSelected:s,setYearSelected:c,monthSelected:u,setMonthSelected:h,datePickerOpen:x,setDatePickerOpen:p,anchorEl:b,setAnchorEl:f}),(0,M.jsx)(y.A,{onClick:I,disabled:r,size:F?"small":"medium",sx:{bgcolor:"action.hover","&:hover":{bgcolor:"action.selected"}},children:(0,M.jsx)("span",{style:{fontSize:F?"1rem":"1.25rem"},children:"\u25b6"})})]})})]})})}var z=i(1919),w=i(9688);const W=e=>{let{usuariosFiltrados:o,calcularHorasExcedentes:i,encontrarPracticantesDisponibles:a}=e;const r=o.filter(e=>{const o=i(e.id);return Math.round(10*o)/10>0});return 0===r.length?null:(0,M.jsx)(m.A,{sx:{my:2},children:(0,M.jsxs)(h.A,{severity:"warning",icon:(0,M.jsx)(w.A,{}),children:[(0,M.jsx)(u.A,{variant:"subtitle2",sx:{fontWeight:"bold",mb:1},children:"Recomendaciones para redistribuir horas excedentes:"}),r.map(e=>{const o=i(e.id),r=Math.round(10*o)/10,n=a(r);return(0,M.jsxs)(m.A,{sx:{mb:2},children:[(0,M.jsxs)(u.A,{variant:"body2",sx:{fontWeight:"bold"},children:[e.nombre," ",e.apellidos," ",(0,M.jsx)(z.A,{label:"+".concat(r.toFixed(1),"h"),color:"error",size:"small",sx:{ml:1}})]}),n.length>0?(0,M.jsxs)(m.A,{sx:{ml:2,mt:.5},children:[(0,M.jsx)(u.A,{variant:"body2",sx:{fontWeight:"bold"},children:"Practicantes sugeridos:"}),n.slice(0,3).map(e=>(0,M.jsxs)(u.A,{variant:"body2",sx:{ml:1},children:["\u2022 ",e.usuario.nombre," ",e.usuario.apellidos," (",e.horasDisponibles,"h disponibles)"]},e.usuario.id))]}):(0,M.jsx)(u.A,{variant:"body2",sx:{ml:2,color:"text.secondary"},children:"No hay practicantes disponibles con suficientes horas."})]},e.id)})]})})};var E=i(3009),P=i(7039),R=i(6019),N=i(5376),L=i(2757),K=i(7735);const _=e=>{let{label:o,value:i,onChange:a,isMobile:n}=e;const[t,s]=(0,r.useState)(i||"");(0,r.useEffect)(()=>{s(i||"")},[i]);const l=/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;return(0,M.jsx)(L.A,{label:o,value:t,onChange:e=>{const o=e.target.value;s(o),l.test(o)&&a({target:{value:o}})},onBlur:()=>{l.test(t)&&a({target:{value:t}})},placeholder:"Escribe en formato HH:mm",InputLabelProps:{shrink:!0},fullWidth:!0,size:n?"small":"medium",sx:{mb:2,"& .MuiInputBase-input":{fontSize:n?"0.875rem":"1rem"}}})};var U=i(758);async function V(e,o,i){if(!i||0===Object.keys(i).length)return void await(0,n.hZ)((0,n.KR)(t.OO,"horarios_registros/".concat(e,"/").concat(o)),{});const a={};for(const[n,t]of Object.entries(i))a["horarios_registros/".concat(e,"/").concat(o,"/").concat(n)]=t||null;if(Object.keys(a).length>0){const e=3;let o=0,i=null;for(;o<e;)try{return void await(0,n.yo)((0,n.KR)(t.OO),a)}catch(r){i=r,o+=1;const e=150*o;await new Promise(o=>setTimeout(o,e))}throw i}}var Z=i(6984);function B(e){return!!e&&[Z.gg.ADMINISTRADOR,Z.gg.MODIFICADOR].includes(e.rol)}function G(e,o){return!(!e||!o)&&(e.rol===Z.gg.ADMINISTRADOR||(e.rol===Z.gg.MODIFICADOR?e.id===o.id||e.departamento===o.departamento:e.id===o.id))}const J=e=>{let{dialogoHorario:o,setDialogoHorario:i,horarioPersonalizado:s,setHorarioPersonalizado:l,guardarHorarioPersonalizado:d,isMobile:c,isSmallMobile:h,currentUser:p,usuarios:b=[],editando:f=!1,horariosEditados:v,setHorariosEditados:y,horarios:I,setHorarios:C,semanaSeleccionada:O,obtenerClaveSemana:F}=e;const k=b.find(e=>e.id===s.usuarioId)||{id:s.usuarioId},H=G(p,k);console.log("DEBUG - currentUser:",p),console.log("DEBUG - usuarioObjetivo:",k),console.log("DEBUG - puedeEliminar:",H),r.useEffect(()=>{if(!(o&&s.usuarioId&&s.diaKey))return;const e=s.usuarioId,i=s.diaKey;let r=null;var n;if(f&&v)r=null===(n=v[e])||void 0===n?void 0:n[i];else if(I){var t;r=null===(t=I[e])||void 0===t?void 0:t[i]}l(e=>{var o,i,n,t,s,l;return r?(0,a.A)((0,a.A)({},e),{},{tipo:(null===(o=r)||void 0===o?void 0:o.tipo)||"personalizado",horaInicio:(null===(i=r)||void 0===i?void 0:i.horaInicio)||"",horaFin:(null===(n=r)||void 0===n?void 0:n.horaFin)||"",horaInicioLibre:(null===(t=r)||void 0===t?void 0:t.horaInicioLibre)||"",horaFinLibre:(null===(s=r)||void 0===s?void 0:s.horaFinLibre)||"",nota:(null===(l=r)||void 0===l?void 0:l.nota)||""}):(0,a.A)((0,a.A)({},e),{},{tipo:e.tipo||"personalizado"})})},[o,s.usuarioId,s.diaKey]);const D=(e,o)=>{l(i=>(0,a.A)((0,a.A)({},i),{},{[e]:o}))},T=s.tipo||"personalizado",z=(()=>{if(!s.horaInicio||!s.horaFin)return 0;const[e,o]=s.horaInicio.split(":").map(Number),[i,a]=s.horaFin.split(":").map(Number);return(60*i+a-(60*e+o))/60})();return(0,M.jsxs)(E.A,{open:o,onClose:()=>i(!1),fullScreen:h,maxWidth:c?"sm":"md",fullWidth:!0,TransitionComponent:P.A,TransitionProps:{direction:"up"},children:[(0,M.jsx)(R.A,{sx:{fontSize:c?"1.1rem":"1.25rem",pb:c?1:2},children:"Asignar Horario"}),(0,M.jsx)(N.A,{sx:{pb:c?1:2},children:(0,M.jsxs)(m.A,{sx:{mt:2},children:[(0,M.jsxs)(A.A,{fullWidth:!0,sx:{mb:2},children:[(0,M.jsx)(g.A,{children:"Tipo de asignaci\xf3n"}),(0,M.jsxs)(j.A,{value:T,onChange:e=>{const o=e.target.value;"viaje-trabajo"===o?l(e=>(0,a.A)((0,a.A)({},e),{},{tipo:"viaje-trabajo",horaInicio:"08:00",horaFin:"18:00",horas:10})):D("tipo",o)},size:c?"small":"medium",children:[(0,M.jsx)(S.A,{value:"personalizado",children:"Presencial"}),(0,M.jsx)(S.A,{value:"teletrabajo",children:"Teletrabajo"}),(0,M.jsx)(S.A,{value:"tele-presencial",children:"Teletrabajo & Presencial"}),(0,M.jsx)(S.A,{value:"cambio",children:"Cambio"}),(0,M.jsx)(S.A,{value:"descanso",children:"Descanso"}),(0,M.jsx)(S.A,{value:"vacaciones",children:"Vacaciones"}),(0,M.jsx)(S.A,{value:"feriado",children:"Feriado"}),(0,M.jsx)(S.A,{value:"permiso",children:"Permiso Otorgado por Jefatura"}),(0,M.jsx)(S.A,{value:"dia-brigada",children:"D\xeda por Brigada"}),(0,M.jsx)(S.A,{value:"tarde-libre",children:"Tarde Libre"}),(0,M.jsx)(S.A,{value:"fuera-oficina",children:"Fuera de Oficina"}),(0,M.jsx)(S.A,{value:"viaje-trabajo",children:"Viaje de Trabajo"}),(0,M.jsx)(S.A,{value:"incapacidad-enfermedad",children:"Incapacidad por Enfermedad"}),(0,M.jsx)(S.A,{value:"incapacidad-accidente",children:"Incapacidad por Accidente"})]})]}),"viaje-trabajo"===T?null:"tarde-libre"===T?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(u.A,{variant:"subtitle2",sx:{mt:1,mb:1},children:"Presencial"}),(0,M.jsx)(_,{label:"Hora de inicio trabajo",value:s.horaInicio,onChange:e=>D("horaInicio",e.target.value),isMobile:c}),(0,M.jsx)(_,{label:"Hora de fin trabajo",value:s.horaFin,onChange:e=>D("horaFin",e.target.value),isMobile:c}),(0,M.jsx)(u.A,{variant:"subtitle2",sx:{mt:2,mb:1},children:"Tiempo Libre"}),(0,M.jsx)(_,{label:"Inicio tarde libre",value:s.horaInicioLibre,onChange:e=>D("horaInicioLibre",e.target.value),isMobile:c}),(0,M.jsx)(_,{label:"Fin tarde libre",value:s.horaFinLibre,onChange:e=>D("horaFinLibre",e.target.value),isMobile:c}),(0,M.jsxs)(u.A,{variant:"body2",sx:{fontWeight:"bold",mt:1},children:["Horas laboradas: ",z.toFixed(1),"h"]})]}):"tele-presencial"===T?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(u.A,{variant:"subtitle2",sx:{mt:1,mb:1},children:"Teletrabajo"}),(0,M.jsx)(_,{label:"Inicio Teletrabajo",value:s.horaInicioTele||"",onChange:e=>D("horaInicioTele",e.target.value),isMobile:c}),(0,M.jsx)(_,{label:"Fin Teletrabajo",value:s.horaFinTele||"",onChange:e=>D("horaFinTele",e.target.value),isMobile:c}),(0,M.jsx)(u.A,{variant:"subtitle2",sx:{mt:2,mb:1},children:"Presencial"}),(0,M.jsx)(_,{label:"Inicio Presencial",value:s.horaInicioPres||"",onChange:e=>D("horaInicioPres",e.target.value),isMobile:c}),(0,M.jsx)(_,{label:"Fin Presencial",value:s.horaFinPres||"",onChange:e=>D("horaFinPres",e.target.value),isMobile:c}),(0,M.jsxs)(u.A,{variant:"body2",sx:{fontWeight:"bold",mt:1},children:["Horas Teletrabajo: ",(()=>{const e=s.horaInicioTele,o=s.horaFinTele;if(!e||!o)return"0.0";try{const[i,a]=e.split(":").map(Number),[r,n]=o.split(":").map(Number);let t=0;return t=r>i||r===i&&n>a?r-i+(n-a)/60:24-i+r+(n-a)/60,t.toFixed(1)+"h"}catch(i){return"0.0"}})()]}),(0,M.jsxs)(u.A,{variant:"body2",sx:{fontWeight:"bold",mt:.5},children:["Horas Presencial: ",(()=>{const e=s.horaInicioPres,o=s.horaFinPres;if(!e||!o)return"0.0";try{const[i,a]=e.split(":").map(Number),[r,n]=o.split(":").map(Number);let t=0;return t=r>i||r===i&&n>a?r-i+(n-a)/60:24-i+r+(n-a)/60,t.toFixed(1)+"h"}catch(i){return"0.0"}})()]}),(0,M.jsxs)(u.A,{variant:"body2",sx:{fontWeight:"bold",mt:.5},children:["Total: ",(()=>{const e=(e,o)=>{if(!e||!o)return 0;const[i,a]=e.split(":").map(Number),[r,n]=o.split(":").map(Number);let t=0;return t=r>i||r===i&&n>a?r-i+(n-a)/60:24-i+r+(n-a)/60,t};return(e(s.horaInicioTele,s.horaFinTele)+e(s.horaInicioPres,s.horaFinPres)).toFixed(1)+"h"})()]})]}):"descanso"!==T&&"vacaciones"!==T&&"feriado"!==T&&"permiso"!==T&&"dia-brigada"!==T&&"incapacidad-enfermedad"!==T&&"incapacidad-accidente"!==T?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(_,{label:"Hora de inicio",value:s.horaInicio,onChange:e=>D("horaInicio",e.target.value),isMobile:c}),(0,M.jsx)(_,{label:"Hora de fin",value:s.horaFin,onChange:e=>D("horaFin",e.target.value),isMobile:c}),(0,M.jsxs)(u.A,{variant:"body2",sx:{fontWeight:"bold",mt:1},children:["Horas laboradas: ",z.toFixed(1),"h"]})]}):null,(0,M.jsx)(L.A,{label:"Nota (opcional)",value:s.nota||"",onChange:e=>l(o=>(0,a.A)((0,a.A)({},o),{},{nota:e.target.value})),fullWidth:!0,multiline:!0,minRows:1,maxRows:3,sx:{mt:2},size:c?"small":"medium"})]})}),(0,M.jsxs)(K.A,{sx:{p:c?2:3,flexDirection:h?"column":"row",gap:h?1:0},children:[(0,M.jsx)(x.A,{onClick:()=>i(!1),fullWidth:h,size:c?"medium":"large",children:"Cancelar"}),(0,M.jsx)(x.A,{onClick:async()=>{if(s.usuarioId&&s.diaKey&&O&&F)try{const e=F(O);await async function(e,o,i){const a="horarios_registros/".concat(e,"/").concat(o,"/").concat(i);await(0,n.hZ)((0,n.KR)(t.OO,a),null)}(e,s.usuarioId,s.diaKey),f&&y?y(e=>{const o=(0,a.A)({},e);return o[s.usuarioId]&&(delete o[s.usuarioId][s.diaKey],0===Object.keys(o[s.usuarioId]).length&&delete o[s.usuarioId]),(0,a.A)({},o)}):C&&C(e=>{const o=(0,a.A)({},e);return o[s.usuarioId]&&(delete o[s.usuarioId][s.diaKey],0===Object.keys(o[s.usuarioId]).length&&delete o[s.usuarioId]),(0,a.A)({},o)})}catch(e){}l(e=>(0,a.A)((0,a.A)({},e),{},{tipo:"personalizado",horaInicio:"",horaFin:"",horaInicioLibre:"",horaFinLibre:"",nota:""})),"function"===typeof i&&i(!1)},color:"error",variant:"outlined",fullWidth:h,size:c?"medium":"large",sx:{ml:h?0:1},disabled:!H,children:"Eliminar"}),(0,M.jsx)(x.A,{onClick:d,variant:"contained",fullWidth:h,size:c?"medium":"large",children:"Guardar"})]})]})},q=["Lunes","Martes","Mi\xe9rcoles","Jueves","Viernes","S\xe1bado","Domingo"],Q=e=>{let{dialogoEliminar:o,setDialogoEliminar:i,eliminacionSeleccionada:n,setEliminacionSeleccionada:t,handleEliminarSeleccionado:s,currentUser:l,usuarios:d,horarios:c,isMobile:p,isSmallMobile:b}=e;const f=null===d||void 0===d?void 0:d.find(e=>e.id===(null===l||void 0===l?void 0:l.uid)),y="Administrador"===(null===f||void 0===f?void 0:f.rol);r.useEffect(()=>{o&&t(e=>(0,a.A)((0,a.A)({},e),{},{usuarioId:null,dia:null,diasSeleccionados:[]}))},[o]);const I=c[null===l||void 0===l?void 0:l.uid]||{},C=Object.keys(I);return(0,M.jsxs)(E.A,{open:o,onClose:()=>i(!1),fullScreen:b,maxWidth:p?"sm":"md",fullWidth:!0,children:[(0,M.jsx)(R.A,{children:"Eliminar Horarios"}),(0,M.jsx)(N.A,{children:(0,M.jsxs)(m.A,{sx:{mt:2},children:[(0,M.jsxs)(A.A,{fullWidth:!0,children:[(0,M.jsx)(g.A,{children:"Tipo de eliminaci\xf3n"}),(0,M.jsxs)(j.A,{value:n.tipo,onChange:e=>{t(o=>(0,a.A)((0,a.A)({},o),{},{tipo:e.target.value,diasSeleccionados:[],usuarioId:null,dia:null}))},size:p?"small":"medium",children:[(0,M.jsx)(S.A,{value:"mis-dias",children:"Mis d\xedas espec\xedficos"}),y&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(S.A,{value:"todo",children:"Todos los horarios (Solo Admin)"}),(0,M.jsx)(S.A,{value:"usuario",children:"Por usuario (Solo Admin)"}),(0,M.jsx)(S.A,{value:"dia",children:"Por d\xeda completo (Solo Admin)"})]})]})]}),!y&&(0,M.jsx)(h.A,{severity:"info",sx:{mt:2},children:(0,M.jsx)(u.A,{variant:"body2",children:"Solo puedes eliminar tus propios horarios. Los administradores tienen permisos adicionales."})}),"mis-dias"===n.tipo&&(0,M.jsxs)(m.A,{sx:{mt:2},children:[(0,M.jsx)(u.A,{variant:"subtitle2",sx:{mb:2,fontWeight:"bold"},children:"Selecciona los d\xedas que deseas eliminar:"}),0===C.length?(0,M.jsx)(h.A,{severity:"warning",children:(0,M.jsx)(u.A,{variant:"body2",children:"No tienes horarios asignados en esta semana."})}):(0,M.jsx)(v.Ay,{container:!0,spacing:1,children:q.map((e,o)=>{const i="dia".concat(o+1),r=C.includes(i),s=n.diasSeleccionados.includes(i);return(0,M.jsx)(v.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,M.jsxs)(x.A,{variant:s?"contained":"outlined",sx:{backgroundColor:s?"#d32f2f":"transparent",color:s?"white":"inherit",borderColor:s?"#d32f2f":"rgba(0, 0, 0, 0.23)","&:hover":{backgroundColor:s?"#b71c1c":"rgba(211, 47, 47, 0.04)",borderColor:"#d32f2f"}},fullWidth:!0,disabled:!r,onClick:()=>(e=>{t(o=>(0,a.A)((0,a.A)({},o),{},{diasSeleccionados:o.diasSeleccionados.includes(e)?o.diasSeleccionados.filter(o=>o!==e):[...o.diasSeleccionados,e]}))})(i),children:[e," ",!r&&"(Sin horario)"]})},i)})}),n.diasSeleccionados.length>0&&(0,M.jsx)(h.A,{severity:"warning",sx:{mt:2},children:(0,M.jsxs)(u.A,{variant:"body2",children:["Se eliminar\xe1n los horarios de: ",n.diasSeleccionados.map(e=>{const o=parseInt(e.replace("dia",""))-1;return q[o]}).join(", ")]})})]}),y&&"usuario"===n.tipo&&(0,M.jsxs)(A.A,{fullWidth:!0,sx:{mt:2},children:[(0,M.jsx)(g.A,{children:"Usuario"}),(0,M.jsx)(j.A,{value:n.usuarioId||"",onChange:e=>t(o=>(0,a.A)((0,a.A)({},o),{},{usuarioId:e.target.value})),size:p?"small":"medium",children:d.map(e=>(0,M.jsxs)(S.A,{value:e.id,children:[e.nombre," ",e.apellidos,e.id===(null===l||void 0===l?void 0:l.uid)&&" (T\xfa)"]},e.id))})]}),y&&"dia"===n.tipo&&(0,M.jsxs)(A.A,{fullWidth:!0,sx:{mt:2},children:[(0,M.jsx)(g.A,{children:"D\xeda"}),(0,M.jsx)(j.A,{value:n.dia||"",onChange:e=>t(o=>(0,a.A)((0,a.A)({},o),{},{dia:e.target.value})),size:p?"small":"medium",children:q.map((e,o)=>(0,M.jsx)(S.A,{value:"dia".concat(o+1),children:e},e))})]}),y&&"todo"===n.tipo&&(0,M.jsx)(h.A,{severity:"error",sx:{mt:2},children:(0,M.jsx)(u.A,{variant:"body2",sx:{fontWeight:"bold"},children:"\u26a0\ufe0f Esta acci\xf3n eliminar\xe1 TODOS los horarios de TODOS los usuarios para esta semana."})})]})}),(0,M.jsxs)(K.A,{children:[(0,M.jsx)(x.A,{onClick:()=>i(!1),children:"Cancelar"}),(0,M.jsx)(x.A,{onClick:s,variant:"contained",sx:{backgroundColor:"#d32f2f","&:hover":{backgroundColor:"#b71c1c"}},disabled:"mis-dias"===n.tipo&&0===n.diasSeleccionados.length||"usuario"===n.tipo&&(!n.usuarioId||""===n.usuarioId)||"dia"===n.tipo&&(!n.dia||""===n.dia),children:"Eliminar"})]})]})},Y=["Lunes","Martes","Mi\xe9rcoles","Jueves","Viernes","S\xe1bado","Domingo"],X=["dia1","dia2","dia3","dia4","dia5","dia6","dia7"],$={personalizado:"Presencial",teletrabajo:"Teletrabajo",cambio:"Cambio",descanso:"Descanso",vacaciones:"Vacaciones",feriado:"Feriado",permiso:"Permiso Otorgado por Jefatura","tarde-libre":"Tarde Libre","dia-brigada":"D\xeda por Brigada"},ee=e=>{var o;let{dialogoCopiar:i,setDialogoCopiar:a,horarioACopiar:r,setHorarioACopiar:n,ejecutarCopiarHorario:t,editando:s,horariosEditados:l,horarios:d}=e;if(!r)return null;return(0,M.jsxs)(E.A,{open:i,onClose:()=>{a(!1),n(null)},fullWidth:!0,maxWidth:"sm",children:[(0,M.jsx)(R.A,{children:"Copiar Horario"}),(0,M.jsx)(N.A,{children:(0,M.jsxs)(m.A,{sx:{mt:2},children:[(0,M.jsxs)(u.A,{variant:"subtitle1",sx:{mb:2,fontWeight:"bold"},children:["Horario a copiar: ",$[r.tipo]||r.tipo]}),r.horaInicio&&r.horaFin&&(0,M.jsxs)(u.A,{variant:"body2",sx:{mb:2,color:"text.secondary"},children:["Horario: ",r.horaInicio," - ",r.horaFin," (",null===(o=r.horas)||void 0===o?void 0:o.toFixed(1),"h)"]}),(0,M.jsx)(u.A,{variant:"subtitle2",sx:{mb:2,fontWeight:"bold"},children:"Selecciona el d\xeda destino:"}),(0,M.jsx)(v.Ay,{container:!0,spacing:1,children:Y.map((e,o)=>{const i=X[o],a=s?l[r.usuarioId]:d[r.usuarioId],n=(null===a||void 0===a?void 0:a[i])&&"libre"!==a[i].tipo,c=i===r.diaOriginal;return(0,M.jsx)(v.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,M.jsxs)(x.A,{variant:n?"outlined":"contained",fullWidth:!0,disabled:c,onClick:()=>(e=>{t(e)})(i),sx:{backgroundColor:n?"transparent":"#1976d2",color:n?"#1976d2":"white",borderColor:n?"#ff9800":"#1976d2","&:hover":{backgroundColor:n?"rgba(255, 152, 0, 0.04)":"#1565c0",borderColor:n?"#ff9800":"#1565c0"},"&:disabled":{backgroundColor:"#f5f5f5",color:"#999",borderColor:"#ddd"}},children:[e,c&&" (Original)",n&&!c&&" (Ocupado)"]})},i)})}),(0,M.jsxs)(h.A,{severity:"info",sx:{mt:2},children:[(0,M.jsx)(u.A,{variant:"body2",children:'\u2022 Los d\xedas marcados como "Ocupado" ya tienen un horario asignado'}),(0,M.jsx)(u.A,{variant:"body2",children:"\u2022 Seleccionar un d\xeda ocupado reemplazar\xe1 el horario existente"}),(0,M.jsx)(u.A,{variant:"body2",children:"\u2022 El d\xeda original est\xe1 deshabilitado para evitar copia sobre s\xed mismo"})]})]})}),(0,M.jsx)(K.A,{children:(0,M.jsx)(x.A,{onClick:()=>{a(!1),n(null)},children:"Cancelar"})})]})};var oe=i(3883),ie=i(8710),ae=i(6194);const re=e=>{let{modalConfirmacion:o,cerrarModalConfirmacion:i}=e;const a=(0,l.A)(),r=(0,d.A)(a.breakpoints.down("md")),n=(0,d.A)(a.breakpoints.down("sm")),{abierto:t,tipo:s,titulo:c,mensaje:h,textoConfirmar:m,textoCancelar:p,onConfirmar:b,onCancelar:f,soloInfo:v}=o,A={success:(0,M.jsx)(oe.A,{sx:{color:"#4caf50",fontSize:40,mb:2}}),error:(0,M.jsx)(ie.A,{sx:{color:"#f44336",fontSize:40,mb:2}}),warning:(0,M.jsx)(w.A,{sx:{color:"#ff9800",fontSize:40,mb:2}}),info:(0,M.jsx)(ae.A,{sx:{color:"#2196f3",fontSize:40,mb:2}})};return(0,M.jsxs)(E.A,{open:t,onClose:v?i:f||i,fullScreen:n,maxWidth:r?"sm":"md",fullWidth:!0,TransitionComponent:P.A,TransitionProps:{direction:"up"},children:[(0,M.jsxs)(N.A,{sx:{textAlign:"center",pt:4,pb:2,px:r?2:4},children:[A[s],(0,M.jsx)(u.A,{variant:r?"h6":"h5",sx:{fontWeight:"bold",mb:2,color:"text.primary"},children:c}),(0,M.jsx)(u.A,{variant:"body1",sx:{color:"text.secondary",whiteSpace:"pre-line",lineHeight:1.6},children:h})]}),(0,M.jsxs)(K.A,{sx:{justifyContent:"center",gap:2,pb:3,px:3,flexDirection:n?"column":"row"},children:[!v&&(0,M.jsx)(x.A,{onClick:f||i,variant:"outlined",size:r?"medium":"large",fullWidth:n,sx:{minWidth:n?"100%":"120px"},children:p}),(0,M.jsx)(x.A,{onClick:v?i:b||i,variant:"contained",size:r?"medium":"large",fullWidth:n,color:"error"===s?"error":"primary",sx:{minWidth:n?"100%":"120px"},children:v?"Entendido":m})]})]})};var ne=i(7387),te=i(6581);const se=e=>{var o;let{open:i,onClose:a,usuario:r,turno:n,diaKey:t,semanaSeleccionada:s}=e;return(0,M.jsxs)(E.A,{open:i,onClose:a,maxWidth:"sm",fullWidth:!0,children:[(0,M.jsx)(R.A,{variant:"strong",children:"Informaci\xf3n del Turno"}),t&&(0,M.jsx)(R.A,{sx:{pl:3,pt:.2},children:(()=>{const e=parseInt(t.replace("dia",""),10)-1,o=te.hu[e]||"",i=(0,f.A)((0,ne.A)(s,e),"d");return"".concat(o," ").concat(i)})()}),(0,M.jsxs)(N.A,{dividers:!0,children:[r&&(0,M.jsxs)(u.A,{variant:"body1",gutterBottom:!0,children:[(0,M.jsx)("strong",{children:"Usuario:"})," ",r.nombre," ",r.apellidos]}),(0,M.jsxs)(u.A,{variant:"body1",gutterBottom:!0,children:[(0,M.jsx)("strong",{children:"Tipo:"})," ",null!==n&&void 0!==n&&n.tipo?"personalizado"===n.tipo?"Presencial":n.tipo.charAt(0).toUpperCase()+n.tipo.slice(1):"Descanso"]}),n&&"libre"!==n.tipo&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(u.A,{variant:"body1",gutterBottom:!0,children:[(0,M.jsx)("strong",{children:"Horario:"})," ",n.horaInicio," - ",n.horaFin]}),(0,M.jsxs)(u.A,{variant:"body1",children:[(0,M.jsx)("strong",{children:"Horas:"})," ",null===(o=n.horas)||void 0===o?void 0:o.toFixed(1),"h"]})]})]}),(0,M.jsx)(K.A,{children:(0,M.jsx)(x.A,{onClick:a,variant:"contained",color:"primary",children:"Cerrar"})})]})},le=e=>{switch(e){case"Administrador":return"error";case"Modificador":return"warning";case"Visualizador":return"success";default:return"default"}},de=e=>{switch(e){case"Administrador":return"Admin";case"Modificador":return"Mod";default:return"Ver"}},ce=e=>{const[o,i]=e.split(":").map(Number);return{hora:o,minutos:i}},ue=function(e,o){let i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,r=arguments.length>6?arguments[6]:void 0,n=arguments.length>7?arguments[7]:void 0,t=arguments.length>8?arguments[8]:void 0,s=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const l=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{})||{},d=o?((arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})||{})[e]||{}:l[e]||{};if(!d||"object"!==typeof d)return 0;const c=["descanso","vacaciones","feriado","permiso","dia-brigada"],u=Object.values(d).reduce((e,o)=>!o||c.includes(o.tipo)?e:e+(o.horas||0),0);if(i&&a&&i.getTime&&a.getTime&&(i.getTime()===a.getTime()||s))return u;const h=r[e]||0,m=n(e),x=t((null===m||void 0===m?void 0:m.tipoContrato)||"Operativo"),p=Math.min(x-8,40),b=Math.max(x-h,p);return s?u:Math.min(u,b)},he=(e,o,i,a,r,n)=>{const t=ue(e,o,i,a,null,null,{},r,n,!0),s=r(e),l=n((null===s||void 0===s?void 0:s.tipoContrato)||"Operativo");return Math.max(t-l,0)},me=function(e,o,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const t=Array.isArray(o)?o:[],s=Number(e)||0,l=t.filter(e=>e&&e.departamento===r&&e.id!==n).map(e=>{const o=i(e.id,!0)||0,r=a(e.tipoContrato||"Operativo")||0;return{usuario:e,horasDisponibles:Number((r-o).toFixed(1)),horasTotales:Number(o.toFixed(1)),horasMaximas:r}}).filter(e=>e.horasDisponibles>=s),d=t.filter(e=>e&&"Practicantes/Crosstraining"===e.departamento&&(!r||e.departamentosAutorizados&&Array.isArray(e.departamentosAutorizados)&&e.departamentosAutorizados.includes(r))).map(e=>{const o=i(e.id,!0)||0,r=a(e.tipoContrato||"Operativo")||0;return{usuario:e,horasDisponibles:Number((r-o).toFixed(1)),horasTotales:Number(o.toFixed(1)),horasMaximas:r}}).filter(e=>e.horasDisponibles>=s);return[...l.sort((e,o)=>o.horasDisponibles-e.horasDisponibles),...d.sort((e,o)=>o.horasDisponibles-e.horasDisponibles)]},xe=(e,o,i)=>{const a=i(o,e.departamento,e.id);if(0===a.length)return"\u26a0\ufe0f ".concat(e.nombre," ").concat(e.apellidos," excede ").concat(o.toFixed(1),"h. No hay compa\xf1eros ni practicantes disponibles con suficientes horas.");const r=a.slice(0,3).map(e=>"\u2022 ".concat(e.usuario.nombre," ").concat(e.usuario.apellidos," (").concat(e.horasDisponibles,"h disponibles de ").concat(e.horasMaximas,"h)")).join("\n");return"\u26a0\ufe0f ".concat(e.nombre," ").concat(e.apellidos," excede ").concat(o.toFixed(1),"h\n\n\ud83d\udd04 Compa\xf1eros/practicantes disponibles para redistribuir:\n").concat(r)};function pe(e,o){return e&&o?e.find(e=>e.id===o):null}var be=i(8248);const fe=["descanso","vacaciones","feriado","permiso"],ve=e=>{var o,i;let{usuario:a,diaKey:r,editando:n,horariosEditados:t,horarios:s,currentUser:l,handleCambiarTurno:d,handleCopiarHorario:c,NO_SUMAN_HORAS:h}=e;const x=n?t[a.id]:s[a.id],p=null===x||void 0===x?void 0:x[r],b=p&&"libre"!==p.tipo,f=b&&fe.includes(p.tipo),A=f?"#222":"#fff";return(0,M.jsx)(v.Ay,{item:!0,xs:!0,children:(0,M.jsxs)(m.A,{onClick:()=>{n&&d(a.id,r)},sx:{minHeight:80,minWidth:110,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",borderRadius:"8px",border:"1px solid #e0e0e0",cursor:n?"pointer":"default",position:"relative",bgcolor:f?"#fff":b?"viaje-trabajo"===p.tipo?"#1a237e":"tele-presencial"===p.tipo?"#6a1b9a":"teletrabajo"===p.tipo?"#2e7d32":"cambio"===p.tipo?"#f57c00":a.id===(null===l||void 0===l?void 0:l.uid)?"var(--primary-color)":"var(--secondary-color)":"transparent",color:f?"#333":b?"white":"text.secondary","&:hover":n?{backgroundColor:f?"#fff":b?"tele-presencial"===p.tipo?"#4a148c":"teletrabajo"===p.tipo?"#1b5e20":"cambio"===p.tipo?"#e65100":a.id===(null===l||void 0===l?void 0:l.uid)?"#303f9f":"#c51162":"#f0f0f0"}:{}},children:[b&&n&&!f&&l&&(["Administrador","Modificador"].includes(l.rol)||a.id===l.uid)?(0,M.jsx)(y.A,{size:"small",onClick:e=>c(a.id,r,e),sx:{position:"absolute",top:2,right:2,backgroundColor:"transparent",color:A,minWidth:"auto",width:18,height:18,padding:0,border:"none",boxShadow:"none","&:hover":{backgroundColor:"transparent"}},children:(0,M.jsx)("span",{style:{fontSize:12,color:A},children:"\u29c9"})}):null,b&&n&&f&&l&&(["Administrador","Modificador"].includes(l.rol)||a.id===l.uid)?(0,M.jsx)(y.A,{size:"small",onClick:e=>c(a.id,r,e),sx:{position:"absolute",top:2,right:2,backgroundColor:"transparent",color:A,minWidth:"auto",width:18,height:18,padding:0,border:"none",boxShadow:"none","&:hover":{backgroundColor:"transparent"}},children:(0,M.jsx)("span",{style:{fontSize:12,color:A},children:"\u29c9"})}):null,b?f?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(u.A,{variant:"caption",sx:{fontSize:"0.85rem",textAlign:"center",lineHeight:1.2,fontWeight:"bold"},children:te.Kj[p.tipo]||p.tipo}),p.nota&&(0,M.jsx)(u.A,{variant:"caption",sx:{fontSize:"0.75rem",textAlign:"center",lineHeight:1,mt:.5,color:"#333",fontStyle:"italic"},children:p.nota})]}):"tarde-libre"===p.tipo?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(u.A,{variant:"caption",sx:{fontSize:"0.85rem",textAlign:"center",lineHeight:1.2,fontWeight:"bold"},children:"Presencial"}),p.horaInicio&&p.horaFin&&(0,M.jsxs)(u.A,{variant:"caption",sx:{fontSize:"0.75rem",textAlign:"center",lineHeight:1},children:[p.horaInicio," - ",p.horaFin]}),(0,M.jsx)(u.A,{variant:"caption",sx:{fontSize:"0.85rem",textAlign:"center",lineHeight:1.2,fontWeight:"bold",mt:.5},children:"Tiempo Libre"}),p.horaInicioLibre&&p.horaFinLibre&&(0,M.jsxs)(u.A,{variant:"caption",sx:{fontSize:"0.75rem",textAlign:"center",lineHeight:1},children:[p.horaInicioLibre," - ",p.horaFinLibre]}),p.nota&&(0,M.jsx)(u.A,{variant:"caption",sx:{fontSize:"0.75rem",textAlign:"center",lineHeight:1,mt:.5,fontStyle:"italic"},children:p.nota})]}):"viaje-trabajo"===p.tipo?(0,M.jsx)(u.A,{variant:"caption",sx:{fontSize:"0.85rem",textAlign:"center",lineHeight:1,fontWeight:"bold"},children:te.Kj[p.tipo]||p.tipo}):"tele-presencial"===p.tipo?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(u.A,{variant:"caption",sx:{fontSize:"0.85rem",textAlign:"center",lineHeight:1.2,fontWeight:"bold"},children:te.Kj[p.tipo]||"Teletrabajo & Presencial"}),p.horaInicioTele&&p.horaFinTele&&(0,M.jsx)(M.Fragment,{children:(0,M.jsxs)(u.A,{variant:"caption",sx:{fontSize:"0.75rem",textAlign:"center",lineHeight:1},children:["TT: ",p.horaInicioTele," - ",p.horaFinTele]})}),p.horaInicioPres&&p.horaFinPres&&(0,M.jsx)(M.Fragment,{children:(0,M.jsxs)(u.A,{variant:"caption",sx:{fontSize:"0.75rem",textAlign:"center",lineHeight:1,mt:.3},children:["Pres: ",p.horaInicioPres," - ",p.horaFinPres]})}),(0,M.jsx)(u.A,{variant:"caption",sx:{fontSize:"0.75rem",textAlign:"center",lineHeight:1,mt:.5},children:"".concat((null===(o=p.horas)||void 0===o?void 0:o.toFixed(1))||"0.0","h")}),p.nota&&(0,M.jsx)(u.A,{variant:"caption",sx:{fontSize:"0.75rem",textAlign:"center",lineHeight:1,mt:.5,color:"#fff",fontStyle:"italic"},children:p.nota})]}):(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(u.A,{variant:"caption",sx:{fontSize:"0.85rem",textAlign:"center",lineHeight:1,fontWeight:"bold"},children:te.Kj[p.tipo]||p.tipo}),p.horaInicio&&p.horaFin&&(0,M.jsxs)(u.A,{variant:"caption",sx:{fontSize:"0.75rem",textAlign:"center",lineHeight:1},children:[p.horaInicio," - ",p.horaFin]}),(0,M.jsx)(u.A,{variant:"caption",sx:{fontSize:"0.75rem",textAlign:"center",lineHeight:1},children:h.includes(p.tipo)?"teletrabajo"===p.tipo?"TT":"descanso"===p.tipo?"D":"vacaciones"===p.tipo?"V":"feriado"===p.tipo?"F":"permiso"===p.tipo?"P":"X":"".concat((null===(i=p.horas)||void 0===i?void 0:i.toFixed(1))||"0","h")}),p.nota&&(0,M.jsx)(u.A,{variant:"caption",sx:{fontSize:"0.75rem",textAlign:"center",lineHeight:1,mt:.5,color:"#fff",fontStyle:"italic"},children:p.nota})]}):(0,M.jsx)(u.A,{variant:"caption",sx:{fontSize:"0.8rem",textAlign:"center",lineHeight:1.2,color:"#888"},children:"Sin Turno"})]})},r)},Ae=e=>{let{isMobile:o,isSmallMobile:i,usuariosFiltrados:a,editando:r,horarios:n,horariosEditados:t,currentUser:l,handleCambiarTurno:d,abrirInfoTurno:c,handleCopiarHorario:h,NO_SUMAN_HORAS:x,calcularExceso:p,calcularHorasTotales:b,semanaSeleccionada:A,semanaActual:g,obtenerUsuario:j,obtenerHorasMaximas:S,diasSemana:I}=e;return(0,M.jsx)(m.A,{sx:{p:{xs:.5,sm:2,md:3},overflowX:"auto"},children:o?(0,M.jsxs)(m.A,{sx:{px:1},children:[(0,M.jsxs)(v.Ay,{container:!0,spacing:.5,sx:{mb:1},children:[(0,M.jsx)(v.Ay,{item:!0,xs:4,children:(0,M.jsx)(u.A,{variant:"body2",sx:{fontWeight:"bold",p:.5,fontSize:"0.75rem",textAlign:"center"},children:"Usuario"})}),(0,M.jsx)(v.Ay,{item:!0,xs:6,children:(0,M.jsx)(u.A,{variant:"body2",sx:{fontWeight:"bold",p:.5,fontSize:"0.75rem",textAlign:"center"},children:"Horarios de la Semana"})}),(0,M.jsx)(v.Ay,{item:!0,xs:2,children:(0,M.jsx)(u.A,{variant:"body2",sx:{fontWeight:"bold",p:.5,fontSize:"0.75rem",textAlign:"center"},children:"Total"})})]}),a.map(e=>(0,M.jsx)(s.A,{elevation:e.id===(null===l||void 0===l?void 0:l.uid)?3:1,sx:{mb:1,p:1,bgcolor:e.id===(null===l||void 0===l?void 0:l.uid)?"#e3f2fd":"white",border:e.id===(null===l||void 0===l?void 0:l.uid)?"2px solid #2196f3":"1px solid #e0e0e0"},children:(0,M.jsxs)(v.Ay,{container:!0,spacing:.5,alignItems:"center",children:[(0,M.jsx)(v.Ay,{item:!0,xs:4,children:(0,M.jsxs)(m.A,{sx:{textAlign:"center"},children:[(0,M.jsxs)(u.A,{variant:"caption",sx:{fontWeight:e.id===(null===l||void 0===l?void 0:l.uid)?"bold":"normal",fontSize:"0.7rem",display:"block",lineHeight:1.2},children:[e.nombre," ",e.apellidos]}),(0,M.jsx)(z.A,{label:de(e.rol),color:le(e.rol),size:"small",sx:{fontSize:"0.6rem",height:16,mt:.5}})]})}),(0,M.jsx)(v.Ay,{item:!0,xs:6,children:(0,M.jsx)(v.Ay,{container:!0,spacing:.3,children:I.map((o,i)=>{const a="dia".concat(i+1),s=r?t[e.id]:n[e.id],p=null===s||void 0===s?void 0:s[a],b=p&&"libre"!==p.tipo;return(0,M.jsx)(v.Ay,{item:!0,xs:12/7,children:(0,M.jsxs)(m.A,{onClick:()=>{r?d(e.id,a):b&&c(e,p,a)},sx:{height:28,display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"4px",position:"relative",bgcolor:b?x.includes(p.tipo)?"white":"teletrabajo"===p.tipo?"#2e7d32":"cambio"===p.tipo?"#f57c00":e.id===(null===l||void 0===l?void 0:l.uid)?"var(--primary-color)":"var(--secondary-color)":"transparent",color:b?x.includes(p.tipo)?"black":"white":"text.secondary","&:hover":r?{backgroundColor:"#f0f0f0"}:{}},children:[b&&r&&(0,M.jsx)(y.A,{size:"small",onClick:o=>h(e.id,a,o),sx:{position:"absolute",top:-2,right:-2,backgroundColor:"transparent",color:"#1976d2",width:12,height:12,p:0,"&:hover":{backgroundColor:"transparent"}},children:(0,M.jsx)(be.A,{sx:{fontSize:8}})}),(0,M.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,M.jsx)(u.A,{variant:"caption",sx:{fontSize:"0.6rem",textAlign:"center",lineHeight:1},children:o.slice(0,1)}),p&&"descanso"===p.tipo&&p.nota&&(0,M.jsx)(u.A,{variant:"caption",sx:{fontSize:"0.55rem",textAlign:"center",lineHeight:1,mt:.2,color:"text.secondary"},children:p.nota})]})]})},a)})})}),(0,M.jsx)(v.Ay,{item:!0,xs:2,children:(0,M.jsx)(s.A,{elevation:p(e.id)>0?2:1,sx:{textAlign:"center",p:.5,bgcolor:p(e.id)>0?"#ffebee":"#e8f5e8",border:p(e.id)>0?"1px solid #f44336":"1px solid #4caf50"},children:(0,M.jsxs)(u.A,{variant:"caption",sx:{fontSize:"0.7rem",fontWeight:"bold"},children:[b(e.id,r,t,n,A,g,{},e=>j(a,e),S,!0).toFixed(1),"h"]})})})]})},e.id))]}):(0,M.jsxs)(v.Ay,{container:!0,spacing:1,children:[(0,M.jsx)(v.Ay,{item:!0,xs:12,children:(0,M.jsxs)(v.Ay,{container:!0,spacing:1,children:[(0,M.jsx)(v.Ay,{item:!0,xs:2,md:2,children:(0,M.jsx)(u.A,{variant:"subtitle1",sx:{fontWeight:"bold",p:1},children:"Usuario"})}),I.map((e,o)=>(0,M.jsx)(v.Ay,{item:!0,xs:!0,children:(0,M.jsx)(u.A,{variant:"subtitle2",align:"center",sx:{fontWeight:"bold",p:1},children:"".concat(e," ").concat((0,f.A)((0,ne.A)(A,o),"d"))})},e)),(0,M.jsx)(v.Ay,{item:!0,xs:1,md:1,children:(0,M.jsx)(u.A,{variant:"subtitle2",align:"center",sx:{fontWeight:"bold",p:1},children:"Total"})})]})}),a.map(e=>(0,M.jsx)(v.Ay,{item:!0,xs:12,children:(0,M.jsxs)(v.Ay,{container:!0,spacing:1,alignItems:"center",children:[(0,M.jsx)(v.Ay,{item:!0,xs:2,md:2,children:(0,M.jsxs)(s.A,{elevation:e.id===(null===l||void 0===l?void 0:l.uid)?2:0,sx:{p:1,textAlign:"center",bgcolor:e.id===(null===l||void 0===l?void 0:l.uid)?"#e3f2fd":"transparent",border:e.id===(null===l||void 0===l?void 0:l.uid)?"2px solid #2196f3":"1px solid #e0e0e0"},children:[(0,M.jsxs)(u.A,{variant:"body2",sx:{fontWeight:e.id===(null===l||void 0===l?void 0:l.uid)?"bold":"normal"},children:[e.nombre," ",e.apellidos]}),(0,M.jsx)("br",{}),(0,M.jsx)(z.A,{label:de(e.rol),color:le(e.rol),size:"small",sx:{fontSize:"0.6rem",height:20,mt:.5}})]})}),I.map((o,i)=>(0,M.jsx)(v.Ay,{item:!0,xs:!0,children:(0,M.jsx)(ve,{usuario:e,diaKey:"dia".concat(i+1),editando:r,horariosEditados:t,horarios:n,currentUser:l,handleCambiarTurno:d,handleCopiarHorario:h,NO_SUMAN_HORAS:x})},"".concat(e.id,"-").concat(i))),(0,M.jsx)(v.Ay,{item:!0,xs:1,md:1,children:(0,M.jsx)(s.A,{elevation:p(e.id)>0?2:1,sx:{textAlign:"center",p:1,bgcolor:p(e.id)>0?"#ffebee":"#e8f5e8",border:p(e.id)>0?"1px solid #f44336":"1px solid #4caf50"},children:(0,M.jsxs)(u.A,{variant:"body2",sx:{fontWeight:"bold"},children:[b(e.id,r,t,n,A,g,{},e=>j(a,e),S,!0).toFixed(1),"h"]})})})]})},e.id))]})})};var ge=i(4550);var je=i(7250),Se=i(1110),ye=i(2676);const Ie=(0,p.Ay)(s.A)(e=>{let{theme:o}=e;return{padding:o.spacing(3),borderRadius:"16px",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.1)",[o.breakpoints.down("md")]:{padding:o.spacing(2),borderRadius:"12px"},[o.breakpoints.down("sm")]:{padding:o.spacing(1.5),borderRadius:"8px",margin:o.spacing(.5)}}}),Ce=()=>{const e=(0,l.A)(),o=(0,d.A)(e.breakpoints.down("md")),i=(0,d.A)(e.breakpoints.down("sm")),{usuarios:p,departamentoSeleccionado:v,setDepartamentoSeleccionado:A,currentUser:g}=function(){const[e,o]=(0,r.useState)(!0),[i,s]=(0,r.useState)([]),[l,d]=(0,r.useState)(""),[c,u]=(0,r.useState)(null);return(0,r.useEffect)(()=>{!async function(){try{o(!0);const e=t.j2.currentUser;if(!e)return;u(e);const i=(0,n.KR)(t.OO,"usuarios"),r=await(0,n.Jt)(i);if(r.exists()){const o=r.val(),i=Object.entries(o).map(e=>{let[o,i]=e;return(0,a.A)((0,a.A)({id:o},i),{},{tipoContrato:i.tipoContrato||"Operativo"})});s(i);const n=i.find(o=>o.id===e.uid);n?d(n.departamento):te.A1.length>0&&d(te.A1[0])}}catch(e){console.error("Error al cargar usuarios:",e),ge.oR.error("Error al cargar usuarios: "+e.message)}finally{o(!1)}}()},[]),{loading:e,usuarios:i,departamentoSeleccionado:l,setDepartamentoSeleccionado:d,currentUser:c}}(),[j,S]=(0,r.useState)(!0),[y,I]=(0,r.useState)({}),{semanaActual:C,semanaSeleccionada:O,setSemanaSeleccionada:F,avanzarSemana:H,retrocederSemana:D,obtenerClaveSemana:z}=function(){const e=(0,je.A)(new Date,{weekStartsOn:1}),[o]=(0,r.useState)(e),[i,a]=(0,r.useState)(e),n=(0,r.useCallback)(()=>{a(e=>(0,k.A)(e,1))},[]),t=(0,r.useCallback)(()=>{a(e=>(0,Se.A)(e,1))},[]),s=(0,r.useCallback)(e=>{const o=(0,je.A)(e,{weekStartsOn:1}),i=(0,b.A)(o),a=(0,ye.A)(o);return"".concat(i,"-").concat(a)},[]);return{semanaActual:o,semanaSeleccionada:i,setSemanaSeleccionada:a,avanzarSemana:n,retrocederSemana:t,obtenerClaveSemana:s}}(),[w,E]=(0,r.useState)(!1),[P,R]=(0,r.useState)({}),[N,L]=(0,r.useState)({}),[K,_]=(0,r.useState)(null),[q,Y]=(0,r.useState)(!1),[X,$]=(0,r.useState)({horaInicio:"",horaFin:"",usuarioId:null,diaKey:null,tipo:"personalizado"}),[oe,ie]=(0,r.useState)(!1),[ae,ne]=(0,r.useState)({tipo:"mis-dias",usuarioId:null,dia:null,diasSeleccionados:[]}),[le,de]=(0,r.useState)(null),[be,fe]=(0,r.useState)((0,b.A)(new Date)),[ve,Ce]=(0,r.useState)((new Date).getMonth()),[Oe,Fe]=(0,r.useState)(!1),[ke,He]=(0,r.useState)(!1),[Me,De]=(0,r.useState)(null),{modalConfirmacion:Te,mostrarModal:ze,cerrarModal:we}=function(){const[e,o]=(0,r.useState)({abierto:!1,tipo:"info",titulo:"",mensaje:"",textoConfirmar:"Confirmar",textoCancelar:"Cancelar",onConfirmar:null,onCancelar:null,soloInfo:!1});return{modalConfirmacion:e,mostrarModal:(0,r.useCallback)(e=>{o((0,a.A)({abierto:!0},e))},[]),cerrarModal:(0,r.useCallback)(()=>{o(e=>(0,a.A)((0,a.A)({},e),{},{abierto:!1}))},[])}}(),[We,Ee]=(0,r.useState)(!1),[Pe,Re]=(0,r.useState)(null),[Ne,Le]=(0,r.useState)(null),[Ke,_e]=(0,r.useState)(null),Ue=function(e,o){return(0,r.useMemo)(()=>e?o?e.filter(e=>e.departamento===o):e:[],[e,o])}(p,v),Ve=(0,r.useCallback)(()=>{E(!0);const e=p.find(e=>e.id===(null===g||void 0===g?void 0:g.uid)),o=e&&("Administrador"===e.rol||"Modificador"===e.rol);R(o?(0,a.A)({},y||{}):{[g.uid]:(null===y||void 0===y?void 0:y[g.uid])||{}})},[p,g,y]);(0,r.useEffect)(()=>{if(!g)return;S(!0);const e=z(O),o=function(e,o){if(!e)return()=>{};const i=(0,n.KR)(t.OO,"horarios_registros/".concat(e));return(0,n.Zy)(i,e=>{try{const i=e.exists()?e.val():{};o(i)}catch(i){console.error("Error en subscribeHorariosSemana onValue:",i)}}),()=>(0,n.AU)(i)}(e,o=>{I(o||{}),_(e),S(!1)}),i=setTimeout(async()=>{try{const o=await async function(e,o){const i=o(e),a=(0,n.KR)(t.OO,"horarios_registros/".concat(i)),r=await(0,n.Jt)(a);return r.exists()?r.val():{}}(O,z);I(o||{}),_(e)}catch(o){console.error("Fallback cargarHorariosPorSemana fall\xf3:",o)}finally{S(!1)}},3e3);return()=>{clearTimeout(i);try{o&&o()}catch(e){}}},[O,g,z]),(0,r.useEffect)(()=>{if(!w)return;const e=z(O),o=N[e];if(o)return void R(o);if(j||K!==e)return void R({});const i=p.find(e=>e.id===(null===g||void 0===g?void 0:g.uid)),r=i&&("Administrador"===i.rol||"Modificador"===i.rol)?(0,a.A)({},y||{}):{[null===g||void 0===g?void 0:g.uid]:(null===y||void 0===y?void 0:y[null===g||void 0===g?void 0:g.uid])||{}};R(r),L(o=>(0,a.A)((0,a.A)({},o),{},{[e]:r}))},[w,O,j,K,y,p,g,z,N]),(0,r.useEffect)(()=>{if(!w)return;const e=z(O);j||K!==e||L(o=>(0,a.A)((0,a.A)({},o),{},{[e]:P}))},[P,w,O,z,j,K]);const Ze=(0,r.useCallback)(async()=>{try{if(!((0,f.A)(O,"yyyy-MM-dd")===(0,f.A)(C,"yyyy-MM-dd")))return;const e=z(O),o=(0,n.KR)(t.OO,"horarios_registros/".concat(e)),i=await(0,n.Jt)(o);if(!i.exists())return void await(0,n.hZ)((0,n.KR)(t.OO,"horas_extras"),{});const a=i.val(),r={};Object.keys(a).forEach(e=>{const o=a[e];if(!o)return;const i=p.find(o=>o.id===e),n=(0,Z.bW)((null===i||void 0===i?void 0:i.tipoContrato)||"Operativo"),t=Object.values(o).reduce((e,o)=>!o||te.VF.includes(o.tipo)?e:e+(o.horas||0),0),s=Math.max(t-n,0);s>0&&(r[e]=s)}),await(0,n.hZ)((0,n.KR)(t.OO,"horas_extras"),r)}catch(e){console.error("Error al recalcular horas extras:",e)}},[O,C,z,p]),Be=(0,r.useCallback)(async()=>{try{S(!0);const o=z(O),i=(0,a.A)({},N);P&&Object.keys(P).length>0&&(i[o]=P);const r=p.find(e=>e.id===(null===g||void 0===g?void 0:g.uid)),s=r&&("Administrador"===r.rol||"Modificador"===r.rol);let l=0;const d={};if(s){for(const[e,a]of Object.entries(i))if(a&&0!==Object.keys(a).length)for(const[o,i]of Object.entries(a))d["horarios_registros/".concat(e,"/").concat(o)]=i||{},l+=1}else for(const[e,a]of Object.entries(i)){const o=null===a||void 0===a?void 0:a[null===g||void 0===g?void 0:g.uid];o&&Object.keys(o).length>0&&(d["horarios_registros/".concat(e,"/").concat(g.uid)]=o,l+=1)}if(l>0){const o=Object.keys(d);if(o.length<=10)for(const i of o){const o=i.split("/"),a=o[1],r=o[2];try{await V(a,r,d[i])}catch(e){console.warn("Fallo al guardar usuario individualmente, se acumula para batch:",e)}}else await async function(e){if(!e||0===Object.keys(e).length)return;const o={},i={id:(0,U.A)(),timestamp:Date.now(),payload:{}};for(const[n,t]of Object.entries(e))if(t&&"object"===typeof t&&!Array.isArray(t)){for(const[e,i]of Object.entries(t))o["".concat(n,"/").concat(e)]=i||null;i.payload[n]=t}else o[n]=t,i.payload[n]=t;try{await(0,n.hZ)((0,n.KR)(t.OO,"horarios_backups/".concat(i.id)),i)}catch(s){console.warn("No se pudo guardar backup de horarios:",s)}let a=0,r=null;for(;a<3;)try{return void await(0,n.yo)((0,n.KR)(t.OO),o)}catch(s){r=s,a+=1;const e=200*a;await new Promise(o=>setTimeout(o,e))}throw r}(d)}if(0===l)return ze({tipo:"warning",titulo:"Sin cambios para guardar",mensaje:"No se detectaron modificaciones pendientes. Verifica que los horarios editados aparezcan en pantalla antes de guardar.",soloInfo:!0}),void S(!1);E(!1),L({}),await Ze(),ze({tipo:"success",titulo:"\u2705 Horarios Guardados",mensaje:"Los horarios se han guardado correctamente.",soloInfo:!0})}catch(o){console.error("Error al guardar horarios:",o),ze({tipo:"error",titulo:"\u274c Error al Guardar",mensaje:"Ocurri\xf3 un error al guardar los horarios:\n\n".concat(o.message),soloInfo:!0})}finally{S(!1)}},[N,P,O,z,p,g,ze,Ze]),Ge=(0,r.useCallback)((e,o)=>{var i,a;const r=window.__HORARIOS_EDITADOS__||{},n=window.__HORARIOS__||{},t=(null===(i=r[e])||void 0===i?void 0:i[o])||(null===(a=n[e])||void 0===a?void 0:a[o]);$({usuarioId:e,diaKey:o,tipo:(null===t||void 0===t?void 0:t.tipo)||"personalizado",horaInicio:(null===t||void 0===t?void 0:t.horaInicio)||"",horaFin:(null===t||void 0===t?void 0:t.horaFin)||"",horaInicioLibre:(null===t||void 0===t?void 0:t.horaInicioLibre)||"",horaFinLibre:(null===t||void 0===t?void 0:t.horaFinLibre)||"",nota:(null===t||void 0===t?void 0:t.nota)||""}),Y(!0)},[]),Je=(0,r.useCallback)((e,o,i)=>{i&&i.stopPropagation();const r=w?P[e]:y[e],n=null===r||void 0===r?void 0:r[o];n&&n.tipo&&"libre"!==n.tipo?(De((0,a.A)((0,a.A)({},n),{},{usuarioId:e,diaOriginal:o})),He(!0)):ze({tipo:"warning",titulo:"\u26a0\ufe0f Sin Horario",mensaje:"No hay un horario establecido para copiar en este d\xeda.",soloInfo:!0})},[w,P,y,ze]),qe=(0,r.useCallback)(async e=>{if(Me&&e)try{const o={tipo:Me.tipo,horaInicio:Me.horaInicio||"",horaFin:Me.horaFin||"",horas:Me.horas||0};if(w)R(i=>(0,a.A)((0,a.A)({},i),{},{[Me.usuarioId]:(0,a.A)((0,a.A)({},i[Me.usuarioId]),{},{[e]:o})}));else{const i=z(O),r=(0,n.KR)(t.OO,"horarios_registros/".concat(i,"/").concat(Me.usuarioId,"/").concat(e));await(0,n.hZ)(r,o),I(i=>(0,a.A)((0,a.A)({},i),{},{[Me.usuarioId]:(0,a.A)((0,a.A)({},i[Me.usuarioId]),{},{[e]:o})}))}ze({tipo:"success",titulo:"\u2705 Horario Copiado",mensaje:"El horario se ha copiado exitosamente de ".concat(te.yQ[Me.diaOriginal]," a ").concat(te.yQ[e],"."),soloInfo:!0}),He(!1),De(null)}catch(o){console.error("Error al copiar horario:",o),ze({tipo:"error",titulo:"\u274c Error al Copiar",mensaje:"Ocurri\xf3 un error al copiar el horario:\n\n".concat(o.message),soloInfo:!0})}},[Me,w,O,z,ze]),Qe=(0,r.useCallback)((e,o)=>{if(!w)return;const i=p.find(e=>e.id===(null===g||void 0===g?void 0:g.uid)),a=p.find(o=>o.id===e);i&&a&&(G(i,a)?Ge(e,o):ze({tipo:"error",titulo:"\ud83d\udeab Acceso Denegado",mensaje:"No tienes permisos para modificar este horario.\n\nConsulta con un administrador si necesitas acceso.",soloInfo:!0}))},[w,p,g,Ge,ze]),Ye=(0,r.useCallback)(e=>he(e,w,P,y,e=>pe(p,e),Z.bW),[w,P,y,p]),Xe=p.find(e=>e.id===(null===g||void 0===g?void 0:g.uid));return j?(0,M.jsx)(c.A,{component:"main",maxWidth:"sm",sx:{py:8,textAlign:"center"},children:(0,M.jsx)(s.A,{elevation:0,sx:{p:4,textAlign:"center",boxShadow:"none",background:"none"},children:(0,M.jsx)(u.A,{variant:"h6",color:"text.secondary",children:"Cargando..."})})}):Xe&&(0,Z.VO)(Xe)?(0,M.jsxs)(c.A,{maxWidth:"xl",sx:{py:{xs:1,sm:2,md:3}},children:[(0,M.jsxs)(Ie,{elevation:3,children:[(0,M.jsx)(T,{departamentos:te.A1,departamentoSeleccionado:v,setDepartamentoSeleccionado:A,loading:j,semanaSeleccionada:O,setSemanaSeleccionada:F,yearSelected:be,setYearSelected:fe,monthSelected:ve,setMonthSelected:Ce,datePickerOpen:Oe,setDatePickerOpen:Fe,anchorEl:le,setAnchorEl:de,avanzarSemana:H,retrocederSemana:D}),w&&(0,M.jsx)(W,{usuariosFiltrados:Ue,calcularHorasExcedentes:e=>he(e,w,P,y,e=>pe(p,e),Z.bW),encontrarPracticantesDisponibles:function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return me(e,p,(e,o)=>ue(e,o,P,y,O,C,{},e=>pe(p,e),Z.bW),Z.bW,o,i)}}),(0,M.jsxs)(h.A,{severity:"info",sx:{m:3,mb:1,textAlign:"left"},children:[(0,M.jsx)(u.A,{variant:"body2",children:(0,M.jsx)("strong",{children:"Consideraciones importantes:"})}),(0,M.jsxs)(u.A,{variant:"body2",component:"div",sx:{mt:1,textAlign:"left"},children:["\u2022 Recordar el tipo de jornada seg\xfan su tipo de contrato",(0,M.jsx)("br",{}),"\u2022 Verificar disponibilidad antes de asignar horarios",(0,M.jsx)("br",{}),"\u2022 Recordar que el descanso minimo entre jornadas es de 12 horas",(0,M.jsx)("br",{}),"\u2022 Las horas acumuladas deben compensarse a la semana siguiente",(0,M.jsx)("br",{})]})]}),(0,M.jsx)(Ae,{isMobile:o,isSmallMobile:i,usuariosFiltrados:Ue,editando:w,horarios:y,horariosEditados:P,currentUser:p.find(e=>e.id===(null===g||void 0===g?void 0:g.uid)),handleCambiarTurno:Qe,abrirInfoTurno:(e,o,i)=>{Re(e),Le(o),_e(i),Ee(!0)},handleCopiarHorario:Je,NO_SUMAN_HORAS:te.VF,calcularExceso:Ye,calcularHorasTotales:ue,semanaSeleccionada:O,semanaActual:C,obtenerUsuario:pe,obtenerHorasMaximas:Z.bW,diasSemana:te.hu}),(0,M.jsxs)(m.A,{sx:{p:{xs:1.5,sm:3,md:3},borderTop:"1px solid",borderColor:"divider",display:"flex",gap:{xs:1,sm:2},flexDirection:i?"column":"row",justifyContent:"center",alignItems:"stretch",position:"relative"},children:[j&&(0,M.jsx)(m.A,{sx:{position:"absolute",inset:0,bgcolor:"rgba(255,255,255,0.5)",backdropFilter:"blur(1px)",borderRadius:1,zIndex:1}}),w?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(x.A,{variant:"outlined",onClick:()=>{E(!1),R({})},disabled:j,size:o?"medium":"large",fullWidth:i,sx:{flex:i?"none":1,maxWidth:i?"100%":"200px"},children:"Cancelar"}),(0,M.jsx)(x.A,{variant:"contained",color:"primary",onClick:Be,disabled:j,size:o?"medium":"large",fullWidth:i,sx:{flex:i?"none":1,maxWidth:i?"100%":"200px"},children:"Guardar Horarios"})]}):(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(x.A,{variant:"contained",color:"primary",onClick:Ve,disabled:j||($e=p.find(e=>e.id===(null===g||void 0===g?void 0:g.uid)),!($e&&[Z.gg.ADMINISTRADOR,Z.gg.MODIFICADOR].includes($e.rol))),size:o?"medium":"large",fullWidth:i,sx:{flex:i?"none":1,maxWidth:i?"100%":"200px"},children:"Editar Horarios"}),(0,M.jsx)(x.A,{variant:"outlined",sx:{borderColor:"#d32f2f",color:"#d32f2f","&:hover":{borderColor:"#b71c1c",backgroundColor:"rgba(211, 47, 47, 0.04)"},flex:i?"none":1,maxWidth:i?"100%":"200px"},onClick:()=>ie(!0),disabled:j||!B(p.find(e=>e.id===(null===g||void 0===g?void 0:g.uid))),size:o?"medium":"large",fullWidth:i,children:"Eliminar Horarios"})]})]})]}),(0,M.jsx)(J,{dialogoHorario:q,setDialogoHorario:Y,horarioPersonalizado:X,setHorarioPersonalizado:$,guardarHorarioPersonalizado:()=>{const{horaInicio:e,horaFin:o,horaInicioLibre:i,horaFinLibre:r,usuarioId:n,diaKey:t,tipo:s,nota:l,horaInicioTele:d,horaFinTele:c,horaInicioPres:u,horaFinPres:h}=X,m=(0,a.A)({},P);if(m[n]||(m[n]={}),te.VF.includes(s))return m[n][t]={tipo:s,horaInicio:"00:00",horaFin:"00:00",horas:0,nota:l||""},R(m),void Y(!1);const x=/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,b=e=>x.test(e),f=(e,o)=>{const[i,a]=e.split(":").map(Number),[r,n]=o.split(":").map(Number);return r>i||r===i&&n>a?r-i+(n-a)/60:24-i+r+(n-a)/60};if("tele-presencial"===s){if(!d||!c||!u||!h)return void ze({tipo:"error",titulo:"\u23f0 Horario obligatorio",mensaje:"Debes ingresar los horarios de Teletrabajo y Presencial para guardar la asignaci\xf3n.",soloInfo:!0});if(!b(d)||!b(c)||!b(u)||!b(h))return void ze({tipo:"error",titulo:"\u23f0 Formato de Hora Inv\xe1lido",mensaje:"El formato de hora debe ser HH:mm (24 horas).",soloInfo:!0});const e=Number(f(d,c).toFixed(1)),o=Number(f(u,h).toFixed(1)),i=Number((e+o).toFixed(1)),a=ue(n,w,P,y,O,C,{},e=>pe(p,e),Z.bW),r=pe(p,n),x=(0,Z.bW)((null===r||void 0===r?void 0:r.tipoContrato)||"Operativo");if(a+i>x){const b=xe(r,a+i-x,(e,o,i)=>me(e,p,(e,o)=>ue(e,o,P,y,O,C,{},e=>pe(p,e),Z.bW),Z.bW,o,i));return void ze({tipo:"warning",titulo:"\u26a0\ufe0f Exceso de Horas Detectado",mensaje:"".concat(b,"\n\n\xbfDesea continuar asignando estas horas?"),textoConfirmar:"Continuar de todas formas",textoCancelar:"Cancelar",onConfirmar:()=>{m[n][t]={tipo:s,horaInicioTele:d,horaFinTele:c,horasTele:e,horaInicioPres:u,horaFinPres:h,horasPres:o,horas:i,nota:l||""},R(m),Y(!1),we()},onCancelar:we})}return m[n][t]={tipo:s,horaInicioTele:d,horaFinTele:c,horasTele:e,horaInicioPres:u,horaFinPres:h,horasPres:o,horas:i,nota:l||""},R(m),void Y(!1)}if(!e||!o)return void ze({tipo:"error",titulo:"\u23f0 Horario obligatorio",mensaje:"Debes ingresar la hora de inicio y la hora de fin para guardar el horario.",soloInfo:!0});if(!b(e)||!b(o))return void ze({tipo:"error",titulo:"\u23f0 Formato de Hora Inv\xe1lido",mensaje:"El formato de hora debe ser HH:mm (24 horas).\n\nEjemplos v\xe1lidos:\n\u2022 08:30\n\u2022 14:45\n\u2022 23:00",soloInfo:!0});const v=ce(e),A=ce(o);let g=0;g=A.hora>v.hora||A.hora===v.hora&&A.minutos>v.minutos?A.hora-v.hora+(A.minutos-v.minutos)/60:24-v.hora+A.hora+(A.minutos-v.minutos)/60;const j=ue(n,w,P,y,O,C,{},e=>pe(p,e),Z.bW),S=pe(p,n),I=(0,Z.bW)((null===S||void 0===S?void 0:S.tipoContrato)||"Operativo");if(j+g>I){const a=xe(S,j+g-I,(e,o,i)=>me(e,p,(e,o)=>ue(e,o,P,y,O,C,{},e=>pe(p,e),Z.bW),Z.bW,o,i));return void ze({tipo:"warning",titulo:"\u26a0\ufe0f Exceso de Horas Detectado",mensaje:"".concat(a,"\n\n\xbfDesea continuar asignando estas horas?"),textoConfirmar:"Continuar de todas formas",textoCancelar:"Cancelar",onConfirmar:()=>{m[n][t]="tarde-libre"===s?{tipo:s,horaInicio:e,horaFin:o,horaInicioLibre:i||"",horaFinLibre:r||"",horas:g,nota:l||""}:{tipo:s,horaInicio:e,horaFin:o,horas:g,nota:l||""},R(m),Y(!1),we()},onCancelar:we})}m[n][t]="tarde-libre"===s?{tipo:s,horaInicio:e,horaFin:o,horaInicioLibre:i||"",horaFinLibre:r||"",horas:g,nota:l||""}:{tipo:s,horaInicio:e,horaFin:o,horas:g,nota:l||""},R(m),Y(!1)},isMobile:o,isSmallMobile:i,currentUser:p.find(e=>e.id===(null===g||void 0===g?void 0:g.uid))||null,usuarios:p,editando:w,horariosEditados:P,setHorariosEditados:R,horarios:y,setHorarios:I,semanaSeleccionada:O,obtenerClaveSemana:z}),(0,M.jsx)(Q,{dialogoEliminar:oe,setDialogoEliminar:ie,eliminacionSeleccionada:ae,setEliminacionSeleccionada:ne,handleEliminarSeleccionado:async()=>{try{S(!0);const e=z(O),o="horarios_registros/".concat(e),{tipo:i,usuarioId:r,dia:s,diasSeleccionados:l}=ae;let d=null;if(g&&g.rol?d=g:g&&g.uid&&(d=p.find(e=>e.id===g.uid)),!d)return void ze({tipo:"error",titulo:"\ud83d\udeab Usuario no encontrado",mensaje:"No se pudo verificar tu identidad. Por favor, inicia sesi\xf3n nuevamente.",soloInfo:!0});let c=(0,a.A)({},y);switch(i){case"todo":if("Administrador"!==d.rol)return void ze({tipo:"error",titulo:"\ud83d\udeab Permisos Insuficientes",mensaje:"Solo los administradores pueden eliminar todos los horarios.",soloInfo:!0});await(0,n.hZ)((0,n.KR)(t.OO,o),{}),I({}),R({});break;case"usuario":if(!r)return ze({tipo:"warning",titulo:"\ud83d\udc64 Usuario no seleccionado",mensaje:"Debes seleccionar un usuario para eliminar sus horarios.",soloInfo:!0}),S(!1),void ie(!1);if("Administrador"!==d.rol&&r!==g.uid)return void ze({tipo:"error",titulo:"\ud83d\udeab Acceso Denegado",mensaje:"Solo puedes eliminar tus propios horarios.\n\nLos administradores pueden eliminar horarios de cualquier usuario.",soloInfo:!0});if(!c[r])return ze({tipo:"warning",titulo:"\ud83d\udcc5 Sin Horarios",mensaje:"El usuario seleccionado no tiene horarios asignados para eliminar.",soloInfo:!0}),S(!1),void ie(!1);delete c[r],await(0,n.hZ)((0,n.KR)(t.OO,"".concat(o,"/").concat(r)),null),I(e=>{const o=(0,a.A)({},e);return delete o[r],o}),R(e=>{const o=(0,a.A)({},e);return delete o[r],o});break;case"dia":if("Administrador"!==d.rol)return void ze({tipo:"error",titulo:"\ud83d\udeab Permisos Insuficientes",mensaje:"Solo los administradores pueden eliminar horarios de un d\xeda completo para todos los usuarios.",soloInfo:!0});let e=!1;if(Object.keys(c).forEach(o=>{c[o]&&c[o][s]&&(delete c[o][s],e=!0)}),!e)return ze({tipo:"warning",titulo:"\ud83d\udcc5 Sin Horarios",mensaje:"No se encontraron horarios para ese d\xeda en ning\xfan usuario.",soloInfo:!0}),S(!1),void ie(!1);await(0,n.hZ)((0,n.KR)(t.OO,o),c),R({}),L({});break;case"mis-dias":if(null===g||void 0===g||!g.uid)return void ze({tipo:"error",titulo:"\ud83d\udeab Usuario no encontrado",mensaje:"No se pudo verificar tu identidad. Por favor, inicia sesi\xf3n nuevamente.",soloInfo:!0});if(!c[g.uid])return void ze({tipo:"warning",titulo:"\ud83d\udcc5 Sin Horarios",mensaje:"No tienes horarios asignados para eliminar.",soloInfo:!0});if(!l||0===l.length)return void ze({tipo:"warning",titulo:"\ud83d\udcc5 D\xedas no Seleccionados",mensaje:"Debes seleccionar al menos un d\xeda para eliminar.",soloInfo:!0});l.forEach(e=>{c[g.uid]&&c[g.uid][e]&&delete c[g.uid][e]}),await(0,n.hZ)((0,n.KR)(t.OO,o),c),R({}),L({});break;default:console.log("Tipo de eliminaci\xf3n no reconocido:",i)}ze({tipo:"success",titulo:"\u2705 Horarios Eliminados",mensaje:"Los horarios seleccionados se han eliminado correctamente.",soloInfo:!0}),await Ze()}catch(e){console.error("Error al eliminar horarios:",e),ze({tipo:"error",titulo:"\u274c Error al Eliminar",mensaje:"Ocurri\xf3 un error al eliminar los horarios:\n\n".concat(e.message),soloInfo:!0})}finally{S(!1),ie(!1)}},currentUser:g,usuarios:p,horarios:y,isMobile:o,isSmallMobile:i}),(0,M.jsx)(ee,{dialogoCopiar:ke,setDialogoCopiar:He,horarioACopiar:Me,setHorarioACopiar:De,ejecutarCopiarHorario:qe,editando:w,horariosEditados:P,horarios:y}),(0,M.jsx)(re,{modalConfirmacion:Te,cerrarModalConfirmacion:we}),(0,M.jsx)(se,{open:We,onClose:()=>{Ee(!1),Re(null),Le(null),_e(null)},usuario:Pe,turno:Ne,diaKey:Ke,semanaSeleccionada:O})]}):null;var $e}},6581:(e,o,i)=>{i.d(o,{A1:()=>a,Kj:()=>s,VF:()=>n,hu:()=>r,yQ:()=>t});const a=["Planeaci\xf3n de Eventos","Gesti\xf3n de la Protecci\xf3n","\xc1reas & Sostenibilidad","Gastronom\xeda","Infraestructura","Financiero","Oficina de Atenci\xf3n al Expositor","Practicantes/Crosstraining","Talento Humano","Calidad","Sistemas","Mercadeo y Ventas","Compras","Gerencia de Operaciones","Gerencia General","UDEI"],r=["Lunes","Martes","Mi\xe9rcoles","Jueves","Viernes","S\xe1bado","Domingo"],n=["descanso","vacaciones","feriado","permiso","dia-brigada","fuera-oficina","incapacidad-enfermedad","incapacidad-accidente"],t={dia1:"Lunes",dia2:"Martes",dia3:"Mi\xe9rcoles",dia4:"Jueves",dia5:"Viernes",dia6:"S\xe1bado",dia7:"Domingo"},s={personalizado:"Presencial",teletrabajo:"Teletrabajo",cambio:"Cambio",descanso:"Descanso",vacaciones:"Vacaciones",feriado:"Feriado",permiso:"Permiso","tarde-libre":"Tarde Libre","dia-brigada":"Brigada","fuera-oficina":"Fuera de Oficina","viaje-trabajo":"Viaje de Trabajo","incapacidad-enfermedad":"Incapacidad por Enfermedad","incapacidad-accidente":"Incapacidad por Accidente","tele-presencial":"Teletrabajo & Presencial"}},6984:(e,o,i)=>{i.d(o,{FW:()=>u,MJ:()=>l,MO:()=>m,Nf:()=>s,RK:()=>a,VO:()=>c,bW:()=>t,gg:()=>r,m:()=>h,qK:()=>d});const a={OPERATIVO:"Operativo",CONFIANZA:"Confianza"},r={ADMINISTRADOR:"Administrador",MODIFICADOR:"Modificador",VISOR:"Visor"},n={[a.OPERATIVO]:48,[a.CONFIANZA]:72},t=e=>n[e]||n[a.OPERATIVO],s=e=>{const o=t(e);return"Los empleados de tipo ".concat(e," tienen un l\xedmite de ").concat(o," horas semanales.")},l=e=>"Talento Humano"===(null===e||void 0===e?void 0:e.departamento),d=e=>(null===e||void 0===e?void 0:e.rol)===r.ADMINISTRADOR||"Talento Humano"===(null===e||void 0===e?void 0:e.departamento)||"admin@costaricacc.com"===(null===e||void 0===e?void 0:e.email),c=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(null===e||void 0===e?void 0:e.rol)===r.ADMINISTRADOR||((null===e||void 0===e?void 0:e.rol)===r.MODIFICADOR||(null===e||void 0===e?void 0:e.rol)===r.VISOR?!o||(null===e||void 0===e?void 0:e.departamento)===(null===o||void 0===o?void 0:o.departamento):"Talento Humano"===(null===e||void 0===e?void 0:e.departamento)||"admin@costaricacc.com"===(null===e||void 0===e?void 0:e.email))},u=e=>(null===e||void 0===e?void 0:e.rol)===r.ADMINISTRADOR||"Talento Humano"===(null===e||void 0===e?void 0:e.departamento)||"admin@costaricacc.com"===(null===e||void 0===e?void 0:e.email),h=e=>{switch(e){case r.ADMINISTRADOR:return"error";case r.MODIFICADOR:return"warning";case r.VISOR:return"info";default:return"default"}},m=e=>{switch(e){case r.ADMINISTRADOR:return"Puede realizar todos los cambios en la plataforma";case r.MODIFICADOR:return"Puede modificar horarios de su departamento";case r.VISOR:return"Solo puede ver horarios, sin modificaciones";default:return"Sin rol espec\xedfico asignado"}}}}]);
//# sourceMappingURL=429.d8d15f64.chunk.js.map